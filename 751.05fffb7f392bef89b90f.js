(self.webpackChunkprojectakhir=self.webpackChunkprojectakhir||[]).push([[751],{9751:(t,e,n)=>{"use strict";n.r(e),n.d(e,{HomeModule:()=>jg});var r=n(8583),i=n(8939),o=n(7716),s=n(7574),a=n(5917),u=n(4402),c=n(4395),h=n(8002),l=n(9746),f=n(3190),d=n(57),p=n(9759),g=n(4762),y=n(4685),m=n(6034),v="firebasestorage.googleapis.com",b=function(t){function e(n,r){var i=t.call(this,w(n),"Firebase Storage: "+r+" ("+w(n)+")")||this;return i.customData={serverResponse:null},i._baseMessage=i.message,Object.setPrototypeOf(i,e.prototype),i}return(0,g.ZT)(e,t),e.prototype._codeEquals=function(t){return w(t)===this.code},Object.defineProperty(e.prototype,"serverResponse",{get:function(){return this.customData.serverResponse},set:function(t){this.customData.serverResponse=t,this.message=this.customData.serverResponse?this._baseMessage+"\n"+this.customData.serverResponse:this._baseMessage},enumerable:!1,configurable:!0}),e}(y.ZR);function w(t){return"storage/"+t}function _(){return new b("unknown","An unknown error occurred, please check the error payload for server response.")}function T(){return new b("canceled","User canceled the upload/download.")}function I(){return new b("cannot-slice-blob","Cannot slice blob for upload. Please retry the upload.")}function E(t){return new b("invalid-argument",t)}function S(){return new b("app-deleted","The Firebase app was deleted.")}function k(t){return new b("invalid-root-operation","The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function A(t,e){return new b("invalid-format","String does not match format '"+t+"': "+e)}function R(t){throw new b("internal-error","Internal error: "+t)}var D={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"},N=function(t,e){this.data=t,this.contentType=e||null};function x(t,e){switch(t){case D.RAW:return new N(C(e));case D.BASE64:case D.BASE64URL:return new N(O(t,e));case D.DATA_URL:return new N((n=new P(e)).base64?O(D.BASE64,n.rest):function(t){var e;try{e=decodeURIComponent(t)}catch(yg){throw A(D.DATA_URL,"Malformed data URL.")}return C(e)}(n.rest),new P(e).contentType)}var n;throw _()}function C(t){for(var e=[],n=0;n<t.length;n++){var r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|63&r);else if(55296==(64512&r))if(n<t.length-1&&56320==(64512&t.charCodeAt(n+1))){var i=r,o=t.charCodeAt(++n);e.push(240|(r=65536|(1023&i)<<10|1023&o)>>18,128|r>>12&63,128|r>>6&63,128|63&r)}else e.push(239,191,189);else 56320==(64512&r)?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(e)}function O(t,e){switch(t){case D.BASE64:var n=-1!==e.indexOf("-"),r=-1!==e.indexOf("_");if(n||r)throw A(t,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case D.BASE64URL:var i=-1!==e.indexOf("+"),o=-1!==e.indexOf("/");if(i||o)throw A(t,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/")}var s;try{s=atob(e)}catch(yg){throw A(t,"Invalid character found")}for(var a=new Uint8Array(s.length),u=0;u<s.length;u++)a[u]=s.charCodeAt(u);return a}var P=function(t){this.base64=!1,this.contentType=null;var e=t.match(/^data:([^,]+)?,/);if(null===e)throw A(D.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var n,r,i=e[1]||null;null!=i&&(this.base64=(n=i).length>=(r=";base64").length&&n.substring(n.length-r.length)===r,this.contentType=this.base64?i.substring(0,i.length-";base64".length):i),this.rest=t.substring(t.indexOf(",")+1)},L={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function F(t){switch(t){case"running":case"pausing":case"canceling":return L.RUNNING;case"paused":return L.PAUSED;case"success":return L.SUCCESS;case"canceled":return L.CANCELED;case"error":default:return L.ERROR}}var U=(()=>(function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"}(U||(U={})),U))(),M=function(){function t(){var t=this;this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=U.NO_ERROR,this.sendPromise_=new Promise(function(e){t.xhr_.addEventListener("abort",function(){t.errorCode_=U.ABORT,e()}),t.xhr_.addEventListener("error",function(){t.errorCode_=U.NETWORK_ERROR,e()}),t.xhr_.addEventListener("load",function(){e()})})}return t.prototype.send=function(t,e,n,r){if(this.sent_)throw R("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(e,t,!0),void 0!==r)for(var i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_},t.prototype.getErrorCode=function(){if(!this.sent_)throw R("cannot .getErrorCode() before sending");return this.errorCode_},t.prototype.getStatus=function(){if(!this.sent_)throw R("cannot .getStatus() before sending");try{return this.xhr_.status}catch(yg){return-1}},t.prototype.getResponseText=function(){if(!this.sent_)throw R("cannot .getResponseText() before sending");return this.xhr_.responseText},t.prototype.abort=function(){this.xhr_.abort()},t.prototype.getResponseHeader=function(t){return this.xhr_.getResponseHeader(t)},t.prototype.addUploadProgressListener=function(t){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",t)},t.prototype.removeUploadProgressListener=function(t){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",t)},t}(),q=function(){function t(){}return t.prototype.createConnection=function(){return new M},t}(),V=function(){function t(t,e){this.bucket=t,this.path_=e}return Object.defineProperty(t.prototype,"path",{get:function(){return this.path_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isRoot",{get:function(){return 0===this.path.length},enumerable:!1,configurable:!0}),t.prototype.fullServerUrl=function(){var t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)},t.prototype.bucketOnlyServerUrl=function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"},t.makeFromBucketSpec=function(e,n){var r;try{r=t.makeFromUrl(e,n)}catch(yg){return new t(e,"")}if(""===r.path)return r;throw new b("invalid-default-bucket","Invalid default bucket '"+e+"'.")},t.makeFromUrl=function(e,n){var r=null,i="([A-Za-z0-9.\\-_]+)",o=new RegExp("^gs://"+i+"(/(.*))?$","i");function s(t){t.path_=decodeURIComponent(t.path)}for(var a=n.replace(/[.]/g,"\\."),u=[{regex:o,indices:{bucket:1,path:3},postModify:function(t){"/"===t.path.charAt(t.path.length-1)&&(t.path_=t.path_.slice(0,-1))}},{regex:new RegExp("^https?://"+a+"/v[A-Za-z0-9_]+/b/"+i+"/o(/([^?#]*).*)?$","i"),indices:{bucket:1,path:3},postModify:s},{regex:new RegExp("^https?://"+(n===v?"(?:storage.googleapis.com|storage.cloud.google.com)":n)+"/"+i+"/([^?#]*)","i"),indices:{bucket:1,path:2},postModify:s}],c=0;c<u.length;c++){var h=u[c],l=h.regex.exec(e);if(l){var f=l[h.indices.path];f||(f=""),r=new t(l[h.indices.bucket],f),h.postModify(r);break}}if(null==r)throw function(t){return new b("invalid-url","Invalid URL '"+t+"'.")}(e);return r},t}(),j=function(){function t(t){this.promise_=Promise.reject(t)}return t.prototype.getPromise=function(){return this.promise_},t.prototype.cancel=function(t){},t}();function G(t){return"string"==typeof t||t instanceof String}function B(t){return K()&&t instanceof Blob}function K(){return"undefined"!=typeof Blob}function z(t,e,n,r){if(r<e)throw E("Invalid value for '"+t+"'. Expected "+e+" or greater.");if(r>n)throw E("Invalid value for '"+t+"'. Expected "+n+" or less.")}function J(t,e){var n=e.match(/^(\w+):\/\/.+/),r=e;return null==(null==n?void 0:n[1])&&(r="https://"+e),r+"/v0"+t}function Q(t){var e=encodeURIComponent,n="?";for(var r in t)t.hasOwnProperty(r)&&(n=n+(e(r)+"=")+e(t[r])+"&");return n.slice(0,-1)}var H=function(){function t(t,e,n,r,i,o,s,a,u,c,h){var l=this;this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=t,this.method_=e,this.headers_=n,this.body_=r,this.successCodes_=i.slice(),this.additionalRetryCodes_=o.slice(),this.callback_=s,this.errorCallback_=a,this.progressCallback_=c,this.timeout_=u,this.pool_=h,this.promise_=new Promise(function(t,e){l.resolve_=t,l.reject_=e,l.start_()})}return t.prototype.start_=function(){var t=this;function e(e,n){var r,i=t.resolve_,o=t.reject_,s=n.connection;if(n.wasSuccessCode)try{var a=t.callback_(s,s.getResponseText());!function(t){return void 0!==t}(a)?i():i(a)}catch(yg){o(yg)}else null!==s?((r=_()).serverResponse=s.getResponseText(),o(t.errorCallback_?t.errorCallback_(s,r):r)):o(r=n.canceled?t.appDelete_?S():T():new b("retry-limit-exceeded","Max retry time for operation exceeded, please try again."))}this.canceled_?e(0,new W(!1,null,!0)):this.backoffId_=function(e,n,r){var i=1,o=null,s=!1,a=0;function u(){return 2===a}var c=!1;function h(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];c||(c=!0,n.apply(null,t))}function l(e){o=setTimeout(function(){o=null,function(e,n){if(n)e(!1,new W(!1,null,!0));else{var r=t.pool_.createConnection();t.pendingConnection_=r,null!==t.progressCallback_&&r.addUploadProgressListener(i),r.send(t.url_,t.method_,t.body_,t.headers_).then(function(){null!==t.progressCallback_&&r.removeUploadProgressListener(i),t.pendingConnection_=null;var n=r.getErrorCode()===U.NO_ERROR,o=r.getStatus();if(n&&!t.isRetryStatusCode_(o)){var s=-1!==t.successCodes_.indexOf(o);e(!0,new W(s,r))}else{var a=r.getErrorCode()===U.ABORT;e(!1,new W(!1,null,a))}})}function i(e){null!==t.progressCallback_&&t.progressCallback_(e.loaded,e.lengthComputable?e.total:-1)}}(f,u())},e)}function f(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(!c)if(t)h.call.apply(h,(0,g.ev)([null,t],e));else{var r;u()||s?h.call.apply(h,(0,g.ev)([null,t],e)):(i<64&&(i*=2),1===a?(a=2,r=0):r=1e3*(i+Math.random()),l(r))}}var d=!1;function p(t){d||(d=!0,c||(null!==o?(t||(a=2),clearTimeout(o),l(0)):t||(a=1)))}return l(0),setTimeout(function(){s=!0,p(!0)},r),p}(0,e,this.timeout_)},t.prototype.getPromise=function(){return this.promise_},t.prototype.cancel=function(t){this.canceled_=!0,this.appDelete_=t||!1,null!==this.backoffId_&&function(t){t(!1)}(this.backoffId_),null!==this.pendingConnection_&&this.pendingConnection_.abort()},t.prototype.isRetryStatusCode_=function(t){var e=t>=500&&t<600,n=-1!==[408,429].indexOf(t),r=-1!==this.additionalRetryCodes_.indexOf(t);return e||n||r},t}(),W=function(t,e,n){this.wasSuccessCode=t,this.connection=e,this.canceled=!!n};function Z(){return"undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function X(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Z();if(void 0!==n){for(var r=new n,i=0;i<t.length;i++)r.append(t[i]);return r.getBlob()}if(K())return new Blob(t);throw new b("unsupported-environment","This browser doesn't seem to support creating Blobs")}var Y=function(){function t(t,e){var n=0,r="";B(t)?(this.data_=t,n=t.size,r=t.type):t instanceof ArrayBuffer?(e?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),n=this.data_.length):t instanceof Uint8Array&&(e?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),n=t.length),this.size_=n,this.type_=r}return t.prototype.size=function(){return this.size_},t.prototype.type=function(){return this.type_},t.prototype.slice=function(e,n){if(B(this.data_)){var r=(o=e,s=n,(i=this.data_).webkitSlice?i.webkitSlice(o,s):i.mozSlice?i.mozSlice(o,s):i.slice?i.slice(o,s):null);return null===r?null:new t(r)}var i,o,s;return new t(new Uint8Array(this.data_.buffer,e,n-e),!0)},t.getBlob=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(K()){var r=e.map(function(e){return e instanceof t?e.data_:e});return new t(X.apply(null,r))}var i=e.map(function(t){return G(t)?x(D.RAW,t).data:t.data_}),o=0;i.forEach(function(t){o+=t.byteLength});var s=new Uint8Array(o),a=0;return i.forEach(function(t){for(var e=0;e<t.length;e++)s[a++]=t[e]}),new t(s,!0)},t.prototype.uploadData=function(){return this.data_},t}();function $(t){var e;try{e=JSON.parse(t)}catch(yg){return null}return function(t){return"object"==typeof t&&!Array.isArray(t)}(e)?e:null}function tt(t){var e=t.lastIndexOf("/",t.length-2);return-1===e?t:t.slice(e+1)}function et(t,e){return e}var nt=function(t,e,n,r){this.server=t,this.local=e||t,this.writable=!!n,this.xform=r||et},rt=null;function it(){if(rt)return rt;var t=[];t.push(new nt("bucket")),t.push(new nt("generation")),t.push(new nt("metageneration")),t.push(new nt("name","fullPath",!0));var e=new nt("name");e.xform=function(t,e){return function(t){return!G(t)||t.length<2?t:tt(t)}(e)},t.push(e);var n=new nt("size");return n.xform=function(t,e){return void 0!==e?Number(e):e},t.push(n),t.push(new nt("timeCreated")),t.push(new nt("updated")),t.push(new nt("md5Hash",null,!0)),t.push(new nt("cacheControl",null,!0)),t.push(new nt("contentDisposition",null,!0)),t.push(new nt("contentEncoding",null,!0)),t.push(new nt("contentLanguage",null,!0)),t.push(new nt("contentType",null,!0)),t.push(new nt("metadata","customMetadata",!0)),rt=t}function ot(t,e,n){var r=$(e);return null===r?null:function(t,e,n){for(var r={type:"file"},i=n.length,o=0;o<i;o++){var s=n[o];r[s.local]=s.xform(r,e[s.server])}return function(t,e){Object.defineProperty(t,"ref",{get:function(){var n=new V(t.bucket,t.fullPath);return e._makeStorageReference(n)}})}(r,t),r}(t,r,n)}function st(t,e){for(var n={},r=e.length,i=0;i<r;i++){var o=e[i];o.writable&&(n[o.server]=t[o.local])}return JSON.stringify(n)}var at=function(t,e,n,r){this.url=t,this.method=e,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]};function ut(t){if(!t)throw _()}function ct(t,e){return function(n,r){var i=ot(t,r,e);return ut(null!==i),i}}function ht(t){return function(e,n){var r;return(r=401===e.getStatus()?e.getResponseText().includes("Firebase App Check token is invalid")?new b("unauthorized-app","This app does not have permission to access Firebase Storage on this project."):new b("unauthenticated","User is not authenticated, please authenticate using Firebase Authentication and try again."):402===e.getStatus()?new b("quota-exceeded","Quota for bucket '"+t.bucket+"' exceeded, please view quota on https://firebase.google.com/pricing/."):403===e.getStatus()?new b("unauthorized","User does not have permission to access '"+t.path+"'."):n).serverResponse=n.serverResponse,r}}function lt(t){var e=ht(t);return function(n,r){var i=e(n,r);return 404===n.getStatus()&&(i=new b("object-not-found","Object '"+t.path+"' does not exist.")),i.serverResponse=r.serverResponse,i}}function ft(t,e,n){var r=J(e.fullServerUrl(),t.host),i=t.maxOperationRetryTime,o=new at(r,"GET",ct(t,n),i);return o.errorHandler=lt(e),o}function dt(t,e,n){var r=Object.assign({},n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=function(t,e){return e&&e.type()||"application/octet-stream"}(0,e)),r}var pt=function(t,e,n,r){this.current=t,this.total=e,this.finalized=!!n,this.metadata=r||null};function gt(t,e){var n=null;try{n=t.getResponseHeader("X-Goog-Upload-Status")}catch(yg){ut(!1)}return ut(!!n&&-1!==(e||["active"]).indexOf(n)),n}var yt=262144,mt=function(t,e,n){if(function(t){return"function"==typeof t}(t)||null!=e||null!=n)this.next=t,this.error=e,this.complete=n;else{var r=t;this.next=r.next,this.error=r.error,this.complete=r.complete}};function vt(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];Promise.resolve().then(function(){return t.apply(void 0,e)})}}var bt=function(){function t(t,e,n){var r=this;void 0===n&&(n=null),this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=t,this._blob=e,this._metadata=n,this._mappings=it(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=function(t){r._request=void 0,r._chunkMultiplier=1,t._codeEquals("canceled")?(r._needToFetchStatus=!0,r.completeTransitions_()):(r._error=t,r._transition("error"))},this._metadataErrorHandler=function(t){r._request=void 0,t._codeEquals("canceled")?r.completeTransitions_():(r._error=t,r._transition("error"))},this._promise=new Promise(function(t,e){r._resolve=t,r._reject=e,r._start()}),this._promise.then(null,function(){})}return t.prototype._makeProgressCallback=function(){var t=this,e=this._transferred;return function(n){return t._updateProgress(e+n)}},t.prototype._shouldDoResumable=function(t){return t.size()>262144},t.prototype._start=function(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this._continueUpload():this._oneShotUpload())},t.prototype._resolveToken=function(t){var e=this;Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(function(n){var r=n[0],i=n[1];switch(e._state){case"running":t(r,i);break;case"canceling":e._transition("canceled");break;case"pausing":e._transition("paused")}})},t.prototype._createResumable=function(){var t=this;this._resolveToken(function(e,n){var r=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),s=dt(e,r,i),a={name:s.fullPath},u=J(o,t.host),c={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":""+r.size(),"X-Goog-Upload-Header-Content-Type":s.contentType,"Content-Type":"application/json; charset=utf-8"},h=st(s,n),l=new at(u,"POST",function(t){var e;gt(t);try{e=t.getResponseHeader("X-Goog-Upload-URL")}catch(yg){ut(!1)}return ut(G(e)),e},t.maxUploadRetryTime);return l.urlParams=a,l.headers=c,l.body=h,l.errorHandler=ht(e),l}(t._ref.storage,t._ref._location,t._mappings,t._blob,t._metadata),i=t._ref.storage._makeRequest(r,e,n);t._request=i,i.getPromise().then(function(e){t._request=void 0,t._uploadUrl=e,t._needToFetchStatus=!1,t.completeTransitions_()},t._errorHandler)})},t.prototype._fetchStatus=function(){var t=this,e=this._uploadUrl;this._resolveToken(function(n,r){var i=function(t,e,n,r){var i=new at(n,"POST",function(t){var e=gt(t,["active","final"]),n=null;try{n=t.getResponseHeader("X-Goog-Upload-Size-Received")}catch(yg){ut(!1)}n||ut(!1);var i=Number(n);return ut(!isNaN(i)),new pt(i,r.size(),"final"===e)},t.maxUploadRetryTime);return i.headers={"X-Goog-Upload-Command":"query"},i.errorHandler=ht(e),i}(t._ref.storage,t._ref._location,e,t._blob),o=t._ref.storage._makeRequest(i,n,r);t._request=o,o.getPromise().then(function(e){e=e,t._request=void 0,t._updateProgress(e.current),t._needToFetchStatus=!1,e.finalized&&(t._needToFetchMetadata=!0),t.completeTransitions_()},t._errorHandler)})},t.prototype._continueUpload=function(){var t=this,e=yt*this._chunkMultiplier,n=new pt(this._transferred,this._blob.size()),r=this._uploadUrl;this._resolveToken(function(i,o){var s;try{s=function(t,e,n,r,i,o,s,a){var u=new pt(0,0);if(s?(u.current=s.current,u.total=s.total):(u.current=0,u.total=r.size()),r.size()!==u.total)throw new b("server-file-wrong-size","Server recorded incorrect upload file size, please retry the upload.");var c=u.total-u.current,h=c;i>0&&(h=Math.min(h,i));var l=u.current,f={"X-Goog-Upload-Command":h===c?"upload, finalize":"upload","X-Goog-Upload-Offset":""+u.current},d=r.slice(l,l+h);if(null===d)throw I();var p=new at(n,"POST",function(t,n){var i,s=gt(t,["active","final"]),a=u.current+h,c=r.size();return i="final"===s?ct(e,o)(t,n):null,new pt(a,c,"final"===s,i)},e.maxUploadRetryTime);return p.headers=f,p.body=d.uploadData(),p.progressCallback=a||null,p.errorHandler=ht(t),p}(t._ref._location,t._ref.storage,r,t._blob,e,t._mappings,n,t._makeProgressCallback())}catch(yg){return t._error=yg,void t._transition("error")}var a=t._ref.storage._makeRequest(s,i,o);t._request=a,a.getPromise().then(function(e){t._increaseMultiplier(),t._request=void 0,t._updateProgress(e.current),e.finalized?(t._metadata=e.metadata,t._transition("success")):t.completeTransitions_()},t._errorHandler)})},t.prototype._increaseMultiplier=function(){yt*this._chunkMultiplier<33554432&&(this._chunkMultiplier*=2)},t.prototype._fetchMetadata=function(){var t=this;this._resolveToken(function(e,n){var r=ft(t._ref.storage,t._ref._location,t._mappings),i=t._ref.storage._makeRequest(r,e,n);t._request=i,i.getPromise().then(function(e){t._request=void 0,t._metadata=e,t._transition("success")},t._metadataErrorHandler)})},t.prototype._oneShotUpload=function(){var t=this;this._resolveToken(function(e,n){var r=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),s={"X-Goog-Upload-Protocol":"multipart"},a=function(){for(var t="",e=0;e<2;e++)t+=Math.random().toString().slice(2);return t}();s["Content-Type"]="multipart/related; boundary="+a;var u=dt(e,r,i),c=st(u,n),h=Y.getBlob("--"+a+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+c+"\r\n--"+a+"\r\nContent-Type: "+u.contentType+"\r\n\r\n",r,"\r\n--"+a+"--");if(null===h)throw I();var l={name:u.fullPath},f=J(o,t.host),d=t.maxUploadRetryTime,p=new at(f,"POST",ct(t,n),d);return p.urlParams=l,p.headers=s,p.body=h.uploadData(),p.errorHandler=ht(e),p}(t._ref.storage,t._ref._location,t._mappings,t._blob,t._metadata),i=t._ref.storage._makeRequest(r,e,n);t._request=i,i.getPromise().then(function(e){t._request=void 0,t._metadata=e,t._updateProgress(t._blob.size()),t._transition("success")},t._errorHandler)})},t.prototype._updateProgress=function(t){var e=this._transferred;this._transferred=t,this._transferred!==e&&this._notifyObservers()},t.prototype._transition=function(t){if(this._state!==t)switch(t){case"canceling":case"pausing":this._state=t,void 0!==this._request&&this._request.cancel();break;case"running":var e="paused"===this._state;this._state=t,e&&(this._notifyObservers(),this._start());break;case"paused":this._state=t,this._notifyObservers();break;case"canceled":this._error=T(),this._state=t,this._notifyObservers();break;case"error":case"success":this._state=t,this._notifyObservers()}},t.prototype.completeTransitions_=function(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}},Object.defineProperty(t.prototype,"snapshot",{get:function(){var t=F(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:t,metadata:this._metadata,task:this,ref:this._ref}},enumerable:!1,configurable:!0}),t.prototype.on=function(t,e,n,r){var i=this,o=new mt(e,n,r);return this._addObserver(o),function(){i._removeObserver(o)}},t.prototype.then=function(t,e){return this._promise.then(t,e)},t.prototype.catch=function(t){return this.then(null,t)},t.prototype._addObserver=function(t){this._observers.push(t),this._notifyObserver(t)},t.prototype._removeObserver=function(t){var e=this._observers.indexOf(t);-1!==e&&this._observers.splice(e,1)},t.prototype._notifyObservers=function(){var t=this;this._finishPromise(),this._observers.slice().forEach(function(e){t._notifyObserver(e)})},t.prototype._finishPromise=function(){if(void 0!==this._resolve){var t=!0;switch(F(this._state)){case L.SUCCESS:vt(this._resolve.bind(null,this.snapshot))();break;case L.CANCELED:case L.ERROR:vt(this._reject.bind(null,this._error))();break;default:t=!1}t&&(this._resolve=void 0,this._reject=void 0)}},t.prototype._notifyObserver=function(t){switch(F(this._state)){case L.RUNNING:case L.PAUSED:t.next&&vt(t.next.bind(t,this.snapshot))();break;case L.SUCCESS:t.complete&&vt(t.complete.bind(t))();break;case L.CANCELED:case L.ERROR:t.error&&vt(t.error.bind(t,this._error))();break;default:t.error&&vt(t.error.bind(t,this._error))()}},t.prototype.resume=function(){var t="paused"===this._state||"pausing"===this._state;return t&&this._transition("running"),t},t.prototype.pause=function(){var t="running"===this._state;return t&&this._transition("pausing"),t},t.prototype.cancel=function(){var t="running"===this._state||"pausing"===this._state;return t&&this._transition("canceling"),t},t}(),wt=function(){function t(t,e){this._service=t,this._location=e instanceof V?e:V.makeFromUrl(e,t.host)}return t.prototype.toString=function(){return"gs://"+this._location.bucket+"/"+this._location.path},t.prototype._newRef=function(e,n){return new t(e,n)},Object.defineProperty(t.prototype,"root",{get:function(){var t=new V(this._location.bucket,"");return this._newRef(this._service,t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bucket",{get:function(){return this._location.bucket},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fullPath",{get:function(){return this._location.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return tt(this._location.path)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"storage",{get:function(){return this._service},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){var e=function(t){if(0===t.length)return null;var e=t.lastIndexOf("/");return-1===e?"":t.slice(0,e)}(this._location.path);if(null===e)return null;var n=new V(this._location.bucket,e);return new t(this._service,n)},enumerable:!1,configurable:!0}),t.prototype._throwIfRoot=function(t){if(""===this._location.path)throw k(t)},t}();function _t(t){var e={prefixes:[],items:[]};return Tt(t,e).then(function(){return e})}function Tt(t,e,n){return(0,g.mG)(this,void 0,void 0,function(){var r,i,o;return(0,g.Jh)(this,function(s){switch(s.label){case 0:return[4,It(t,{pageToken:n})];case 1:return r=s.sent(),(i=e.prefixes).push.apply(i,r.prefixes),(o=e.items).push.apply(o,r.items),null==r.nextPageToken?[3,3]:[4,Tt(t,e,r.nextPageToken)];case 2:s.sent(),s.label=3;case 3:return[2]}})})}function It(t,e){return(0,g.mG)(this,void 0,void 0,function(){var n,r;return(0,g.Jh)(this,function(i){switch(i.label){case 0:return null!=e&&"number"==typeof e.maxResults&&z("options.maxResults",1,1e3,e.maxResults),r=function(t,e,n,r,i){var o={};o.prefix=e.isRoot?"":e.path+"/",n&&n.length>0&&(o.delimiter=n),r&&(o.pageToken=r),i&&(o.maxResults=i);var s=J(e.bucketOnlyServerUrl(),t.host),a=t.maxOperationRetryTime,u=new at(s,"GET",function(t,e){return function(n,r){var i=function(t,e,n){var r=$(n);return null===r?null:function(t,e,n){var r={prefixes:[],items:[],nextPageToken:n.nextPageToken};if(n.prefixes)for(var i=0,o=n.prefixes;i<o.length;i++){var s=o[i].replace(/\/$/,""),a=t._makeStorageReference(new V(e,s));r.prefixes.push(a)}if(n.items)for(var u=0,c=n.items;u<c.length;u++)a=t._makeStorageReference(new V(e,c[u].name)),r.items.push(a);return r}(t,e,r)}(t,e,r);return ut(null!==i),i}}(t,e.bucket),a);return u.urlParams=o,u.errorHandler=ht(e),u}(t.storage,t._location,"/",(n=e||{}).pageToken,n.maxResults),[4,t.storage.makeRequestWithTokens(r)];case 1:return[2,i.sent().getPromise()]}})})}function Et(t,e){var n=function(t,e){var n=e.split("/").filter(function(t){return t.length>0}).join("/");return 0===t.length?n:t+"/"+n}(t._location.path,e),r=new V(t._location.bucket,n);return new wt(t.storage,r)}function St(t){return/^[A-Za-z]+:\/\//.test(t)}function kt(t,e){if(t instanceof Dt){var n=t;if(null==n._bucket)throw new b("no-default-bucket","No default bucket found. Did you set the 'storageBucket' property when initializing the app?");var r=new wt(n,n._bucket);return null!=e?kt(r,e):r}if(void 0!==e){if(e.includes(".."))throw E('`path` param cannot contain ".."');return Et(t,e)}return t}function At(t,e){if(e&&St(e)){if(t instanceof Dt)return new wt(t,e);throw E("To use ref(service, url), the first argument must be a Storage instance.")}return kt(t,e)}function Rt(t,e){var n=null==e?void 0:e.storageBucket;return null==n?null:V.makeFromBucketSpec(n,t)}var Dt=function(){function t(t,e,n,r,i,o){this.app=t,this._authProvider=e,this._appCheckProvider=n,this._pool=r,this._url=i,this._firebaseVersion=o,this._bucket=null,this._host=v,this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=i?V.makeFromBucketSpec(i,this._host):Rt(this._host,this.app.options)}return Object.defineProperty(t.prototype,"host",{get:function(){return this._host},set:function(t){this._host=t,this._bucket=null!=this._url?V.makeFromBucketSpec(this._url,t):Rt(t,this.app.options)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxUploadRetryTime",{get:function(){return this._maxUploadRetryTime},set:function(t){z("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxOperationRetryTime",{get:function(){return this._maxOperationRetryTime},set:function(t){z("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t},enumerable:!1,configurable:!0}),t.prototype._getAuthToken=function(){return(0,g.mG)(this,void 0,void 0,function(){var t,e;return(0,g.Jh)(this,function(n){switch(n.label){case 0:return(t=this._authProvider.getImmediate({optional:!0}))?[4,t.getToken()]:[3,2];case 1:if(null!==(e=n.sent()))return[2,e.accessToken];n.label=2;case 2:return[2,null]}})})},t.prototype._getAppCheckToken=function(){return(0,g.mG)(this,void 0,void 0,function(){var t;return(0,g.Jh)(this,function(e){switch(e.label){case 0:return(t=this._appCheckProvider.getImmediate({optional:!0}))?[4,t.getToken()]:[3,2];case 1:return[2,e.sent().token];case 2:return[2,null]}})})},t.prototype._delete=function(){return this._deleted=!0,this._requests.forEach(function(t){return t.cancel()}),this._requests.clear(),Promise.resolve()},t.prototype._makeStorageReference=function(t){return new wt(this,t)},t.prototype._makeRequest=function(t,e,n){var r=this;if(this._deleted)return new j(S());var i=function(t,e,n,r,i,o){var s=Q(t.urlParams),a=t.url+s,u=Object.assign({},t.headers);return function(t,e){e&&(t["X-Firebase-GMPID"]=e)}(u,e),function(t,e){null!==e&&e.length>0&&(t.Authorization="Firebase "+e)}(u,n),function(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(null!=e?e:"AppManager")}(u,o),function(t,e){null!==e&&(t["X-Firebase-AppCheck"]=e)}(u,r),new H(a,t.method,u,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,i)}(t,this._appId,e,n,this._pool,this._firebaseVersion);return this._requests.add(i),i.getPromise().then(function(){return r._requests.delete(i)},function(){return r._requests.delete(i)}),i},t.prototype.makeRequestWithTokens=function(t){return(0,g.mG)(this,void 0,void 0,function(){var e;return(0,g.Jh)(this,function(n){switch(n.label){case 0:return[4,Promise.all([this._getAuthToken(),this._getAppCheckToken()])];case 1:return e=n.sent(),[2,this._makeRequest(t,e[0],e[1])]}})})},t}();function Nt(t,e){return At(t=(0,y.m9)(t),e)}var xt,Ct,Ot=function(){function t(t,e,n){this._delegate=t,this.task=e,this.ref=n}return Object.defineProperty(t.prototype,"bytesTransferred",{get:function(){return this._delegate.bytesTransferred},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._delegate.state},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"totalBytes",{get:function(){return this._delegate.totalBytes},enumerable:!1,configurable:!0}),t}(),Pt=function(){function t(t,e){this._delegate=t,this._ref=e,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}return Object.defineProperty(t.prototype,"snapshot",{get:function(){return new Ot(this._delegate.snapshot,this,this._ref)},enumerable:!1,configurable:!0}),t.prototype.then=function(t,e){var n=this;return this._delegate.then(function(e){if(t)return t(new Ot(e,n,n._ref))},e)},t.prototype.on=function(t,e,n,r){var i=this,o=void 0;return e&&(o="function"==typeof e?function(t){return e(new Ot(t,i,i._ref))}:{next:e.next?function(t){return e.next(new Ot(t,i,i._ref))}:void 0,complete:e.complete||void 0,error:e.error||void 0}),this._delegate.on(t,o,n||void 0,r||void 0)},t}(),Lt=function(){function t(t,e){this._delegate=t,this._service=e}return Object.defineProperty(t.prototype,"prefixes",{get:function(){var t=this;return this._delegate.prefixes.map(function(e){return new Ft(e,t._service)})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"items",{get:function(){var t=this;return this._delegate.items.map(function(e){return new Ft(e,t._service)})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nextPageToken",{get:function(){return this._delegate.nextPageToken||null},enumerable:!1,configurable:!0}),t}(),Ft=function(){function t(t,e){this._delegate=t,this.storage=e}return Object.defineProperty(t.prototype,"name",{get:function(){return this._delegate.name},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bucket",{get:function(){return this._delegate.bucket},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fullPath",{get:function(){return this._delegate.fullPath},enumerable:!1,configurable:!0}),t.prototype.toString=function(){return this._delegate.toString()},t.prototype.child=function(e){return new t(function(t,e){return Et(t,e)}(this._delegate,e),this.storage)},Object.defineProperty(t.prototype,"root",{get:function(){return new t(this._delegate.root,this.storage)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){var e=this._delegate.parent;return null==e?null:new t(e,this.storage)},enumerable:!1,configurable:!0}),t.prototype.put=function(t,e){return this._throwIfRoot("put"),new Pt(function(t,e,n){return function(t,e,n){return t._throwIfRoot("uploadBytesResumable"),new bt(t,new Y(e),n)}(t=(0,y.m9)(t),e,n)}(this._delegate,t,e),this)},t.prototype.putString=function(t,e,n){void 0===e&&(e=D.RAW),this._throwIfRoot("putString");var r=x(e,t),i=(0,g.pi)({},n);return null==i.contentType&&null!=r.contentType&&(i.contentType=r.contentType),new Pt(new bt(this._delegate,new Y(r.data,!0),i),this)},t.prototype.listAll=function(){var t=this;return function(t){return _t(t=(0,y.m9)(t))}(this._delegate).then(function(e){return new Lt(e,t.storage)})},t.prototype.list=function(t){var e=this;return function(t,e){return It(t=(0,y.m9)(t),e)}(this._delegate,t||void 0).then(function(t){return new Lt(t,e.storage)})},t.prototype.getMetadata=function(){return function(t){return function(t){return(0,g.mG)(this,void 0,void 0,function(){var e;return(0,g.Jh)(this,function(n){switch(n.label){case 0:return t._throwIfRoot("getMetadata"),e=ft(t.storage,t._location,it()),[4,t.storage.makeRequestWithTokens(e)];case 1:return[2,n.sent().getPromise()]}})})}(t=(0,y.m9)(t))}(this._delegate)},t.prototype.updateMetadata=function(t){return function(t,e){return function(t,e){return(0,g.mG)(this,void 0,void 0,function(){var n;return(0,g.Jh)(this,function(r){switch(r.label){case 0:return t._throwIfRoot("updateMetadata"),n=function(t,e,n,r){var i=J(e.fullServerUrl(),t.host),o=st(n,r),s=t.maxOperationRetryTime,a=new at(i,"PATCH",ct(t,r),s);return a.headers={"Content-Type":"application/json; charset=utf-8"},a.body=o,a.errorHandler=lt(e),a}(t.storage,t._location,e,it()),[4,t.storage.makeRequestWithTokens(n)];case 1:return[2,r.sent().getPromise()]}})})}(t=(0,y.m9)(t),e)}(this._delegate,t)},t.prototype.getDownloadURL=function(){return function(t){return function(t){return(0,g.mG)(this,void 0,void 0,function(){var e;return(0,g.Jh)(this,function(n){switch(n.label){case 0:return t._throwIfRoot("getDownloadURL"),e=function(t,e,n){var r=J(e.fullServerUrl(),t.host),i=t.maxOperationRetryTime,o=new at(r,"GET",function(t,e){return function(n,r){var i=ot(t,r,e);return ut(null!==i),function(t,e,n){var r=$(e);if(null===r)return null;if(!G(r.downloadTokens))return null;var i=r.downloadTokens;if(0===i.length)return null;var o=encodeURIComponent;return i.split(",").map(function(e){var r=t.fullPath;return J("/b/"+o(t.bucket)+"/o/"+o(r),n)+Q({alt:"media",token:e})})[0]}(i,r,t.host)}}(t,n),i);return o.errorHandler=lt(e),o}(t.storage,t._location,it()),[4,t.storage.makeRequestWithTokens(e)];case 1:return[2,n.sent().getPromise().then(function(t){if(null===t)throw new b("no-download-url","The given file does not have any download URLs.");return t})]}})})}(t=(0,y.m9)(t))}(this._delegate)},t.prototype.delete=function(){return this._throwIfRoot("delete"),function(t){return function(t){return(0,g.mG)(this,void 0,void 0,function(){var e;return(0,g.Jh)(this,function(n){switch(n.label){case 0:return t._throwIfRoot("deleteObject"),e=function(t,e){var n=J(e.fullServerUrl(),t.host),r=new at(n,"DELETE",function(t,e){},t.maxOperationRetryTime);return r.successCodes=[200,204],r.errorHandler=lt(e),r}(t.storage,t._location),[4,t.storage.makeRequestWithTokens(e)];case 1:return[2,n.sent().getPromise()]}})})}(t=(0,y.m9)(t))}(this._delegate)},t.prototype._throwIfRoot=function(t){if(""===this._delegate._location.path)throw k(t)},t}(),Ut=function(){function t(t,e){var n=this;this.app=t,this._delegate=e,this.INTERNAL={delete:function(){return n._delegate._delete()}}}return Object.defineProperty(t.prototype,"maxOperationRetryTime",{get:function(){return this._delegate.maxOperationRetryTime},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxUploadRetryTime",{get:function(){return this._delegate.maxUploadRetryTime},enumerable:!1,configurable:!0}),t.prototype.ref=function(t){if(St(t))throw E("ref() expected a child path but got a URL, use refFromURL instead.");return new Ft(Nt(this._delegate,t),this)},t.prototype.refFromURL=function(t){if(!St(t))throw E("refFromURL() expected a full URL but got a child path, use ref() instead.");try{V.makeFromUrl(t,this._delegate.host)}catch(yg){throw E("refFromUrl() expected a valid full URL but got an invalid one.")}return new Ft(Nt(this._delegate,t),this)},t.prototype.setMaxUploadRetryTime=function(t){this._delegate.maxUploadRetryTime=t},t.prototype.setMaxOperationRetryTime=function(t){this._delegate.maxOperationRetryTime=t},t.prototype.useEmulator=function(t,e){!function(t,e,n){t.host="http://"+e+":"+n}(this._delegate,t,e)},t}();function Mt(t){const e=function(t){return new s.y(e=>{const n=t=>e.next(t);n(t.snapshot);const r=t.on("state_changed",n);return t.then(t=>{n(t),e.complete()},r=>{n(t.snapshot),(t=>{e.error(t)})(r)}),function(){r()}}).pipe((0,c.b)(0))}(t);return{task:t,then:t.then.bind(t),catch:t.catch.bind(t),pause:t.pause.bind(t),cancel:t.cancel.bind(t),resume:t.resume.bind(t),snapshotChanges:()=>e,percentageChanges:()=>e.pipe((0,h.U)(t=>t.bytesTransferred/t.totalBytes*100))}}function qt(t,e,n){return{getDownloadURL:()=>(0,a.of)(void 0).pipe((0,l.QV)(e.outsideAngular),(0,f.w)(()=>t.getDownloadURL()),n),getMetadata:()=>(0,a.of)(void 0).pipe((0,l.QV)(e.outsideAngular),(0,f.w)(()=>t.getMetadata()),n),delete:()=>(0,u.D)(t.delete()),child:r=>qt(t.child(r),e,n),updateMetadata:e=>(0,u.D)(t.updateMetadata(e)),put:(e,n)=>Mt(t.put(e,n)),putString:(e,n,r)=>Mt(t.putString(e,n,r)),listAll:()=>(0,u.D)(t.listAll())}}Ct={TaskState:L,TaskEvent:{STATE_CHANGED:"state_changed"},StringFormat:D,Storage:Dt,Reference:Ft},(xt=p.Z).INTERNAL.registerComponent(new m.wA("storage",function(t,e){var n=e.instanceIdentifier,r=t.getProvider("app").getImmediate(),i=t.getProvider("auth-internal"),o=t.getProvider("app-check-internal");return new Ut(r,new Dt(r,i,o,new q,n,p.Z.SDK_VERSION))},"PUBLIC").setServiceProps(Ct).setMultipleInstances(!0)),xt.registerVersion("@firebase/storage","0.6.0");const Vt=new o.OlP("angularfire2.storageBucket"),jt=new o.OlP("angularfire2.storage.maxUploadRetryTime"),Gt=new o.OlP("angularfire2.storage.maxOperationRetryTime");let Bt=(()=>{class t{constructor(t,e,n,r,i,o,s){this.schedulers=new d.HU(i),this.keepUnstableUntilFirst=(0,d.ss)(this.schedulers);const a=(0,d.on)(t,i,e);this.storage=(0,d.sI)(`${a.name}.storage.${n}`,"AngularFireStorage",a,()=>{const t=i.runOutsideAngular(()=>a.storage(n||void 0));return o&&t.setMaxUploadRetryTime(o),s&&t.setMaxOperationRetryTime(s),t},[o,s])}ref(t){return qt(this.storage.ref(t),this.schedulers,this.keepUnstableUntilFirst)}refFromURL(t){return qt(this.storage.refFromURL(t),this.schedulers,this.keepUnstableUntilFirst)}upload(t,e,n){return qt(this.storage.ref(t),this.schedulers,this.keepUnstableUntilFirst).put(e,n)}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(d.Dh),o.LFG(d.xv,8),o.LFG(Vt,8),o.LFG(o.Lbi),o.LFG(o.R0b),o.LFG(jt,8),o.LFG(Gt,8))},t.\u0275prov=o.Yz7({factory:function(){return new t(o.LFG(d.Dh),o.LFG(d.xv,8),o.LFG(Vt,8),o.LFG(o.Lbi),o.LFG(o.R0b),o.LFG(jt,8),o.LFG(Gt,8))},token:t,providedIn:"any"}),t})(),Kt=(()=>{class t{constructor(t){this.storage=t}ngOnInit(){}onFileSelected(t){var e=Date.now();const n=t.target.files[0],r=this.storage.ref(`RoomsImages/${e}`);this.storage.upload(`RoomsImages/${e}`,n).snapshotChanges().pipe((0,i.x)(()=>{this.downloadURL=r.getDownloadURL(),this.downloadURL.subscribe(t=>{t&&(this.fb=t),console.log(this.fb)})})).subscribe(t=>{t&&console.log(t)})}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(Bt))},t.\u0275cmp=o.Xpm({type:t,selectors:[["app-upload"]],decls:10,vars:0,consts:[[1,"js-upload","uk-placeholder","uk-text-center"],["uk-icon","icon: cloud-upload"],[1,"uk-text-middle"],["uk-form-custom",""],["type","file","multiple",""],["type","file","id","file","name","image","autocomplete","off",3,"change"],["userPhoto",""],[1,"uk-link"]],template:function(t,e){1&t&&(o.TgZ(0,"div",0),o._UZ(1,"span",1),o.TgZ(2,"span",2),o._uU(3,"Attach binaries by dropping them here or"),o.qZA(),o.TgZ(4,"div",3),o._UZ(5,"input",4),o.TgZ(6,"input",5,6),o.NdJ("change",function(t){return e.onFileSelected(t)}),o.qZA(),o.TgZ(8,"span",7),o._uU(9,"selecting one"),o.qZA(),o.qZA(),o.qZA())},styles:[""]}),t})();var zt=n(2238),Jt=n(3637),Qt=n(9761),Ht=n(9328),Wt=n(2145),Zt=n(7519),Xt=n(5435),Yt=n(2329),$t=n(300),te=function(t,e){return(te=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function ee(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var ne,re="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},ie=ie||{},oe=re||self;function se(){}function ae(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function ue(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var ce="closure_uid_"+(1e9*Math.random()>>>0),he=0;function le(t,e,n){return t.call.apply(t.bind,arguments)}function fe(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function de(t,e,n){return(de=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?le:fe).apply(null,arguments)}function pe(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function ge(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Vb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function ye(){this.s=this.s,this.o=this.o}var me={};ye.prototype.s=!1,ye.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var t=function(t){return Object.prototype.hasOwnProperty.call(t,ce)&&t[ce]||(t[ce]=++he)}(this);delete me[t]}},ye.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var ve=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},be=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function we(t){return Array.prototype.concat.apply([],arguments)}function _e(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function Te(t){return/^[\s\xa0]*$/.test(t)}var Ie,Ee=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Se(t,e){return-1!=t.indexOf(e)}function ke(t,e){return t<e?-1:t>e?1:0}t:{var Ae=oe.navigator;if(Ae){var Re=Ae.userAgent;if(Re){Ie=Re;break t}}Ie=""}function De(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function Ne(t){var e={};for(var n in t)e[n]=t[n];return e}var xe="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ce(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<xe.length;o++)n=xe[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function Oe(t){return Oe[" "](t),t}Oe[" "]=se;var Pe,Le,Fe=Se(Ie,"Opera"),Ue=Se(Ie,"Trident")||Se(Ie,"MSIE"),Me=Se(Ie,"Edge"),qe=Me||Ue,Ve=Se(Ie,"Gecko")&&!(Se(Ie.toLowerCase(),"webkit")&&!Se(Ie,"Edge"))&&!(Se(Ie,"Trident")||Se(Ie,"MSIE"))&&!Se(Ie,"Edge"),je=Se(Ie.toLowerCase(),"webkit")&&!Se(Ie,"Edge");function Ge(){var t=oe.document;return t?t.documentMode:void 0}t:{var Be="",Ke=(Le=Ie,Ve?/rv:([^\);]+)(\)|;)/.exec(Le):Me?/Edge\/([\d\.]+)/.exec(Le):Ue?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Le):je?/WebKit\/(\S+)/.exec(Le):Fe?/(?:Version)[ \/]?(\S+)/.exec(Le):void 0);if(Ke&&(Be=Ke?Ke[1]:""),Ue){var ze=Ge();if(null!=ze&&ze>parseFloat(Be)){Pe=String(ze);break t}}Pe=Be}var Je={};var Qe=oe.document&&Ue&&(Ge()||parseInt(Pe,10))||void 0,He=function(){if(!oe.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{oe.addEventListener("test",se,e),oe.removeEventListener("test",se,e)}catch(n){}return t}();function We(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}function Ze(t,e){if(We.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(Ve){t:{try{Oe(e.nodeName);var i=!0;break t}catch(o){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Xe[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&Ze.Z.h.call(this)}}We.prototype.h=function(){this.defaultPrevented=!0},ge(Ze,We);var Xe={2:"touch",3:"pen",4:"mouse"};Ze.prototype.h=function(){Ze.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var Ye="closure_listenable_"+(1e6*Math.random()|0),$e=0;function tn(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ia=i,this.key=++$e,this.ca=this.fa=!1}function en(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function nn(t){this.src=t,this.g={},this.h=0}function rn(t,e){var n=e.type;if(n in t.g){var r,i=t.g[n],o=ve(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(en(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function on(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.ca&&o.listener==e&&o.capture==!!n&&o.ia==r)return i}return-1}nn.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.g[o])||(t=this.g[o]=[],this.h++);var s=on(t,e,r,i);return-1<s?(e=t[s],n||(e.fa=!1)):((e=new tn(e,this.src,o,!!r,i)).fa=n,t.push(e)),e};var sn="closure_lm_"+(1e6*Math.random()|0),an={};function un(t,e,n,r,i){if(r&&r.once)return hn(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)un(t,e[o],n,r,i);return null}return n=mn(n),t&&t[Ye]?t.N(e,n,ue(r)?!!r.capture:!!r,i):cn(t,e,n,!1,r,i)}function cn(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=ue(i)?!!i.capture:!!i,a=gn(t);if(a||(t[sn]=a=new nn(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=pn;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)He||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(dn(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function hn(t,e,n,r,i){if(Array.isArray(e)){for(var o=0;o<e.length;o++)hn(t,e[o],n,r,i);return null}return n=mn(n),t&&t[Ye]?t.O(e,n,ue(r)?!!r.capture:!!r,i):cn(t,e,n,!0,r,i)}function ln(t,e,n,r,i){if(Array.isArray(e))for(var o=0;o<e.length;o++)ln(t,e[o],n,r,i);else r=ue(r)?!!r.capture:!!r,n=mn(n),t&&t[Ye]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=on(o=t.g[e],n,r,i))&&(en(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.g[e],t.h--))):t&&(t=gn(t))&&(e=t.g[e.toString()],t=-1,e&&(t=on(e,n,r,i)),(n=-1<t?e[t]:null)&&fn(n))}function fn(t){if("number"!=typeof t&&t&&!t.ca){var e=t.src;if(e&&e[Ye])rn(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(dn(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=gn(e))?(rn(n,t),0==n.h&&(n.src=null,e[sn]=null)):en(t)}}}function dn(t){return t in an?an[t]:an[t]="on"+t}function pn(t,e){if(t.ca)t=!0;else{e=new Ze(e,this);var n=t.listener,r=t.ia||t.src;t.fa&&fn(t),t=n.call(r,e)}return t}function gn(t){return(t=t[sn])instanceof nn?t:null}var yn="__closure_events_fn_"+(1e9*Math.random()>>>0);function mn(t){return"function"==typeof t?t:(t[yn]||(t[yn]=function(e){return t.handleEvent(e)}),t[yn])}function vn(){ye.call(this),this.i=new nn(this),this.P=this,this.I=null}function bn(t,e){var n,r=t.I;if(r)for(n=[];r;r=r.I)n.push(r);if(t=t.P,r=e.type||e,"string"==typeof e)e=new We(e,t);else if(e instanceof We)e.target=e.target||t;else{var i=e;Ce(e=new We(r,t),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=e.g=n[o];i=wn(s,r,!0,e)&&i}if(i=wn(s=e.g=t,r,!0,e)&&i,i=wn(s,r,!1,e)&&i,n)for(o=0;o<n.length;o++)i=wn(s=e.g=n[o],r,!1,e)&&i}function wn(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.ca&&s.capture==n){var a=s.listener,u=s.ia||s.src;s.fa&&rn(t.i,s),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}ge(vn,ye),vn.prototype[Ye]=!0,vn.prototype.removeEventListener=function(t,e,n,r){ln(this,t,e,n,r)},vn.prototype.M=function(){if(vn.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)en(n[r]);delete e.g[t],e.h--}}this.I=null},vn.prototype.N=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},vn.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var _n=oe.JSON.stringify;function Tn(){var t=Nn,e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var In,En=function(){function t(){this.h=this.g=null}return t.prototype.add=function(t,e){var n=Sn.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n},t}(),Sn=new(function(){function t(t,e){this.i=t,this.j=e,this.h=0,this.g=null}return t.prototype.get=function(){var t;return 0<this.h?(this.h--,this.g=(t=this.g).next,t.next=null):t=this.i(),t},t}())(function(){return new kn},function(t){return t.reset()}),kn=function(){function t(){this.next=this.g=this.h=null}return t.prototype.set=function(t,e){this.h=t,this.g=e,this.next=null},t.prototype.reset=function(){this.next=this.g=this.h=null},t}();function An(t){oe.setTimeout(function(){throw t},0)}function Rn(t,e){In||function(){var t=oe.Promise.resolve(void 0);In=function(){t.then(xn)}}(),Dn||(In(),Dn=!0),Nn.add(t,e)}var Dn=!1,Nn=new En;function xn(){for(var t;t=Tn();){try{t.h.call(t.g)}catch(n){An(n)}var e=Sn;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}Dn=!1}function Cn(t,e){vn.call(this),this.h=t||1,this.g=e||oe,this.j=de(this.kb,this),this.l=Date.now()}function On(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}function Pn(t,e,n){if("function"==typeof t)n&&(t=de(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=de(t.handleEvent,t)}return 2147483647<Number(e)?-1:oe.setTimeout(t,e||0)}function Ln(t){t.g=Pn(function(){t.g=null,t.i&&(t.i=!1,Ln(t))},t.j);var e=t.h;t.h=null,t.m.apply(null,e)}ge(Cn,vn),(ne=Cn.prototype).da=!1,ne.S=null,ne.kb=function(){if(this.da){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),bn(this,"tick"),this.da&&(On(this),this.start()))}},ne.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},ne.M=function(){Cn.Z.M.call(this),On(this),delete this.g};var Fn=function(t){function e(e,n){var r=t.call(this)||this;return r.m=e,r.j=n,r.h=null,r.i=!1,r.g=null,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}te(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.l=function(t){this.h=arguments,this.g?this.i=!0:Ln(this)},e.prototype.M=function(){t.prototype.M.call(this),this.g&&(oe.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)},e}(ye);function Un(t){ye.call(this),this.h=t,this.g={}}ge(Un,ye);var Mn=[];function qn(t,e,n,r){Array.isArray(n)||(n&&(Mn[0]=n.toString()),n=Mn);for(var i=0;i<n.length;i++){var o=un(e,n[i],r||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}}function Vn(t){De(t.g,function(t,e){this.g.hasOwnProperty(e)&&fn(t)},t),t.g={}}function jn(){this.g=!0}function Gn(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return _n(n)}catch(a){return e}}(t,n)+(r?" "+r:"")})}Un.prototype.M=function(){Un.Z.M.call(this),Vn(this)},Un.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},jn.prototype.Aa=function(){this.g=!1},jn.prototype.info=function(){};var Bn={},Kn=null;function zn(){return Kn=Kn||new vn}function Jn(t){We.call(this,Bn.Ma,t)}function Qn(t){var e=zn();bn(e,new Jn(e,t))}function Hn(t,e){We.call(this,Bn.STAT_EVENT,t),this.stat=e}function Wn(t){var e=zn();bn(e,new Hn(e,t))}function Zn(t,e){We.call(this,Bn.Na,t),this.size=e}function Xn(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return oe.setTimeout(function(){t()},e)}Bn.Ma="serverreachability",ge(Jn,We),Bn.STAT_EVENT="statevent",ge(Hn,We),Bn.Na="timingevent",ge(Zn,We);var Yn={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},$n={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function tr(){}function er(){}tr.prototype.h=null;var nr,rr={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function ir(){We.call(this,"d")}function or(){We.call(this,"c")}function sr(){}function ar(t,e,n,r){this.l=t,this.j=e,this.m=n,this.X=r||1,this.V=new Un(this),this.P=cr,this.W=new Cn(t=qe?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new ur}function ur(){this.i=null,this.g="",this.h=!1}ge(ir,We),ge(or,We),ge(sr,tr),sr.prototype.g=function(){return new XMLHttpRequest},sr.prototype.i=function(){return{}},nr=new sr;var cr=45e3,hr={},lr={};function fr(t,e,n){t.K=1,t.v=Lr(Dr(e)),t.s=n,t.U=!0,dr(t,null)}function dr(t,e){t.F=Date.now(),mr(t),t.A=Dr(t.v);var n=t.A,r=t.X;Array.isArray(r)||(r=[String(r)]),Hr(n.h,"t",r),t.C=0,n=t.l.H,t.h=new ur,t.g=Wi(t.l,n?e:null,!t.s),0<t.O&&(t.L=new Fn(de(t.Ia,t,t.g),t.O)),qn(t.V,t.g,"readystatechange",t.gb),e=t.H?Ne(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),Qn(1),function(t,e,n,r,i,o){t.info(function(){if(t.g)if(o)for(var s="",a=o.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var h=c[0];c=c[1];var l=h.split("_");s=2<=l.length&&"type"==l[1]?s+(h+"=")+c+"&":s+(h+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+s})}(t.j,t.u,t.A,t.m,t.X,t.s)}function pr(t){return!!t.g&&"GET"==t.u&&2!=t.K&&t.l.Ba}function gr(t,e,n){for(var r,i=!0;!t.I&&t.C<n.length;){if((r=yr(t,n))==lr){4==e&&(t.o=4,Wn(14),i=!1),Gn(t.j,t.m,null,"[Incomplete Response]");break}if(r==hr){t.o=4,Wn(15),Gn(t.j,t.m,n,"[Invalid Chunk]"),i=!1;break}Gn(t.j,t.m,r,null),Tr(t,r)}pr(t)&&r!=lr&&r!=hr&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,Wn(16),i=!1),t.i=t.i&&i,i?0<n.length&&!t.aa&&(t.aa=!0,(e=t.l).g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),ji(e),e.L=!0,Wn(11))):(Gn(t.j,t.m,n,"[Invalid Chunked Response]"),_r(t),wr(t))}function yr(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?lr:(n=Number(e.substring(n,r)),isNaN(n)?hr:(r+=1)+n>e.length?lr:(e=e.substr(r,n),t.C=r+n,e))}function mr(t){t.Y=Date.now()+t.P,vr(t,t.P)}function vr(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=Xn(de(t.eb,t),e)}function br(t){t.B&&(oe.clearTimeout(t.B),t.B=null)}function wr(t){0==t.l.G||t.I||Ki(t.l,t)}function _r(t){br(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,On(t.W),Vn(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function Tr(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||ei(n.i,t)))if(n.I=t.N,!t.J&&ei(n.i,t)&&3==n.G){try{var r=n.Ca.g.parse(e)}catch(o){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;Bi(n),Ci(n)}Vi(n),Wn(18)}}else n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&0==n.A&&!n.v&&(n.v=Xn(de(n.ab,n),6e3));if(1>=ti(n.i)&&n.ka){try{n.ka()}catch(o){}n.ka=void 0}}else Ji(n,11)}else if((t.J||n.g==t)&&Bi(n),!Te(e))for(i=n.Ca.g.parse(e),e=0;e<i.length;e++){var o=i[e];if(n.U=o[0],o=o[1],2==n.G)if("c"==o[0]){n.J=o[1],n.la=o[2];var s=o[3];null!=s&&(n.ma=s,n.h.info("VER="+n.ma));var a=o[4];null!=a&&(n.za=a,n.h.info("SVER="+n.za));var u=o[5];null!=u&&"number"==typeof u&&0<u&&(n.K=r=1.5*u,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;var c=t.g;if(c){var h=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=r.i;!l.g&&(Se(h,"spdy")||Se(h,"quic")||Se(h,"h2"))&&(l.j=l.l,l.g=new Set,l.h&&(ni(l,l.h),l.h=null))}if(r.D){var f=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null;f&&(r.sa=f,Pr(r.F,r.D,f))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-t.F,n.h.info("Handshake RTT: "+n.O+"ms"));var d=t;if((r=n).oa=Hi(r,r.H?r.la:null,r.W),d.J){ri(r.i,d);var p=d,g=r.K;g&&p.setTimeout(g),p.B&&(br(p),mr(p)),r.g=d}else qi(r);0<n.l.length&&Li(n)}else"stop"!=o[0]&&"close"!=o[0]||Ji(n,7);else 3==n.G&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?Ji(n,7):xi(n):"noop"!=o[0]&&n.j&&n.j.wa(o),n.A=0)}Qn(4)}catch(o){}}function Ir(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(ae(t)||"string"==typeof t)be(t,e,void 0);else{if(t.T&&"function"==typeof t.T)var n=t.T();else if(t.R&&"function"==typeof t.R)n=void 0;else if(ae(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.R&&"function"==typeof t.R)return t.R();if("string"==typeof t)return t.split("");if(ae(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Er(t,e){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Er)for(n=t.T(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Sr(t){if(t.i!=t.g.length){for(var e=0,n=0;e<t.g.length;){var r=t.g[e];kr(t.h,r)&&(t.g[n++]=r),e++}t.g.length=n}if(t.i!=t.g.length){var i={};for(n=e=0;e<t.g.length;)kr(i,r=t.g[e])||(t.g[n++]=r,i[r]=1),e++;t.g.length=n}}function kr(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(ne=ar.prototype).setTimeout=function(t){this.P=t},ne.gb=function(t){t=t.target;var e=this.L;e&&3==ki(t)?e.l():this.Ia(t)},ne.Ia=function(t){try{if(t==this.g)t:{var e=ki(this.g),n=this.g.Da(),r=this.g.ba();if(!(3>e)&&(3!=e||qe||this.g&&(this.h.h||this.g.ga()||Ai(this.g)))){this.I||4!=e||7==n||Qn(8==n||0>=r?3:2),br(this);var i=this.g.ba();this.N=i;e:if(pr(this)){var o=Ai(this.g);t="";var s=o.length,a=4==ki(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){_r(this),wr(this);var u="";break e}this.h.i=new oe.TextDecoder}for(n=0;n<s;n++)this.h.h=!0,t+=this.h.i.decode(o[n],{stream:a&&n==s-1});o.splice(0,s),this.h.g+=t,this.C=0,u=this.h.g}else u=this.g.ga();if(this.i=200==i,function(t,e,n,r,i,o,s){t.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+o+" "+s})}(this.j,this.u,this.A,this.m,this.X,e,i),this.i){if(this.$&&!this.J){e:{if(this.g){var c,h=this.g;if((c=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Te(c)){var l=c;break e}}l=null}if(!(i=l)){this.i=!1,this.o=3,Wn(12),_r(this),wr(this);break t}Gn(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Tr(this,i)}this.U?(gr(this,e,u),qe&&this.i&&3==e&&(qn(this.V,this.W,"tick",this.fb),this.W.start())):(Gn(this.j,this.m,u,null),Tr(this,u)),4==e&&_r(this),this.i&&!this.I&&(4==e?Ki(this.l,this):(this.i=!1,mr(this)))}else 400==i&&0<u.indexOf("Unknown SID")?(this.o=3,Wn(12)):(this.o=0,Wn(13)),_r(this),wr(this)}}}catch(e){}},ne.fb=function(){if(this.g){var t=ki(this.g),e=this.g.ga();this.C<e.length&&(br(this),gr(this,t,e),this.i&&4!=t&&mr(this))}},ne.cancel=function(){this.I=!0,_r(this)},ne.eb=function(){this.B=null;var t=Date.now();0<=t-this.Y?(function(t,e){t.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.K&&(Qn(3),Wn(17)),_r(this),this.o=2,wr(this)):vr(this,this.Y-t)},(ne=Er.prototype).R=function(){Sr(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t},ne.T=function(){return Sr(this),this.g.concat()},ne.get=function(t,e){return kr(this.h,t)?this.h[t]:e},ne.set=function(t,e){kr(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e},ne.forEach=function(t,e){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Ar=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Rr(t,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof Rr){this.g=void 0!==e?e:t.g,Nr(this,t.j),this.s=t.s,xr(this,t.i),Cr(this,t.m),this.l=t.l,e=t.h;var n=new Kr;n.i=e.i,e.g&&(n.g=new Er(e.g),n.h=e.h),Or(this,n),this.o=t.o}else t&&(n=String(t).match(Ar))?(this.g=!!e,Nr(this,n[1]||"",!0),this.s=Fr(n[2]||""),xr(this,n[3]||"",!0),Cr(this,n[4]),this.l=Fr(n[5]||"",!0),Or(this,n[6]||"",!0),this.o=Fr(n[7]||"")):(this.g=!!e,this.h=new Kr(null,this.g))}function Dr(t){return new Rr(t)}function Nr(t,e,n){t.j=n?Fr(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function xr(t,e,n){t.i=n?Fr(e,!0):e}function Cr(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function Or(t,e,n){e instanceof Kr?(t.h=e,function(t,e){e&&!t.j&&(zr(t),t.i=null,t.g.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(Jr(this,e),Hr(this,n,t))},t)),t.j=e}(t.h,t.g)):(n||(e=Ur(e,Gr)),t.h=new Kr(e,t.g))}function Pr(t,e,n){t.h.set(e,n)}function Lr(t){return Pr(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function Fr(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Ur(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,Mr),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Mr(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Rr.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Ur(e,qr,!0),":");var n=this.i;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(Ur(e,qr,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&t.push("/"),t.push(Ur(n,"/"==n.charAt(0)?jr:Vr,!0))),(n=this.h.toString())&&t.push("?",n),(n=this.o)&&t.push("#",Ur(n,Br)),t.join("")};var qr=/[#\/\?@]/g,Vr=/[#\?:]/g,jr=/[#\?]/g,Gr=/[#\?@]/g,Br=/#/g;function Kr(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function zr(t){t.g||(t.g=new Er,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.i,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function Jr(t,e){zr(t),e=Wr(t,e),kr(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,kr((t=t.g).h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&Sr(t)))}function Qr(t,e){return zr(t),e=Wr(t,e),kr(t.g.h,e)}function Hr(t,e,n){Jr(t,e),0<n.length&&(t.i=null,t.g.set(Wr(t,e),_e(n)),t.h+=n.length)}function Wr(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(ne=Kr.prototype).add=function(t,e){zr(this),this.i=null,t=Wr(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},ne.forEach=function(t,e){zr(this),this.g.forEach(function(n,r){be(n,function(n){t.call(e,n,r,this)},this)},this)},ne.T=function(){zr(this);for(var t=this.g.R(),e=this.g.T(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},ne.R=function(t){zr(this);var e=[];if("string"==typeof t)Qr(this,t)&&(e=we(e,this.g.get(Wr(this,t))));else{t=this.g.R();for(var n=0;n<t.length;n++)e=we(e,t[n])}return e},ne.set=function(t,e){return zr(this),this.i=null,Qr(this,t=Wr(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},ne.get=function(t,e){return t&&0<(t=this.R(t)).length?String(t[0]):e},ne.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.R(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.i=t.join("&")};var Zr=function(t,e){this.h=t,this.g=e};function Xr(t){this.l=t||Yr,t=oe.PerformanceNavigationTiming?0<(t=oe.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(oe.g&&oe.g.Ea&&oe.g.Ea()&&oe.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Yr=10;function $r(t){return!!t.h||!!t.g&&t.g.size>=t.j}function ti(t){return t.h?1:t.g?t.g.size:0}function ei(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function ni(t,e){t.g?t.g.add(e):t.h=e}function ri(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function ii(t){var e,n;if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){var r=t.i;try{for(var i=ee(t.g.values()),o=i.next();!o.done;o=i.next())r=r.concat(o.value.D)}catch(s){e={error:s}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return _e(t.i)}function oi(){}function si(){this.g=new oi}function ai(t,e,n){var r=n||"";try{Ir(t,function(t,n){var i=t;ue(t)&&(i=_n(t)),e.push(r+n+"="+encodeURIComponent(i))})}catch(yg){throw e.push(r+"type="+encodeURIComponent("_badmap")),yg}}function ui(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(o){}}function ci(t){this.l=t.$b||null,this.j=t.ib||!1}function hi(t,e){vn.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=li,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Xr.prototype.cancel=function(){var t,e;if(this.i=ii(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){try{for(var n=ee(this.g.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(i){t={error:i}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.g.clear()}},oi.prototype.stringify=function(t){return oe.JSON.stringify(t,void 0)},oi.prototype.parse=function(t){return oe.JSON.parse(t,void 0)},ge(ci,tr),ci.prototype.g=function(){return new hi(this.l,this.j)},ci.prototype.i=function(t){return function(){return t}}({}),ge(hi,vn);var li=0;function fi(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}function di(t){t.readyState=4,t.l=null,t.j=null,t.A=null,pi(t)}function pi(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(ne=hi.prototype).open=function(t,e){if(this.readyState!=li)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,pi(this)},ne.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||oe).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},ne.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,di(this)),this.readyState=li},ne.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,pi(this)),this.g&&(this.readyState=3,pi(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==oe.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;fi(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))},ne.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?di(this):pi(this),3==this.readyState&&fi(this)}},ne.Ua=function(t){this.g&&(this.response=this.responseText=t,di(this))},ne.Ta=function(t){this.g&&(this.response=t,di(this))},ne.ha=function(){this.g&&di(this)},ne.setRequestHeader=function(t,e){this.v.append(t,e)},ne.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},ne.getAllResponseHeaders=function(){if(!this.h)return"";for(var t=[],e=this.h.entries(),n=e.next();!n.done;)t.push((n=n.value)[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(hi.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var gi=oe.JSON.parse;function yi(t){vn.call(this),this.headers=new Er,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=mi,this.K=this.L=!1}ge(yi,vn);var mi="",vi=/^https?$/i,bi=["POST","PUT"];function wi(t){return"content-type"==t.toLowerCase()}function _i(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Ti(t),Ei(t)}function Ti(t){t.D||(t.D=!0,bn(t,"complete"),bn(t,"error"))}function Ii(t){if(t.h&&void 0!==ie&&(!t.C[1]||4!=ki(t)||2!=t.ba()))if(t.v&&4==ki(t))Pn(t.Fa,0,t);else if(bn(t,"readystatechange"),4==ki(t)){t.h=!1;try{var e,n=t.ba();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.H).match(Ar)[1]||null;if(!o&&oe.self&&oe.self.location){var s=oe.self.location.protocol;o=s.substr(0,s.length-1)}i=!vi.test(o?o.toLowerCase():"")}e=i}if(e)bn(t,"complete"),bn(t,"success");else{t.m=6;try{var a=2<ki(t)?t.g.statusText:""}catch(u){a=""}t.j=a+" ["+t.ba()+"]",Ti(t)}}finally{Ei(t)}}}function Ei(t,e){if(t.g){Si(t);var n=t.g,r=t.C[0]?se:null;t.g=null,t.C=null,e||bn(t,"ready");try{n.onreadystatechange=r}catch(yg){}}}function Si(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(oe.clearTimeout(t.A),t.A=null)}function ki(t){return t.g?t.g.readyState:0}function Ai(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case mi:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Ri(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return De(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Pr(t,e,n))}function Di(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Ni(t){this.za=0,this.l=[],this.h=new jn,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Di("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Di("baseRetryDelayMs",5e3,t),this.$a=Di("retryDelaySeedMs",1e4,t),this.Ya=Di("forwardChannelMaxRetries",2,t),this.ra=Di("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new Xr(t&&t.concurrentRequestLimit),this.Ca=new si,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||!1!==t.Xb}function xi(t){if(Oi(t),3==t.G){var e=t.V++,n=Dr(t.F);Pr(n,"SID",t.J),Pr(n,"RID",e),Pr(n,"TYPE","terminate"),Ui(t,n),(e=new ar(t,t.h,e,void 0)).K=2,e.v=Lr(Dr(n)),n=!1,oe.navigator&&oe.navigator.sendBeacon&&(n=oe.navigator.sendBeacon(e.v.toString(),"")),!n&&oe.Image&&((new Image).src=e.v,n=!0),n||(e.g=Wi(e.l,null),e.g.ea(e.v)),e.F=Date.now(),mr(e)}Qi(t)}function Ci(t){t.g&&(ji(t),t.g.cancel(),t.g=null)}function Oi(t){Ci(t),t.u&&(oe.clearTimeout(t.u),t.u=null),Bi(t),t.i.cancel(),t.m&&("number"==typeof t.m&&oe.clearTimeout(t.m),t.m=null)}function Pi(t,e){t.l.push(new Zr(t.Za++,e)),3==t.G&&Li(t)}function Li(t){$r(t.i)||t.m||(t.m=!0,Rn(t.Ha,t),t.C=0)}function Fi(t,e){var n;n=e?e.m:t.V++;var r=Dr(t.F);Pr(r,"SID",t.J),Pr(r,"RID",n),Pr(r,"AID",t.U),Ui(t,r),t.o&&t.s&&Ri(r,t.o,t.s),n=new ar(t,t.h,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.l=e.D.concat(t.l)),e=Mi(t,n,1e3),n.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),ni(t.i,n),fr(n,r,e)}function Ui(t,e){t.j&&Ir({},function(t,n){Pr(e,n,t)})}function Mi(t,e,n){n=Math.min(t.l.length,n);var r=t.j?de(t.j.Oa,t.j,t):null;t:for(var i=t.l,o=-1;;){var s=["count="+n];-1==o?0<n?s.push("ofs="+(o=i[0].h)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].h,h=i[u].g;if(0>(c-=o))o=Math.max(0,i[u].h-100),a=!1;else try{ai(h,s,"req"+c+"_")}catch(Do){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.l.splice(0,n),e.D=t,r}function qi(t){t.g||t.u||(t.Y=1,Rn(t.Ga,t),t.A=0)}function Vi(t){return!(t.g||t.u||3<=t.A||(t.Y++,t.u=Xn(de(t.Ga,t),zi(t,t.A)),t.A++,0))}function ji(t){null!=t.B&&(oe.clearTimeout(t.B),t.B=null)}function Gi(t){t.g=new ar(t,t.h,"rpc",t.Y),null===t.o&&(t.g.H=t.s),t.g.O=0;var e=Dr(t.oa);Pr(e,"RID","rpc"),Pr(e,"SID",t.J),Pr(e,"CI",t.N?"0":"1"),Pr(e,"AID",t.U),Ui(t,e),Pr(e,"TYPE","xmlhttp"),t.o&&t.s&&Ri(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.la,n.K=1,n.v=Lr(Dr(e)),n.s=null,n.U=!0,dr(n,t)}function Bi(t){null!=t.v&&(oe.clearTimeout(t.v),t.v=null)}function Ki(t,e){var n=null;if(t.g==e){Bi(t),ji(t),t.g=null;var r=2}else{if(!ei(t.i,e))return;n=e.D,ri(t.i,e),r=1}if(t.I=e.N,0!=t.G)if(e.i)if(1==r){n=e.s?e.s.length:0,e=Date.now()-e.F;var i=t.C;bn(r=zn(),new Zn(r,n,e,i)),Li(t)}else qi(t);else if(3==(i=e.o)||0==i&&0<t.I||!(1==r&&function(t,e){return!(ti(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.l=e.D.concat(t.l),0):1==t.G||2==t.G||t.C>=(t.Xa?0:t.Ya)||(t.m=Xn(de(t.Ha,t,e),zi(t,t.C)),t.C++,0)))}(t,e)||2==r&&Vi(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),i){case 1:Ji(t,5);break;case 4:Ji(t,10);break;case 3:Ji(t,6);break;default:Ji(t,2)}}function zi(t,e){var n=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(n*=2),n*e}function Ji(t,e){if(t.h.info("Error code "+e),2==e){var n=null;t.j&&(n=null);var r=de(t.jb,t);n||(n=new Rr("//www.google.com/images/cleardot.gif"),oe.location&&"http"==oe.location.protocol||Nr(n,"https"),Lr(n)),function(t,e){var n=new jn;if(oe.Image){var r=new Image;r.onload=pe(ui,n,r,"TestLoadImage: loaded",!0,e),r.onerror=pe(ui,n,r,"TestLoadImage: error",!1,e),r.onabort=pe(ui,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=pe(ui,n,r,"TestLoadImage: timeout",!1,e),oe.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else Wn(2);t.G=0,t.j&&t.j.va(e),Qi(t),Oi(t)}function Qi(t){t.G=0,t.I=-1,t.j&&(0==ii(t.i).length&&0==t.l.length||(t.i.i.length=0,_e(t.l),t.l.length=0),t.j.ua())}function Hi(t,e,n){var r=function(t){return t instanceof Rr?Dr(t):new Rr(t,void 0)}(n);if(""!=r.i)e&&xr(r,e+"."+r.i),Cr(r,r.m);else{var i=oe.location;r=function(t,e,n,r){var i=new Rr(null,void 0);return t&&Nr(i,t),e&&xr(i,e),n&&Cr(i,n),r&&(i.l=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.aa&&De(t.aa,function(t,e){Pr(r,e,t)}),n=t.sa,(e=t.D)&&n&&Pr(r,e,n),Pr(r,"VER",t.ma),Ui(t,r),r}function Wi(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new yi(n&&t.Ba&&!t.qa?new ci({ib:!0}):t.qa)).L=t.H,e}function Zi(){}function Xi(){if(Ue&&!(10<=Number(Qe)))throw Error("Environmental error: no available transport.")}function Yi(t,e){vn.call(this),this.g=new Ni(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!Te(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Te(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new eo(this)}function $i(t){ir.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function to(){or.call(this),this.status=1}function eo(t){this.g=t}(ne=yi.prototype).ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():nr.g(),this.C=function(t){return t.h||(t.h=t.i())}(this.u?this.u:nr),this.g.onreadystatechange=de(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(o){return void _i(this,o)}t=n||"";var i=new Er(this.headers);r&&Ir(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=wi,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.T()),n=oe.FormData&&t instanceof oe.FormData,!(0<=ve(bi,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.g.setRequestHeader(e,t)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Si(this),0<this.B&&((this.K=function(t){return Ue&&function(){return t=Je,Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=function(){for(var t=0,e=Ee(String(Pe)).split("."),n=Ee("9").split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=ke(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||ke(0==o[2].length,0==s[2].length)||ke(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t}();var t}()&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=de(this.pa,this)):this.A=Pn(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(o){_i(this,o)}},ne.pa=function(){void 0!==ie&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,bn(this,"timeout"),this.abort(8))},ne.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,bn(this,"complete"),bn(this,"abort"),Ei(this))},ne.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Ei(this,!0)),yi.Z.M.call(this)},ne.Fa=function(){this.s||(this.F||this.v||this.l?Ii(this):this.cb())},ne.cb=function(){Ii(this)},ne.ba=function(){try{return 2<ki(this)?this.g.status:-1}catch(Le){return-1}},ne.ga=function(){try{return this.g?this.g.responseText:""}catch(Le){return""}},ne.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),gi(e)}},ne.Da=function(){return this.m},ne.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(ne=Ni.prototype).ma=8,ne.G=1,ne.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch(e){}},ne.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;var e=new ar(this,this.h,t,void 0),n=this.s;if(this.P&&(n?Ce(n=Ne(n),this.P):n=this.P),null===this.o&&(e.H=n),this.ja)t:{for(var r=0,i=0;i<this.l.length;i++){var o=this.l[i];if(void 0===(o="__data__"in o.g&&"string"==typeof(o=o.g.__data__)?o.length:void 0))break;if(4096<(r+=o)){r=i;break t}if(4096===r||i===this.l.length-1){r=i+1;break t}}r=1e3}else r=1e3;r=Mi(this,e,r),Pr(i=Dr(this.F),"RID",t),Pr(i,"CVER",22),this.D&&Pr(i,"X-HTTP-Session-Id",this.D),Ui(this,i),this.o&&n&&Ri(i,this.o,n),ni(this.i,e),this.Ra&&Pr(i,"TYPE","init"),this.ja?(Pr(i,"$req",r),Pr(i,"SID","null"),e.$=!0,fr(e,i,null)):fr(e,i,r),this.G=2}}else 3==this.G&&(t?Fi(this,t):0==this.l.length||$r(this.i)||Fi(this))},ne.Ga=function(){if(this.u=null,Gi(this),this.$&&!(this.L||null==this.g||0>=this.O)){var t=2*this.O;this.h.info("BP detection timer enabled: "+t),this.B=Xn(de(this.bb,this),t)}},ne.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,Wn(10),Ci(this),Gi(this))},ne.ab=function(){null!=this.v&&(this.v=null,Ci(this),Vi(this),Wn(19))},ne.jb=function(t){t?(this.h.info("Successfully pinged google.com"),Wn(2)):(this.h.info("Failed to ping google.com"),Wn(1))},(ne=Zi.prototype).xa=function(){},ne.wa=function(){},ne.va=function(){},ne.ua=function(){},ne.Oa=function(){},Xi.prototype.g=function(t,e){return new Yi(t,e)},ge(Yi,vn),Yi.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),Rn(de(t.hb,t,e))),Wn(0),t.W=e,t.aa=n||{},t.N=t.X,t.F=Hi(t,null,t.W),Li(t)},Yi.prototype.close=function(){xi(this.g)},Yi.prototype.u=function(t){if("string"==typeof t){var e={};e.__data__=t,Pi(this.g,e)}else this.v?((e={}).__data__=_n(t),Pi(this.g,e)):Pi(this.g,t)},Yi.prototype.M=function(){this.g.j=null,delete this.j,xi(this.g),delete this.g,Yi.Z.M.call(this)},ge($i,ir),ge(to,or),ge(eo,Zi),eo.prototype.xa=function(){bn(this.g,"a")},eo.prototype.wa=function(t){bn(this.g,new $i(t))},eo.prototype.va=function(t){bn(this.g,new to(t))},eo.prototype.ua=function(){bn(this.g,"b")},Xi.prototype.createWebChannel=Xi.prototype.g,Yi.prototype.send=Yi.prototype.u,Yi.prototype.open=Yi.prototype.m,Yi.prototype.close=Yi.prototype.close,Yn.NO_ERROR=0,Yn.TIMEOUT=8,Yn.HTTP_ERROR=6,$n.COMPLETE="complete",er.EventType=rr,rr.OPEN="a",rr.CLOSE="b",rr.ERROR="c",rr.MESSAGE="d",vn.prototype.listen=vn.prototype.N,yi.prototype.listenOnce=yi.prototype.O,yi.prototype.getLastError=yi.prototype.La,yi.prototype.getLastErrorCode=yi.prototype.Da,yi.prototype.getStatus=yi.prototype.ba,yi.prototype.getResponseJson=yi.prototype.Qa,yi.prototype.getResponseText=yi.prototype.ga,yi.prototype.send=yi.prototype.ea;var no=Yn,ro=$n,io=Bn,oo=ci,so=er,ao=yi,uo=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();uo.o=-1;var co={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},ho=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return(0,g.ZT)(e,t),e}(Error),lo=new $t.Yd("@firebase/firestore");function fo(){return lo.logLevel}function po(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(lo.logLevel<=$t.in.DEBUG){var r=e.map(mo);lo.debug.apply(lo,(0,g.ev)(["Firestore (8.8.0): "+t],r))}}function go(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(lo.logLevel<=$t.in.ERROR){var r=e.map(mo);lo.error.apply(lo,(0,g.ev)(["Firestore (8.8.0): "+t],r))}}function yo(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(lo.logLevel<=$t.in.WARN){var r=e.map(mo);lo.warn.apply(lo,(0,g.ev)(["Firestore (8.8.0): "+t],r))}}function mo(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(yg){return t}}function vo(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.8.0) INTERNAL ASSERTION FAILED: "+t;throw go(e),new Error(e)}function bo(t,e){t||vo()}function wo(t,e){return t}function _o(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var To=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=_o(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function Io(t,e){return t<e?-1:t>e?1:0}function Eo(t,e,n){return t.length===e.length&&t.every(function(t,r){return n(t,e[r])})}function So(t){return t+"\0"}var ko=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new ho(co.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new ho(co.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new ho(co.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new ho(co.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,Math.floor(1e6*(e-1e3*n)))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?Io(this.nanoseconds,t.nanoseconds):Io(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),Ao=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new ko(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t}();function Ro(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Do(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function No(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var xo=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&vo(),void 0===n?n=t.length-e:n>t.length-e&&vo(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(function(t){n.push(t)}):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return this.construct(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),Co=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,g.ZT)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new ho(co.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter(function(t){return t.length>0}))}return new e(r)},e.emptyPath=function(){return new e([])},e}(xo),Oo=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Po=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,g.ZT)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.isValidIdentifier=function(t){return Oo.test(t)},e.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new ho(co.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var a=t[i];if("\\"===a){if(i+1===t.length)throw new ho(co.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new ho(co.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===a?(s=!s,i++):"."!==a||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new ho(co.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.emptyPath=function(){return new e([])},e}(xo),Lo=function(){function t(t){this.fields=t,t.sort(Po.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return Eo(this.fields,t.fields,function(t,e){return t.isEqual(e)})},t}(),Fo=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return btoa(this.binaryString)},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return Io(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();Fo.EMPTY_BYTE_STRING=new Fo("");var Uo=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Mo(t){if(bo(!!t),"string"==typeof t){var e=0,n=Uo.exec(t);if(bo(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:qo(t.seconds),nanos:qo(t.nanos)}}function qo(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Vo(t){return"string"==typeof t?Fo.fromBase64String(t):Fo.fromUint8Array(t)}function jo(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Go(t){var e=t.mapValue.fields.__previous_value__;return jo(e)?Go(e):e}function Bo(t){var e=Mo(t.mapValue.fields.__local_write_time__.timestampValue);return new ko(e.seconds,e.nanos)}function Ko(t){return null==t}function zo(t){return 0===t&&1/t==-1/0}function Jo(t){return"number"==typeof t&&Number.isInteger(t)&&!zo(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var Qo=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t(Co.fromString(e))},t.fromName=function(e){return new t(Co.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===Co.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return Co.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new Co(e.slice()))},t}();function Ho(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?jo(t)?4:10:vo()}function Wo(t,e){var n=Ho(t);if(n!==Ho(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Bo(t).isEqual(Bo(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=Mo(t.timestampValue),r=Mo(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Vo(t.bytesValue).isEqual(Vo(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return qo(t.geoPointValue.latitude)===qo(e.geoPointValue.latitude)&&qo(t.geoPointValue.longitude)===qo(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return qo(t.integerValue)===qo(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=qo(t.doubleValue),r=qo(e.doubleValue);return n===r?zo(n)===zo(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return Eo(t.arrayValue.values||[],e.arrayValue.values||[],Wo);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(Ro(n)!==Ro(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Wo(n[i],r[i])))return!1;return!0}(t,e);default:return vo()}}function Zo(t,e){return void 0!==(t.values||[]).find(function(t){return Wo(t,e)})}function Xo(t,e){var n=Ho(t),r=Ho(e);if(n!==r)return Io(n,r);switch(n){case 0:return 0;case 1:return Io(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=qo(t.integerValue||t.doubleValue),r=qo(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return Yo(t.timestampValue,e.timestampValue);case 4:return Yo(Bo(t),Bo(e));case 5:return Io(t.stringValue,e.stringValue);case 6:return function(t,e){var n=Vo(t),r=Vo(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Io(n[i],r[i]);if(0!==o)return o}return Io(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=Io(qo(t.latitude),qo(e.latitude));return 0!==n?n:Io(qo(t.longitude),qo(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=Xo(n[i],r[i]);if(o)return o}return Io(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=Io(r[s],o[s]);if(0!==a)return a;var u=Xo(n[r[s]],i[o[s]]);if(0!==u)return u}return Io(r.length,o.length)}(t.mapValue,e.mapValue);default:throw vo()}}function Yo(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Io(t,e);var n=Mo(t),r=Mo(e),i=Io(n.seconds,r.seconds);return 0!==i?i:Io(n.nanos,r.nanos)}function $o(t){return ts(t)}function ts(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){var e=Mo(t);return"time("+e.seconds+","+e.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?Vo(t.bytesValue).toBase64():"referenceValue"in t?Qo.fromName(t.referenceValue).toString():"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=ts(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+ts(t.fields[o])}return e+"}"}(t.mapValue):vo();var e}function es(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function ns(t){return!!t&&"integerValue"in t}function rs(t){return!!t&&"arrayValue"in t}function is(t){return!!t&&"nullValue"in t}function os(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function ss(t){return!!t&&"mapValue"in t}function as(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){var e={mapValue:{fields:{}}};return Do(t.mapValue.fields,function(t,n){return e.mapValue.fields[t]=as(n)}),e}if(t.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(t.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=as(t.arrayValue.values[r]);return n}return Object.assign({},t)}var us=function(){function t(t){this.value=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t.isEmpty())return this.value;for(var e=this.value,n=0;n<t.length-1;++n)if(!ss(e=(e.mapValue.fields||{})[t.get(n)]))return null;return(e=(e.mapValue.fields||{})[t.lastSegment()])||null},t.prototype.set=function(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=as(e)},t.prototype.setAll=function(t){var e=this,n=Po.emptyPath(),r={},i=[];t.forEach(function(t,o){if(!n.isImmediateParentOf(o)){var s=e.getFieldsMap(n);e.applyChanges(s,r,i),r={},i=[],n=o.popLast()}t?r[o.lastSegment()]=as(t):i.push(o.lastSegment())});var o=this.getFieldsMap(n);this.applyChanges(o,r,i)},t.prototype.delete=function(t){var e=this.field(t.popLast());ss(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]},t.prototype.isEqual=function(t){return Wo(this.value,t.value)},t.prototype.getFieldsMap=function(t){var e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(var n=0;n<t.length;++n){var r=e.mapValue.fields[t.get(n)];ss(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields},t.prototype.applyChanges=function(t,e,n){Do(e,function(e,n){return t[e]=n});for(var r=0,i=n;r<i.length;r++)delete t[i[r]]},t.prototype.clone=function(){return new t(as(this.value))},t}();function cs(t){var e=[];return Do(t.fields,function(t,n){var r=new Po([t]);if(ss(n)){var i=cs(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++)e.push(r.child(s[o]))}else e.push(r)}),new Lo(e)}var hs=function(){function t(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}return t.newInvalidDocument=function(e){return new t(e,0,Ao.min(),us.empty(),0)},t.newFoundDocument=function(e,n,r){return new t(e,1,n,r,0)},t.newNoDocument=function(e,n){return new t(e,2,n,us.empty(),0)},t.newUnknownDocument=function(e,n){return new t(e,3,n,us.empty(),2)},t.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},t.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=us.empty(),this.documentState=0,this},t.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=us.empty(),this.documentState=2,this},t.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},t.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(t.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),t.prototype.isValidDocument=function(){return 0!==this.documentType},t.prototype.isFoundDocument=function(){return 1===this.documentType},t.prototype.isNoDocument=function(){return 2===this.documentType},t.prototype.isUnknownDocument=function(){return 3===this.documentType},t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)},t.prototype.clone=function(){return new t(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.value)+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},t}(),ls=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function fs(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new ls(t,e,n,r,i,o,s)}function ds(t){var e=wo(t);if(null===e.h){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(function(t){return function(t){return t.field.canonicalString()+t.op.toString()+$o(t.value)}(t)}).join(","),n+="|ob:",n+=e.orderBy.map(function(t){return function(t){return t.field.canonicalString()+t.dir}(t)}).join(","),Ko(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=ks(e.startAt)),e.endAt&&(n+="|ub:",n+=ks(e.endAt)),e.h=n}return e.h}function ps(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!Rs(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if((i=t.filters[r]).op!==(o=e.filters[r]).op||!i.field.isEqual(o.field)||!Wo(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Ns(t.startAt,e.startAt)&&Ns(t.endAt,e.endAt)}function gs(t){return Qo.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var ys=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return(0,g.ZT)(e,t),e.create=function(t,n,r){return t.isKeyField()?"in"===n||"not-in"===n?this.l(t,n,r):new ms(t,n,r):"array-contains"===n?new _s(t,r):"in"===n?new Ts(t,r):"not-in"===n?new Is(t,r):"array-contains-any"===n?new Es(t,r):new e(t,n,r)},e.l=function(t,e,n){return"in"===e?new vs(t,n):new bs(t,n)},e.prototype.matches=function(t){var e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m(Xo(e,this.value)):null!==e&&Ho(this.value)===Ho(e)&&this.m(Xo(e,this.value))},e.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return vo()}},e.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}(function(){}),ms=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=Qo.fromName(r.referenceValue),i}return(0,g.ZT)(e,t),e.prototype.matches=function(t){var e=Qo.comparator(t.key,this.key);return this.m(e)},e}(ys),vs=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=ws(0,n),r}return(0,g.ZT)(e,t),e.prototype.matches=function(t){return this.keys.some(function(e){return e.isEqual(t.key)})},e}(ys),bs=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=ws(0,n),r}return(0,g.ZT)(e,t),e.prototype.matches=function(t){return!this.keys.some(function(e){return e.isEqual(t.key)})},e}(ys);function ws(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(function(t){return Qo.fromName(t.referenceValue)})}var _s=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return(0,g.ZT)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return rs(e)&&Zo(e.arrayValue,this.value)},e}(ys),Ts=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return(0,g.ZT)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return null!==e&&Zo(this.value.arrayValue,e)},e}(ys),Is=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return(0,g.ZT)(e,t),e.prototype.matches=function(t){if(Zo(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.data.field(this.field);return null!==e&&!Zo(this.value.arrayValue,e)},e}(ys),Es=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return(0,g.ZT)(e,t),e.prototype.matches=function(t){var e=this,n=t.data.field(this.field);return!(!rs(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return Zo(e.value.arrayValue,t)})},e}(ys),Ss=function(t,e){this.position=t,this.before=e};function ks(t){return(t.before?"b":"a")+":"+t.position.map(function(t){return $o(t)}).join(",")}var As=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function Rs(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function Ds(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?Qo.comparator(Qo.fromName(s.referenceValue),n.key):Xo(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function Ns(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!Wo(t.position[n],e.position[n]))return!1;return!0}var xs=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null};function Cs(t,e,n,r,i,o,s,a){return new xs(t,e,n,r,i,o,s,a)}function Os(t){return new xs(t)}function Ps(t){return!Ko(t.limit)&&"F"===t.limitType}function Ls(t){return!Ko(t.limit)&&"L"===t.limitType}function Fs(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function Us(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function Ms(t){return null!==t.collectionGroup}function qs(t){var e=wo(t);if(null===e.p){e.p=[];var n=Us(e),r=Fs(e);if(null!==n&&null===r)n.isKeyField()||e.p.push(new As(n)),e.p.push(new As(Po.keyField(),"asc"));else{for(var i=!1,o=0,s=e.explicitOrderBy;o<s.length;o++){var a=s[o];e.p.push(a),a.field.isKeyField()&&(i=!0)}if(!i){var u=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new As(Po.keyField(),u))}}}return e.p}function Vs(t){var e=wo(t);if(!e.T)if("F"===e.limitType)e.T=fs(e.path,e.collectionGroup,qs(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=qs(e);r<i.length;r++){var o=i[r];n.push(new As(o.field,"desc"===o.dir?"asc":"desc"))}var s=e.endAt?new Ss(e.endAt.position,!e.endAt.before):null,a=e.startAt?new Ss(e.startAt.position,!e.startAt.before):null;e.T=fs(e.path,e.collectionGroup,n,e.filters,e.limit,s,a)}return e.T}function js(t,e,n){return new xs(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Gs(t,e){return ps(Vs(t),Vs(e))&&t.limitType===e.limitType}function Bs(t){return ds(Vs(t))+"|lt:"+t.limitType}function Ks(t){return"Query(target="+function(t){var e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map(function(t){return(e=t).field.canonicalString()+" "+e.op+" "+$o(e.value);var e}).join(", ")+"]"),Ko(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map(function(t){return function(t){return t.field.canonicalString()+" ("+t.dir+")"}(t)}).join(", ")+"]"),t.startAt&&(e+=", startAt: "+ks(t.startAt)),t.endAt&&(e+=", endAt: "+ks(t.endAt)),"Target("+e+")"}(Vs(t))+"; limitType="+t.limitType+")"}function zs(t,e){return e.isFoundDocument()&&function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):Qo.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Ds(t.startAt,qs(t),e)||t.endAt&&Ds(t.endAt,qs(t),e))}(t,e)}function Js(t){return function(e,n){for(var r=!1,i=0,o=qs(t);i<o.length;i++){var s=o[i],a=Qs(s,e,n);if(0!==a)return a;r=r||s.field.isKeyField()}return 0}}function Qs(t,e,n){var r=t.field.isKeyField()?Qo.comparator(e.key,n.key):function(t,e,n){var r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?Xo(r,i):vo()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return vo()}}function Hs(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:zo(e)?"-0":e}}function Ws(t){return{integerValue:""+t}}function Zs(t,e){return Jo(e)?Ws(e):Hs(t,e)}var Xs=function(){this._=void 0};function Ys(t,e,n){return t instanceof ea?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof na?ra(t,e):t instanceof ia?oa(t,e):function(t,e){var n=ta(t,e),r=aa(n)+aa(t.A);return ns(n)&&ns(t.A)?Ws(r):Hs(t.R,r)}(t,e)}function $s(t,e,n){return t instanceof na?ra(t,e):t instanceof ia?oa(t,e):n}function ta(t,e){return t instanceof sa?ns(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var ea=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,g.ZT)(e,t),e}(Xs),na=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return(0,g.ZT)(e,t),e}(Xs);function ra(t,e){for(var n=ua(e),r=function(t){n.some(function(e){return Wo(e,t)})||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var ia=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return(0,g.ZT)(e,t),e}(Xs);function oa(t,e){for(var n=ua(e),r=function(t){n=n.filter(function(e){return!Wo(e,t)})},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var sa=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).R=e,r.A=n,r}return(0,g.ZT)(e,t),e}(Xs);function aa(t){return qo(t.integerValue||t.doubleValue)}function ua(t){return rs(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var ca=function(t,e){this.field=t,this.transform=e},ha=function(t,e){this.version=t,this.transformResults=e},la=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function fa(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}var da=function(){};function pa(t,e,n){t instanceof ba?function(t,e,n){var r=t.value.clone(),i=Ta(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof wa?function(t,e,n){if(fa(t.precondition,e)){var r=Ta(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(_a(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else e.convertToUnknownDocument(n.version)}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function ga(t,e,n){t instanceof ba?function(t,e,n){if(fa(t.precondition,e)){var r=t.value.clone(),i=Ia(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(va(e),r).setHasLocalMutations()}}(t,e,n):t instanceof wa?function(t,e,n){if(fa(t.precondition,e)){var r=Ia(t.fieldTransforms,n,e),i=e.data;i.setAll(_a(t)),i.setAll(r),e.convertToFoundDocument(va(e),i).setHasLocalMutations()}}(t,e,n):function(t,e){fa(t.precondition,e)&&e.convertToNoDocument(Ao.min())}(t,e)}function ya(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),a=ta(o.transform,s||null);null!=a&&(null==n&&(n=us.empty()),n.set(o.field,a))}return n||null}function ma(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Eo(t,e,function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof na&&e instanceof na||t instanceof ia&&e instanceof ia?Eo(t.elements,e.elements,Wo):t instanceof sa&&e instanceof sa?Wo(t.A,e.A):t instanceof ea&&e instanceof ea}(t.transform,e.transform)}(t,e)})}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function va(t){return t.isFoundDocument()?t.version:Ao.min()}var ba=function(t){function e(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return(0,g.ZT)(e,t),e}(da),wa=function(t){function e(e,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=t.call(this)||this).key=e,s.data=n,s.fieldMask=r,s.precondition=i,s.fieldTransforms=o,s.type=1,s}return(0,g.ZT)(e,t),e}(da);function _a(t){var e=new Map;return t.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=t.data.field(n);e.set(n,r)}}),e}function Ta(t,e,n){var r=new Map;bo(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,$s(s,a,n[i]))}return r}function Ia(t,e,n){for(var r=new Map,i=0,o=t;i<o.length;i++){var s=o[i],a=s.transform,u=n.data.field(s.field);r.set(s.field,Ys(a,u,e))}return r}var Ea,Sa,ka=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return(0,g.ZT)(e,t),e}(da),Aa=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return(0,g.ZT)(e,t),e}(da),Ra=function(t){this.count=t};function Da(t){switch(t){case co.OK:return vo();case co.CANCELLED:case co.UNKNOWN:case co.DEADLINE_EXCEEDED:case co.RESOURCE_EXHAUSTED:case co.INTERNAL:case co.UNAVAILABLE:case co.UNAUTHENTICATED:return!1;case co.INVALID_ARGUMENT:case co.NOT_FOUND:case co.ALREADY_EXISTS:case co.PERMISSION_DENIED:case co.FAILED_PRECONDITION:case co.ABORTED:case co.OUT_OF_RANGE:case co.UNIMPLEMENTED:case co.DATA_LOSS:return!0;default:return vo()}}function Na(t){if(void 0===t)return go("GRPC error has no .code"),co.UNKNOWN;switch(t){case Ea.OK:return co.OK;case Ea.CANCELLED:return co.CANCELLED;case Ea.UNKNOWN:return co.UNKNOWN;case Ea.DEADLINE_EXCEEDED:return co.DEADLINE_EXCEEDED;case Ea.RESOURCE_EXHAUSTED:return co.RESOURCE_EXHAUSTED;case Ea.INTERNAL:return co.INTERNAL;case Ea.UNAVAILABLE:return co.UNAVAILABLE;case Ea.UNAUTHENTICATED:return co.UNAUTHENTICATED;case Ea.INVALID_ARGUMENT:return co.INVALID_ARGUMENT;case Ea.NOT_FOUND:return co.NOT_FOUND;case Ea.ALREADY_EXISTS:return co.ALREADY_EXISTS;case Ea.PERMISSION_DENIED:return co.PERMISSION_DENIED;case Ea.FAILED_PRECONDITION:return co.FAILED_PRECONDITION;case Ea.ABORTED:return co.ABORTED;case Ea.OUT_OF_RANGE:return co.OUT_OF_RANGE;case Ea.UNIMPLEMENTED:return co.UNIMPLEMENTED;case Ea.DATA_LOSS:return co.DATA_LOSS;default:return vo()}}(Sa=Ea||(Ea={}))[Sa.OK=0]="OK",Sa[Sa.CANCELLED=1]="CANCELLED",Sa[Sa.UNKNOWN=2]="UNKNOWN",Sa[Sa.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Sa[Sa.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Sa[Sa.NOT_FOUND=5]="NOT_FOUND",Sa[Sa.ALREADY_EXISTS=6]="ALREADY_EXISTS",Sa[Sa.PERMISSION_DENIED=7]="PERMISSION_DENIED",Sa[Sa.UNAUTHENTICATED=16]="UNAUTHENTICATED",Sa[Sa.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Sa[Sa.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Sa[Sa.ABORTED=10]="ABORTED",Sa[Sa.OUT_OF_RANGE=11]="OUT_OF_RANGE",Sa[Sa.UNIMPLEMENTED=12]="UNIMPLEMENTED",Sa[Sa.INTERNAL=13]="INTERNAL",Sa[Sa.UNAVAILABLE=14]="UNAVAILABLE",Sa[Sa.DATA_LOSS=15]="DATA_LOSS";var xa=function(){function t(t,e){this.comparator=t,this.root=e||Oa.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Oa.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Oa.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal(function(e,n){return t(e,n),!1})},t.prototype.toString=function(){var t=[];return this.inorderTraversal(function(e,n){return t.push(e+":"+n),!1}),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new Ca(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new Ca(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new Ca(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new Ca(this.root,t,this.comparator,!0)},t}(),Ca=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),Oa=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw vo();if(this.right.isRed())throw vo();var t=this.left.check();if(t!==this.right.check())throw vo();return t+(this.isRed()?0:1)},t}();Oa.EMPTY=null,Oa.RED=!0,Oa.BLACK=!1,Oa.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw vo()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw vo()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw vo()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw vo()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw vo()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new Oa(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());var Pa=function(){function t(t){this.comparator=t,this.data=new xa(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new La(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new La(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},t.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),La=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),Fa=new xa(Qo.comparator);function Ua(){return Fa}var Ma=new xa(Qo.comparator);function qa(){return Ma}var Va=new xa(Qo.comparator);function ja(){return Va}var Ga=new Pa(Qo.comparator);function Ba(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Ga,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Ka=new Pa(Io);function za(){return Ka}var Ja=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,Qa.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(Ao.min(),r,za(),Ua(),Ba())},t}(),Qa=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(Fo.EMPTY_BYTE_STRING,n,Ba(),Ba(),Ba())},t}(),Ha=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},Wa=function(t,e){this.targetId=t,this.V=e},Za=function(t,e,n,r){void 0===n&&(n=Fo.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},Xa=function(){function t(){this.S=0,this.D=tu(),this.C=Fo.EMPTY_BYTE_STRING,this.N=!1,this.F=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"k",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"$",{get:function(){return this.F},enumerable:!1,configurable:!0}),t.prototype.O=function(t){t.approximateByteSize()>0&&(this.F=!0,this.C=t)},t.prototype.M=function(){var t=Ba(),e=Ba(),n=Ba();return this.D.forEach(function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:vo()}}),new Qa(this.C,this.N,t,e,n)},t.prototype.L=function(){this.F=!1,this.D=tu()},t.prototype.B=function(t,e){this.F=!0,this.D=this.D.insert(t,e)},t.prototype.q=function(t){this.F=!0,this.D=this.D.remove(t)},t.prototype.U=function(){this.S+=1},t.prototype.K=function(){this.S-=1},t.prototype.j=function(){this.F=!0,this.N=!0},t}(),Ya=function(){function t(t){this.W=t,this.G=new Map,this.H=Ua(),this.J=$a(),this.Y=new Pa(Io)}return t.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)this.tt(r=o[i],t.key,t.P)},t.prototype.et=function(t){var e=this;this.forEachTarget(t,function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.O(t.resumeToken);break;case 1:r.K(),r.k||r.L(),r.O(t.resumeToken);break;case 2:r.K(),r.k||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.O(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.O(t.resumeToken));break;default:vo()}})},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach(function(t,r){n.st(r)&&e(r)})},t.prototype.rt=function(t){var e=t.targetId,n=t.V.count,r=this.ot(e);if(r){var i=r.target;if(gs(i))if(0===n){var o=new Qo(i.path);this.tt(e,o,hs.newNoDocument(o,Ao.min()))}else bo(1===n);else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}},t.prototype.ut=function(t){var e=this,n=new Map;this.G.forEach(function(r,i){var o=e.ot(i);if(o){if(r.current&&gs(o.target)){var s=new Qo(o.target.path);null!==e.H.get(s)||e.at(i,s)||e.tt(i,s,hs.newNoDocument(s,t))}r.$&&(n.set(i,r.M()),r.L())}});var r=Ba();this.J.forEach(function(t,n){var i=!0;n.forEachWhile(function(t){var n=e.ot(t);return!n||2===n.purpose||(i=!1,!1)}),i&&(r=r.add(t))});var i=new Ja(t,n,this.Y,this.H,r);return this.H=Ua(),this.J=$a(),this.Y=new Pa(Io),i},t.prototype.Z=function(t,e){if(this.st(t)){var n=this.at(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}},t.prototype.tt=function(t,e,n){if(this.st(t)){var r=this.nt(t);this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}},t.prototype.removeTarget=function(t){this.G.delete(t)},t.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.U=function(t){this.nt(t).U()},t.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new Xa,this.G.set(t,e)),e},t.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new Pa(Io),this.J=this.J.insert(t,e)),e},t.prototype.st=function(t){var e=null!==this.ot(t);return e||po("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ot=function(t){var e=this.G.get(t);return e&&e.k?null:this.W.lt(t)},t.prototype.it=function(t){var e=this;this.G.set(t,new Xa),this.W.getRemoteKeysForTarget(t).forEach(function(n){e.tt(t,n,null)})},t.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},t}();function $a(){return new xa(Qo.comparator)}function tu(){return new xa(Qo.comparator)}var eu={asc:"ASCENDING",desc:"DESCENDING"},nu={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ru=function(t,e){this.databaseId=t,this.I=e};function iu(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function ou(t,e){return t.I?e.toBase64():e.toUint8Array()}function su(t,e){return iu(t,e.toTimestamp())}function au(t){return bo(!!t),Ao.fromTimestamp(function(t){var e=Mo(t);return new ko(e.seconds,e.nanos)}(t))}function uu(t,e){return function(t){return new Co(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function cu(t){var e=Co.fromString(t);return bo(Ou(e)),e}function hu(t,e){return uu(t.databaseId,e.path)}function lu(t,e){var n=cu(e);if(n.get(1)!==t.databaseId.projectId)throw new ho(co.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new ho(co.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Qo(gu(n))}function fu(t,e){return uu(t.databaseId,e)}function du(t){var e=cu(t);return 4===e.length?Co.emptyPath():gu(e)}function pu(t){return new Co(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function gu(t){return bo(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function yu(t,e,n){return{name:hu(t,e),fields:n.value.mapValue.fields}}function mu(t,e,n){var r=lu(t,e.name),i=au(e.updateTime),o=new us({mapValue:{fields:e.fields}}),s=hs.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}function vu(t,e){var n;if(e instanceof ba)n={update:yu(t,e.key,e.value)};else if(e instanceof ka)n={delete:hu(t,e.key)};else if(e instanceof wa)n={update:yu(t,e.key,e.data),updateMask:Cu(e.fieldMask)};else{if(!(e instanceof Aa))return vo();n={verify:hu(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(function(t){return function(t,e){var n=e.transform;if(n instanceof ea)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof na)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof ia)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof sa)return{fieldPath:e.field.canonicalString(),increment:n.A};throw vo()}(0,t)})),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:su(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:vo()}(t,e.precondition)),n}function bu(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?la.updateTime(au(t.updateTime)):void 0!==t.exists?la.exists(t.exists):la.none()}(e.currentDocument):la.none(),r=e.updateTransforms?e.updateTransforms.map(function(e){return function(t,e){var n=null;"setToServerValue"in e?(bo("REQUEST_TIME"===e.setToServerValue),n=new ea):"appendMissingElements"in e?n=new na(e.appendMissingElements.values||[]):"removeAllFromArray"in e?n=new ia(e.removeAllFromArray.values||[]):"increment"in e?n=new sa(t,e.increment):vo();var r=Po.fromServerFormat(e.fieldPath);return new ca(r,n)}(t,e)}):[];if(e.update){var i=lu(t,e.update.name),o=new us({mapValue:{fields:e.update.fields}});if(e.updateMask){var s=function(t){return new Lo((t.fieldPaths||[]).map(function(t){return Po.fromServerFormat(t)}))}(e.updateMask);return new wa(i,o,s,n,r)}return new ba(i,o,n,r)}if(e.delete){var a=lu(t,e.delete);return new ka(a,n)}if(e.verify){var u=lu(t,e.verify);return new Aa(u,n)}return vo()}function wu(t,e){return{documents:[fu(t,e.path)]}}function _u(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=fu(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=fu(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(t){if(0!==t.length){var e=t.map(function(t){return function(t){if("=="===t.op){if(os(t.value))return{unaryFilter:{field:Ru(t.field),op:"IS_NAN"}};if(is(t.value))return{unaryFilter:{field:Ru(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(os(t.value))return{unaryFilter:{field:Ru(t.field),op:"IS_NOT_NAN"}};if(is(t.value))return{unaryFilter:{field:Ru(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ru(t.field),op:Au(t.op),value:t.value}}}(t)});return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map(function(t){return function(t){return{field:Ru(t.field),direction:ku(t.dir)}}(t)})}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.I||Ko(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=Eu(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Eu(e.endAt)),n}function Tu(t){var e=du(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){bo(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=Iu(n.where));var a=[];n.orderBy&&(a=n.orderBy.map(function(t){return function(t){return new As(Du(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)}));var u=null;n.limit&&(u=function(t){var e;return Ko(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=Su(n.startAt));var h=null;return n.endAt&&(h=Su(n.endAt)),Cs(e,i,a,s,u,"F",c,h)}function Iu(t){return t?void 0!==t.unaryFilter?[xu(t)]:void 0!==t.fieldFilter?[Nu(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return Iu(t)}).reduce(function(t,e){return t.concat(e)}):vo():[]}function Eu(t){return{before:t.before,values:t.position}}function Su(t){return new Ss(t.values||[],!!t.before)}function ku(t){return eu[t]}function Au(t){return nu[t]}function Ru(t){return{fieldPath:t.canonicalString()}}function Du(t){return Po.fromServerFormat(t.fieldPath)}function Nu(t){return ys.create(Du(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return vo()}}(t.fieldFilter.op),t.fieldFilter.value)}function xu(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Du(t.unaryFilter.field);return ys.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=Du(t.unaryFilter.field);return ys.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=Du(t.unaryFilter.field);return ys.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=Du(t.unaryFilter.field);return ys.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return vo()}}function Cu(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}}function Ou(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function Pu(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=Fu(e)),e=Lu(t.get(n),e);return Fu(e)}function Lu(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}function Fu(t){return t+"\x01\x01"}function Uu(t){var e=t.length;if(bo(e>=2),2===e)return bo("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),Co.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("\x01",o);switch((s<0||s>n)&&vo(),t.charAt(s+1)){case"\x01":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"\x10":i+=t.substring(o,s),i+="\0";break;case"\x11":i+=t.substring(o,s+1);break;default:vo()}o=s+2}return new Co(r)}var Mu=function(t,e){this.seconds=t,this.nanoseconds=e},qu=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};qu.store="owner",qu.key="owner";var Vu=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};Vu.store="mutationQueues",Vu.keyPath="userId";var ju=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};ju.store="mutations",ju.keyPath="batchId",ju.userMutationsIndex="userMutationsIndex",ju.userMutationsKeyPath=["userId","batchId"];var Gu=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,Pu(e)]},t.key=function(t,e,n){return[t,Pu(e),n]},t}();Gu.store="documentMutations",Gu.PLACEHOLDER=new Gu;var Bu=function(t,e){this.path=t,this.readTime=e},Ku=function(t,e){this.path=t,this.version=e},zu=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};zu.store="remoteDocuments",zu.readTimeIndex="readTimeIndex",zu.readTimeIndexPath="readTime",zu.collectionReadTimeIndex="collectionReadTimeIndex",zu.collectionReadTimeIndexPath=["parentPath","readTime"];var Ju=function(t){this.byteSize=t};Ju.store="remoteDocumentGlobal",Ju.key="remoteDocumentGlobalKey";var Qu=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Qu.store="targets",Qu.keyPath="targetId",Qu.queryTargetsIndexName="queryTargetsIndex",Qu.queryTargetsKeyPath=["canonicalId","targetId"];var Hu=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Hu.store="targetDocuments",Hu.keyPath=["targetId","path"],Hu.documentTargetsIndex="documentTargetsIndex",Hu.documentTargetsKeyPath=["path","targetId"];var Wu=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Wu.key="targetGlobalKey",Wu.store="targetGlobal";var Zu=function(t,e){this.collectionId=t,this.parent=e};Zu.store="collectionParents",Zu.keyPath=["collectionId","parent"];var Xu=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Xu.store="clientMetadata",Xu.keyPath="clientId";var Yu=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};Yu.store="bundles",Yu.keyPath="bundleId";var $u=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};$u.store="namedQueries",$u.keyPath="name";var tc=(0,g.ev)((0,g.ev)([],(0,g.ev)((0,g.ev)([],(0,g.ev)((0,g.ev)([],(0,g.ev)((0,g.ev)([],[Vu.store,ju.store,Gu.store,zu.store,Qu.store,qu.store,Wu.store,Hu.store]),[Xu.store])),[Ju.store])),[Zu.store])),[Yu.store,$u.store]),ec="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",nc=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},t}(),rc=function(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})},ic=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&vo(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t(function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}})},t.prototype.toPromise=function(){var t=this;return new Promise(function(e,n){t.next(e,n)})},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.reject(n)},t.resolve=function(e){return new t(function(t,n){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.waitFor=function(e){return new t(function(t,n){var r=0,i=0,o=!1;e.forEach(function(e){++r,e.next(function(){++i,o&&i===r&&t()},function(t){return n(t)})}),o=!0,i===r&&t()})},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next(function(n){return n?t.resolve(n):e()})},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach(function(t,i){r.push(e.call(n,t,i))}),this.waitFor(r)},t}(),oc=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new rc,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new uc(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){var r=dc(e.target.error);n.ft.reject(new uc(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new uc(n,e)}},Object.defineProperty(t.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(po("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new hc(e)},t}(),sc=function(){function t(e,n,r){this.name=e,this.version=n,this.wt=r,12.2===t._t((0,y.z$)())&&go("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return po("SimpleDb","Removing database:",t),lc(window.indexedDB.deleteDatabase(t)).toPromise()},t.yt=function(){if("undefined"==typeof indexedDB)return!1;if(t.gt())return!0;var e=(0,y.z$)(),n=t._t(e),r=0<n&&n<10,i=t.Et(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)},t.gt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Tt)},t.It=function(t,e){return t.store(e)},t._t=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.Et=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.At=function(t){return(0,g.mG)(this,void 0,void 0,function(){var e,n=this;return(0,g.Jh)(this,function(r){switch(r.label){case 0:return this.db?[3,2]:(po("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){e(t.target.result)},i.onblocked=function(){r(new uc(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;r("VersionError"===n.name?new ho(co.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):new uc(t,n))},i.onupgradeneeded=function(t){po("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion),n.wt.Rt(t.target.result,i.transaction,t.oldVersion,n.version).next(function(){po("SimpleDb","Database upgrade to version "+n.version+" complete")})}})]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return n.bt(t)}),this.db)]}})})},t.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,e,n,r){return(0,g.mG)(this,void 0,void 0,function(){var i,o,s,a,u;return(0,g.Jh)(this,function(c){switch(c.label){case 0:i="readonly"===e,o=0,s=function(){var e,s,u,c,h;return(0,g.Jh)(this,function(l){switch(l.label){case 0:++o,l.label=1;case 1:return l.trys.push([1,4,,5]),[4,a.At(t)];case 2:return a.db=l.sent(),e=oc.open(a.db,t,i?"readonly":"readwrite",n),s=r(e).catch(function(t){return e.abort(t),ic.reject(t)}).toPromise(),u={},s.catch(function(){}),[4,e.dt];case 3:return[2,(u.value=(l.sent(),s),u)];case 4:return po("SimpleDb","Transaction failed with error:",(c=l.sent()).message,"Retrying:",h="FirebaseError"!==c.name&&o<3),a.close(),h?[3,5]:[2,{value:Promise.reject(c)}];case 5:return[2]}})},a=this,c.label=1;case 1:return[5,s()];case 2:if("object"==typeof(u=c.sent()))return[2,u.value];c.label=3;case 3:return[3,1];case 4:return[2]}})})},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),ac=function(){function t(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Vt=!0},t.prototype.Ct=function(t){this.St=t},t.prototype.delete=function(){return lc(this.Pt.delete())},t}(),uc=function(t){function e(e,n){var r=this;return(r=t.call(this,co.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return(0,g.ZT)(e,t),e}(ho);function cc(t){return"IndexedDbTransactionError"===t.name}var hc=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(po("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(po("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),lc(n)},t.prototype.add=function(t){return po("SimpleDb","ADD",this.store.name,t,t),lc(this.store.add(t))},t.prototype.get=function(t){var e=this;return lc(this.store.get(t)).next(function(n){return void 0===n&&(n=null),po("SimpleDb","GET",e.store.name,t,n),n})},t.prototype.delete=function(t){return po("SimpleDb","DELETE",this.store.name,t),lc(this.store.delete(t))},t.prototype.count=function(){return po("SimpleDb","COUNT",this.store.name),lc(this.store.count())},t.prototype.Nt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.xt(n,function(t,e){r.push(e)}).next(function(){return r})},t.prototype.Ft=function(t,e){po("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.kt=!1;var r=this.cursor(n);return this.xt(r,function(t,e,n){return n.delete()})},t.prototype.$t=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.xt(r,e)},t.prototype.Ot=function(t){var e=this.cursor({});return new ic(function(n,r){e.onerror=function(t){var e=dc(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next(function(t){t?r.continue():n()}):n()}})},t.prototype.xt=function(t,e){var n=[];return new ic(function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new ac(i),s=e(i.primaryKey,i.value,o);if(s instanceof ic){var a=s.catch(function(t){return o.done(),ic.reject(t)});n.push(a)}o.isDone?r():null===o.Dt?i.continue():i.continue(o.Dt)}else r()}}).next(function(){return ic.waitFor(n)})},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.kt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function lc(t){return new ic(function(e,n){t.onsuccess=function(t){e(t.target.result)},t.onerror=function(t){var e=dc(t.target.error);n(e)}})}var fc=!1;function dc(t){var e=sc._t((0,y.z$)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new ho("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return fc||(fc=!0,setTimeout(function(){throw r},0)),r}}return t}var pc=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Mt=e,r.currentSequenceNumber=n,r}return(0,g.ZT)(e,t),e}(nc);function gc(t,e){var n=wo(t);return sc.It(n.Mt,e)}var yc=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e){for(var n=e.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t.key)&&pa(i,t,n[r])}},t.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(o=n[e]).key.isEqual(t.key)&&ga(o,t,this.localWriteTime);for(var r=0,i=this.mutations;r<i.length;r++){var o;(o=i[r]).key.isEqual(t.key)&&ga(o,t,this.localWriteTime)}},t.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach(function(n){var r=t.get(n.key),i=r;e.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(Ao.min())})},t.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},Ba())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&Eo(this.mutations,t.mutations,function(t,e){return ma(t,e)})&&Eo(this.baseMutations,t.baseMutations,function(t,e){return ma(t,e)})},t}(),mc=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){bo(e.mutations.length===r.length);for(var i=ja(),o=e.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),vc=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=Ao.min()),void 0===o&&(o=Ao.min()),void 0===s&&(s=Fo.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),bc=function(t){this.Lt=t};function wc(t,e){if(e.document)return mu(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=Qo.fromSegments(e.noDocument.path),r=Sc(e.noDocument.readTime),i=hs.newNoDocument(n,r);return e.hasCommittedMutations?i.setHasCommittedMutations():i}if(e.unknownDocument){var o=Qo.fromSegments(e.unknownDocument.path);return r=Sc(e.unknownDocument.version),hs.newUnknownDocument(o,r)}return vo()}function _c(t,e,n){var r=Tc(n),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){var o=function(t,e){return{name:hu(t,e.key),fields:e.data.value.mapValue.fields,updateTime:iu(t,e.version.toTimestamp())}}(t.Lt,e),s=e.hasCommittedMutations;return new zu(null,null,o,s,r,i)}if(e.isNoDocument()){var a=e.key.path.toArray(),u=Ec(e.version);return s=e.hasCommittedMutations,new zu(null,new Bu(a,u),null,s,r,i)}if(e.isUnknownDocument()){var c=e.key.path.toArray(),h=Ec(e.version);return new zu(new Ku(c,h),null,null,!0,r,i)}return vo()}function Tc(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function Ic(t){var e=new ko(t[0],t[1]);return Ao.fromTimestamp(e)}function Ec(t){var e=t.toTimestamp();return new Mu(e.seconds,e.nanoseconds)}function Sc(t){var e=new ko(t.seconds,t.nanoseconds);return Ao.fromTimestamp(e)}function kc(t,e){for(var n=(e.baseMutations||[]).map(function(e){return bu(t.Lt,e)}),r=0;r<e.mutations.length-1;++r)r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform&&(e.mutations[r].updateTransforms=e.mutations[r+1].transform.fieldTransforms,e.mutations.splice(r+1,1),++r);var i=e.mutations.map(function(e){return bu(t.Lt,e)}),o=ko.fromMillis(e.localWriteTimeMs);return new yc(e.batchId,o,n,i)}function Ac(t){var e,n,r=Sc(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?Sc(t.lastLimboFreeSnapshotVersion):Ao.min();return void 0!==t.query.documents?(bo(1===(n=t.query).documents.length),e=Vs(Os(du(n.documents[0])))):e=function(t){return Vs(Tu(t))}(t.query),new vc(e,t.targetId,0,t.lastListenSequenceNumber,r,i,Fo.fromBase64String(t.resumeToken))}function Rc(t,e){var n,r=Ec(e.snapshotVersion),i=Ec(e.lastLimboFreeSnapshotVersion);n=gs(e.target)?wu(t.Lt,e.target):_u(t.Lt,e.target);var o=e.resumeToken.toBase64();return new Qu(e.targetId,ds(e.target),r,o,e.sequenceNumber,i,n)}function Dc(t){var e=Tu({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?js(e,e.limit,"L"):e}var Nc=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return xc(t).get(e).next(function(t){if(t)return{id:(e=t).bundleId,createTime:Sc(e.createTime),version:e.version};var e})},t.prototype.saveBundleMetadata=function(t,e){return xc(t).put({bundleId:(n=e).id,createTime:Ec(au(n.createTime)),version:n.version});var n},t.prototype.getNamedQuery=function(t,e){return Cc(t).get(e).next(function(t){if(t)return{name:(e=t).name,query:Dc(e.bundledQuery),readTime:Sc(e.readTime)};var e})},t.prototype.saveNamedQuery=function(t,e){return Cc(t).put(function(t){return{name:t.name,readTime:Ec(au(t.readTime)),bundledQuery:t.bundledQuery}}(e))},t}();function xc(t){return gc(t,Yu.store)}function Cc(t){return gc(t,$u.store)}var Oc=function(){function t(){this.Bt=new Pc}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),ic.resolve()},t.prototype.getCollectionParents=function(t,e){return ic.resolve(this.Bt.getEntries(e))},t}(),Pc=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Pa(Co.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new Pa(Co.comparator)).toArray()},t}(),Lc=function(){function t(){this.qt=new Pc}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.qt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(function(){n.qt.add(e)});var o={collectionId:r,parent:Pu(i)};return Fc(t).put(o)}return ic.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[So(e),""],!1,!0);return Fc(t).Nt(r).next(function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(Uu(o.parent))}return n})},t}();function Fc(t){return gc(t,Zu.store)}var Uc={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Mc=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();function qc(t,e,n){var r=t.store(ju.store),i=t.store(Gu.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.$t({range:s},function(t,e,n){return a++,n.delete()});o.push(u.next(function(){bo(1===a)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],d=Gu.key(e,f.key.path,n.batchId);o.push(i.delete(d)),c.push(f.key)}return ic.waitFor(o).next(function(){return c})}function Vc(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw vo();e=t.noDocument}return JSON.stringify(e).length}Mc.DEFAULT_COLLECTION_PERCENTILE=10,Mc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Mc.DEFAULT=new Mc(41943040,Mc.DEFAULT_COLLECTION_PERCENTILE,Mc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Mc.DISABLED=new Mc(-1,0,0);var jc=function(){function t(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Kt={}}return t.Qt=function(e,n,r,i){return bo(""!==e.uid),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Bc(t).$t({index:ju.userMutationsIndex,range:n},function(t,n,r){e=!1,r.done()}).next(function(){return e})},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=Kc(t),s=Bc(t);return s.add({}).next(function(a){bo("number"==typeof a);for(var u=new yc(a,e,n,r),c=function(t,e,n){var r=n.baseMutations.map(function(e){return vu(t.Lt,e)}),i=n.mutations.map(function(e){return vu(t.Lt,e)});return new ju(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.R,i.userId,u),h=[],l=new Pa(function(t,e){return Io(t.canonicalString(),e.canonicalString())}),f=0,d=r;f<d.length;f++){var p=d[f],g=Gu.key(i.userId,p.key.path,a);l=l.add(p.key.path.popLast()),h.push(s.put(c)),h.push(o.put(g,Gu.PLACEHOLDER))}return l.forEach(function(e){h.push(i.Ut.addToCollectionParentIndex(t,e))}),t.addOnCommittedListener(function(){i.Kt[a]=u.keys()}),ic.waitFor(h).next(function(){return u})})},t.prototype.lookupMutationBatch=function(t,e){var n=this;return Bc(t).get(e).next(function(t){return t?(bo(t.userId===n.userId),kc(n.R,t)):null})},t.prototype.jt=function(t,e){var n=this;return this.Kt[e]?ic.resolve(this.Kt[e]):this.lookupMutationBatch(t,e).next(function(t){if(t){var r=t.keys();return n.Kt[e]=r,r}return null})},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return Bc(t).$t({index:ju.userMutationsIndex,range:i},function(t,e,i){e.userId===n.userId&&(bo(e.batchId>=r),o=kc(n.R,e)),i.done()}).next(function(){return o})},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Bc(t).$t({index:ju.userMutationsIndex,range:e,reverse:!0},function(t,e,r){n=e.batchId,r.done()}).next(function(){return n})},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Bc(t).Nt(ju.userMutationsIndex,n).next(function(t){return t.map(function(t){return kc(e.R,t)})})},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=Gu.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return Kc(t).$t({range:i},function(r,i,s){var a=r[0],u=r[2],c=Uu(r[1]);if(a===n.userId&&e.path.isEqual(c))return Bc(t).get(u).next(function(t){if(!t)throw vo();bo(t.userId===n.userId),o.push(kc(n.R,t))});s.done()}).next(function(){return o})},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Pa(Io),i=[];return e.forEach(function(e){var o=Gu.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=Kc(t).$t({range:s},function(t,i,o){var s=t[0],a=t[2],u=Uu(t[1]);s===n.userId&&e.path.isEqual(u)?r=r.add(a):o.done()});i.push(a)}),ic.waitFor(i).next(function(){return n.Wt(t,r)})},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=Gu.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new Pa(Io);return Kc(t).$t({range:s},function(t,e,o){var s=t[0],u=t[2],c=Uu(t[1]);s===n.userId&&r.isPrefixOf(c)?c.length===i&&(a=a.add(u)):o.done()}).next(function(){return n.Wt(t,a)})},t.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(Bc(t).get(e).next(function(t){if(null===t)throw vo();bo(t.userId===n.userId),r.push(kc(n.R,t))}))}),ic.waitFor(i).next(function(){return r})},t.prototype.removeMutationBatch=function(t,e){var n=this;return qc(t.Mt,this.userId,e).next(function(r){return t.addOnCommittedListener(function(){n.Gt(e.batchId)}),ic.forEach(r,function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)})})},t.prototype.Gt=function(t){delete this.Kt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next(function(n){if(!n)return ic.resolve();var r=IDBKeyRange.lowerBound(Gu.prefixForUser(e.userId)),i=[];return Kc(t).$t({range:r},function(t,n,r){if(t[0]===e.userId){var o=Uu(t[1]);i.push(o)}else r.done()}).next(function(){bo(0===i.length)})})},t.prototype.containsKey=function(t,e){return Gc(t,this.userId,e)},t.prototype.zt=function(t){var e=this;return zc(t).get(this.userId).next(function(t){return t||new Vu(e.userId,-1,"")})},t}();function Gc(t,e,n){var r=Gu.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return Kc(t).$t({range:o,kt:!0},function(t,n,r){t[0]===e&&t[1]===i&&(s=!0),r.done()}).next(function(){return s})}function Bc(t){return gc(t,ju.store)}function Kc(t){return gc(t,Gu.store)}function zc(t){return gc(t,Vu.store)}var Jc=function(){function t(t){this.Ht=t}return t.prototype.next=function(){return this.Ht+=2,this.Ht},t.Jt=function(){return new t(0)},t.Yt=function(){return new t(-1)},t}(),Qc=function(){function t(t,e){this.referenceDelegate=t,this.R=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next(function(n){var r=new Jc(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next(function(){return n.highestTargetId})})},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next(function(t){return Ao.fromTimestamp(new ko(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},t.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next(function(t){return t.highestListenSequenceNumber})},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.Xt(t).next(function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Zt(t,i)})},t.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next(function(){return n.Xt(t).next(function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)})})},t.prototype.updateTargetData=function(t,e){return this.te(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next(function(){return Hc(t).delete(e.targetId)}).next(function(){return n.Xt(t)}).next(function(e){return bo(e.targetCount>0),e.targetCount-=1,n.Zt(t,e)})},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return Hc(t).$t(function(s,a){var u=Ac(a);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))}).next(function(){return ic.waitFor(o)}).next(function(){return i})},t.prototype.forEachTarget=function(t,e){return Hc(t).$t(function(t,n){var r=Ac(n);e(r)})},t.prototype.Xt=function(t){return Wc(t).get(Wu.key).next(function(t){return bo(null!==t),t})},t.prototype.Zt=function(t,e){return Wc(t).put(Wu.key,e)},t.prototype.te=function(t,e){return Hc(t).put(Rc(this.R,e))},t.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.Xt(t).next(function(t){return t.targetCount})},t.prototype.getTargetData=function(t,e){var n=ds(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return Hc(t).$t({range:r,index:Qu.queryTargetsIndexName},function(t,n,r){var o=Ac(n);ps(e,o.target)&&(i=o,r.done())}).next(function(){return i})},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=Zc(t);return e.forEach(function(e){var s=Pu(e.path);i.push(o.put(new Hu(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))}),ic.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=Zc(t);return ic.forEach(e,function(e){var o=Pu(e.path);return ic.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])})},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=Zc(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Zc(t),i=Ba();return r.$t({range:n,kt:!0},function(t,e,n){var r=Uu(t[1]),o=new Qo(r);i=i.add(o)}).next(function(){return i})},t.prototype.containsKey=function(t,e){var n=Pu(e.path),r=IDBKeyRange.bound([n],[So(n)],!1,!0),i=0;return Zc(t).$t({index:Hu.documentTargetsIndex,kt:!0,range:r},function(t,e,n){0!==t[0]&&(i++,n.done())}).next(function(){return i>0})},t.prototype.lt=function(t,e){return Hc(t).get(e).next(function(t){return t?Ac(t):null})},t}();function Hc(t){return gc(t,Qu.store)}function Wc(t){return gc(t,Wu.store)}function Zc(t){return gc(t,Hu.store)}function Xc(t){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(e){if(t.code!==co.FAILED_PRECONDITION||t.message!==ec)throw t;return po("LocalStore","Unexpectedly lost primary lease"),[2]})})}function Yc(t,e){var n=t[1],r=e[1],i=Io(t[0],e[0]);return 0===i?Io(n,r):i}var $c=function(){function t(t){this.ne=t,this.buffer=new Pa(Yc),this.se=0}return t.prototype.ie=function(){return++this.se},t.prototype.re=function(t){var e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Yc(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),th=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},t.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){var e=this,n=this.oe?3e5:6e4;po("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,function(){return(0,g.mG)(e,void 0,void 0,function(){var e;return(0,g.Jh)(this,function(n){switch(n.label){case 0:this.ce=null,this.oe=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return cc(e=n.sent())?(po("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,Xc(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return n.sent(),[2]}})})})},t}(),eh=function(){function t(t,e){this.ae=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next(function(t){return Math.floor(e/100*t)})},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return ic.resolve(uo.o);var r=new $c(e);return this.ae.forEachTarget(t,function(t){return r.re(t.sequenceNumber)}).next(function(){return n.ae.le(t,function(t){return r.re(t)})}).next(function(){return r.maxValue})},t.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(po("LruGarbageCollector","Garbage collection skipped; disabled"),ic.resolve(Uc)):this.getCacheSize(t).next(function(r){return r<n.params.cacheSizeCollectionThreshold?(po("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),Uc):n.fe(t,e)})},t.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},t.prototype.fe=function(t,e){var n,r,i,o,s,a,u,c=this,h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(function(e){return e>c.params.maximumSequenceNumbersToCollect?(po("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.maximumSequenceNumbersToCollect+" from "+e),r=c.params.maximumSequenceNumbersToCollect):r=e,o=Date.now(),c.nthSequenceNumber(t,r)}).next(function(r){return n=r,s=Date.now(),c.removeTargets(t,n,e)}).next(function(e){return i=e,a=Date.now(),c.removeOrphanedDocuments(t,n)}).next(function(t){return u=Date.now(),fo()<=$t.in.DEBUG&&po("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(s-o)+"ms\n\tRemoved "+i+" targets in "+(a-s)+"ms\n\tRemoved "+t+" documents in "+(u-a)+"ms\nTotal Duration: "+(u-h)+"ms"),ic.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})})},t}(),nh=function(){function t(t,e){this.db=t,this.garbageCollector=function(t,e){return new eh(t,e)}(this,e)}return t.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.de=function(t){var e=0;return this.le(t,function(t){e++}).next(function(){return e})},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.le=function(t,e){return this.we(t,function(t,n){return e(n)})},t.prototype.addReference=function(t,e,n){return rh(t,n)},t.prototype.removeReference=function(t,e,n){return rh(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return rh(t,e)},t.prototype._e=function(t,e){return function(t,e){var n=!1;return zc(t).Ot(function(r){return Gc(t,r,e).next(function(t){return t&&(n=!0),ic.resolve(!t)})}).next(function(){return n})}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(t,function(s,a){if(a<=e){var u=n._e(t,s).next(function(e){if(!e)return o++,r.getEntry(t,s).next(function(){return r.removeEntry(s),Zc(t).delete([0,Pu(s.path)])})});i.push(u)}}).next(function(){return ic.waitFor(i)}).next(function(){return r.apply(t)}).next(function(){return o})},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return rh(t,e)},t.prototype.we=function(t,e){var n,r=Zc(t),i=uo.o;return r.$t({index:Hu.documentTargetsIndex},function(t,r){var o=r.path,s=r.sequenceNumber;0===t[0]?(i!==uo.o&&e(new Qo(Uu(n)),i),i=s,n=o):i=uo.o}).next(function(){i!==uo.o&&e(new Qo(Uu(n)),i)})},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function rh(t,e){return Zc(t).put(function(t,e){return new Hu(0,Pu(t.path),e)}(e,t.currentSequenceNumber))}var ih=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[1];if(this.equalsFn(o[0],t))return s}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){Do(this.inner,function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];t(o[0],o[1])}})},t.prototype.isEmpty=function(){return No(this.inner)},t}(),oh=function(){function t(){this.changes=new ih(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:Ao.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:hs.newInvalidDocument(t),readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?ic.resolve(n.document):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),sh=function(){function t(t,e){this.R=t,this.Ut=e}return t.prototype.addEntry=function(t,e,n){return ch(t).put(hh(e),n)},t.prototype.removeEntry=function(t,e){var n=ch(t),r=hh(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next(function(r){return r.byteSize+=e,n.me(t,r)})},t.prototype.getEntry=function(t,e){var n=this;return ch(t).get(hh(e)).next(function(t){return n.ye(e,t)})},t.prototype.ge=function(t,e){var n=this;return ch(t).get(hh(e)).next(function(t){return{document:n.ye(e,t),size:Vc(t)}})},t.prototype.getEntries=function(t,e){var n=this,r=Ua();return this.pe(t,e,function(t,e){var i=n.ye(t,e);r=r.insert(t,i)}).next(function(){return r})},t.prototype.Ee=function(t,e){var n=this,r=Ua(),i=new xa(Qo.comparator);return this.pe(t,e,function(t,e){var o=n.ye(t,e);r=r.insert(t,o),i=i.insert(t,Vc(e))}).next(function(){return{documents:r,Te:i}})},t.prototype.pe=function(t,e,n){if(e.isEmpty())return ic.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return ch(t).$t({range:r},function(t,e,r){for(var s=Qo.fromSegments(t);o&&Qo.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()}).next(function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=Ua(),o=e.path.length+1,s={};if(n.isEqual(Ao.min())){var a=e.path.toArray();s.range=IDBKeyRange.lowerBound(a)}else{var u=e.path.toArray(),c=Tc(n);s.range=IDBKeyRange.lowerBound([u,c],!0),s.index=zu.collectionReadTimeIndex}return ch(t).$t(s,function(t,n,s){if(t.length===o){var a=wc(r.R,n);e.path.isPrefixOf(a.key.path)?zs(e,a)&&(i=i.insert(a.key,a)):s.done()}}).next(function(){return i})},t.prototype.newChangeBuffer=function(t){return new ah(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},t.prototype.getMetadata=function(t){return uh(t).get(Ju.key).next(function(t){return bo(!!t),t})},t.prototype.me=function(t,e){return uh(t).put(Ju.key,e)},t.prototype.ye=function(t,e){if(e){var n=wc(this.R,e);if(!n.isNoDocument()||!n.version.isEqual(Ao.min()))return n}return hs.newInvalidDocument(t)},t}(),ah=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Ie=e,r.trackRemovals=n,r.Ae=new ih(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),r}return(0,g.ZT)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new Pa(function(t,e){return Io(t.canonicalString(),e.canonicalString())});return this.changes.forEach(function(o,s){var a=e.Ae.get(o);if(s.document.isValidDocument()){var u=_c(e.Ie.R,s.document,e.getReadTime(o));i=i.add(o.path.popLast());var c=Vc(u);r+=c-a,n.push(e.Ie.addEntry(t,o,u))}else if(r-=a,e.trackRemovals){var h=_c(e.Ie.R,hs.newNoDocument(o,Ao.min()),e.getReadTime(o));n.push(e.Ie.addEntry(t,o,h))}else n.push(e.Ie.removeEntry(t,o))}),i.forEach(function(r){n.push(e.Ie.Ut.addToCollectionParentIndex(t,r))}),n.push(this.Ie.updateMetadata(t,r)),ic.waitFor(n)},e.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next(function(t){return n.Ae.set(e,t.size),t.document})},e.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next(function(t){var e=t.documents;return t.Te.forEach(function(t,e){n.Ae.set(t,e)}),e})},e}(oh);function uh(t){return gc(t,Ju.store)}function ch(t){return gc(t,zu.store)}function hh(t){return t.path.toArray()}var lh=function(){function t(t){this.R=t}return t.prototype.Rt=function(t,e,n,r){var i=this;bo(n<r&&n>=0&&r<=11);var o=new oc("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(qu.store)}(t),function(t){t.createObjectStore(Vu.store,{keyPath:Vu.keyPath}),t.createObjectStore(ju.store,{keyPath:ju.keyPath,autoIncrement:!0}).createIndex(ju.userMutationsIndex,ju.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Gu.store)}(t),fh(t),function(t){t.createObjectStore(zu.store)}(t));var s=ic.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(Hu.store),t.deleteObjectStore(Qu.store),t.deleteObjectStore(Wu.store)}(t),fh(t)),s=s.next(function(){return function(t){var e=t.store(Wu.store),n=new Wu(0,0,Ao.min().toTimestamp(),0);return e.put(Wu.key,n)}(o)})),n<4&&r>=4&&(0!==n&&(s=s.next(function(){return function(t,e){return e.store(ju.store).Nt().next(function(n){t.deleteObjectStore(ju.store),t.createObjectStore(ju.store,{keyPath:ju.keyPath,autoIncrement:!0}).createIndex(ju.userMutationsIndex,ju.userMutationsKeyPath,{unique:!0});var r=e.store(ju.store),i=n.map(function(t){return r.put(t)});return ic.waitFor(i)})}(t,o)})),s=s.next(function(){!function(t){t.createObjectStore(Xu.store,{keyPath:Xu.keyPath})}(t)})),n<5&&r>=5&&(s=s.next(function(){return i.Re(o)})),n<6&&r>=6&&(s=s.next(function(){return function(t){t.createObjectStore(Ju.store)}(t),i.be(o)})),n<7&&r>=7&&(s=s.next(function(){return i.ve(o)})),n<8&&r>=8&&(s=s.next(function(){return i.Pe(t,o)})),n<9&&r>=9&&(s=s.next(function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(zu.store);e.createIndex(zu.readTimeIndex,zu.readTimeIndexPath,{unique:!1}),e.createIndex(zu.collectionReadTimeIndex,zu.collectionReadTimeIndexPath,{unique:!1})}(e)})),n<10&&r>=10&&(s=s.next(function(){return i.Ve(o)})),n<11&&r>=11&&(s=s.next(function(){!function(t){t.createObjectStore(Yu.store,{keyPath:Yu.keyPath})}(t),function(t){t.createObjectStore($u.store,{keyPath:$u.keyPath})}(t)})),s},t.prototype.be=function(t){var e=0;return t.store(zu.store).$t(function(t,n){e+=Vc(n)}).next(function(){var n=new Ju(e);return t.store(Ju.store).put(Ju.key,n)})},t.prototype.Re=function(t){var e=this,n=t.store(Vu.store),r=t.store(ju.store);return n.Nt().next(function(n){return ic.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt(ju.userMutationsIndex,i).next(function(r){return ic.forEach(r,function(r){bo(r.userId===n.userId);var i=kc(e.R,r);return qc(t,n.userId,i).next(function(){})})})})})},t.prototype.ve=function(t){var e=t.store(Hu.store),n=t.store(zu.store);return t.store(Wu.store).get(Wu.key).next(function(t){var r=[];return n.$t(function(n,i){var o=new Co(n),s=function(t){return[0,Pu(t)]}(o);r.push(e.get(s).next(function(n){return n?ic.resolve():function(n){return e.put(new Hu(0,Pu(n),t.highestListenSequenceNumber))}(o)}))}).next(function(){return ic.waitFor(r)})})},t.prototype.Pe=function(t,e){t.createObjectStore(Zu.store,{keyPath:Zu.keyPath});var n=e.store(Zu.store),r=new Pc,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:Pu(i)})}};return e.store(zu.store).$t({kt:!0},function(t,e){var n=new Co(t);return i(n.popLast())}).next(function(){return e.store(Gu.store).$t({kt:!0},function(t,e){var n=Uu(t[1]);return i(n.popLast())})})},t.prototype.Ve=function(t){var e=this,n=t.store(Qu.store);return n.$t(function(t,r){var i=Ac(r),o=Rc(e.R,i);return n.put(o)})},t}();function fh(t){t.createObjectStore(Hu.store,{keyPath:Hu.keyPath}).createIndex(Hu.documentTargetsIndex,Hu.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Qu.store,{keyPath:Qu.keyPath}).createIndex(Qu.queryTargetsIndexName,Qu.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Wu.store)}var dh="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",ph=function(){function t(e,n,r,i,o,s,a,u,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=a,this.De=c,this.Ce=h,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Fe=null,this.inForeground=!1,this.ke=null,this.$e=null,this.Oe=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!t.yt())throw new ho(co.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new nh(this,i),this.Le=n+"main",this.R=new bc(u),this.Be=new sc(this.Le,11,new lh(this.R)),this.qe=new Qc(this.referenceDelegate,this.R),this.Ut=new Lc,this.Ue=function(t,e){return new sh(t,e)}(this.R,this.Ut),this.Ke=new Nc,this.window&&this.window.localStorage?this.Qe=this.window.localStorage:(this.Qe=null,!1===h&&go("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.je().then(function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new ho(co.FAILED_PRECONDITION,dh);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",function(e){return t.qe.getHighestSequenceNumber(e)})}).then(function(e){t.Ne=new uo(e,t.De)}).then(function(){t.xe=!0}).catch(function(e){return t.Be&&t.Be.close(),Promise.reject(e)})},t.prototype.He=function(t){var e=this;return this.Me=function(n){return(0,g.mG)(e,void 0,void 0,function(){return(0,g.Jh)(this,function(e){return this.started?[2,t(n)]:[2]})})},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.Be.vt(function(n){return(0,g.mG)(e,void 0,void 0,function(){return(0,g.Jh)(this,function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})})},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget(function(){return(0,g.mG)(e,void 0,void 0,function(){return(0,g.Jh)(this,function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},t.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return yh(e).put(new Xu(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next(function(){if(t.isPrimary)return t.Je(e).next(function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable(function(){return t.Me(!1)}))})}).next(function(){return t.Ye(e)}).next(function(n){return t.isPrimary&&!n?t.Xe(e).next(function(){return!1}):!!n&&t.Ze(e).next(function(){return!0})})}).catch(function(e){if(cc(e))return po("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return po("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(function(e){t.isPrimary!==e&&t.Se.enqueueRetryable(function(){return t.Me(e)}),t.isPrimary=e})},t.prototype.Je=function(t){var e=this;return gh(t).get(qu.key).next(function(t){return ic.resolve(e.tn(t))})},t.prototype.en=function(t){return yh(t).delete(this.clientId)},t.prototype.nn=function(){return(0,g.mG)(this,void 0,void 0,function(){var t,e,n,r=this;return(0,g.Jh)(this,function(i){switch(i.label){case 0:return!this.isPrimary||this.sn(this.Oe,18e5)?[3,2]:(this.Oe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var e=gc(t,Xu.store);return e.Nt().next(function(t){var n=r.rn(t,18e5),i=t.filter(function(t){return-1===n.indexOf(t)});return ic.forEach(i,function(t){return e.delete(t.clientId)}).next(function(){return i})})}).catch(function(){return[]})]);case 1:if(t=i.sent(),this.Qe)for(e=0,n=t;e<n.length;e++)this.Qe.removeItem(this.on(n[e].clientId));i.label=2;case 2:return[2]}})})},t.prototype.ze=function(){var t=this;this.$e=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,function(){return t.je().then(function(){return t.nn()}).then(function(){return t.ze()})})},t.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Ye=function(t){var e=this;return this.Ce?ic.resolve(!0):gh(t).get(qu.key).next(function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new ho(co.FAILED_PRECONDITION,dh);return!1}}return!(!e.networkEnabled||!e.inForeground)||yh(t).Nt().next(function(t){return void 0===e.rn(t,5e3).find(function(t){return!(e.clientId===t.clientId||!(!e.networkEnabled&&t.networkEnabled||!e.inForeground&&t.inForeground&&e.networkEnabled===t.networkEnabled))})})}).next(function(t){return e.isPrimary!==t&&po("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},t.prototype.shutdown=function(){return(0,g.mG)(this,void 0,void 0,function(){var t=this;return(0,g.Jh)(this,function(e){switch(e.label){case 0:return this.xe=!1,this.un(),this.$e&&(this.$e.cancel(),this.$e=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[qu.store,Xu.store],function(e){var n=new pc(e,uo.o);return t.Xe(n).next(function(){return t.en(n)})})];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}})})},t.prototype.rn=function(t,e){var n=this;return t.filter(function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)})},t.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",function(e){return yh(e).Nt().next(function(e){return t.rn(e,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return jc.Qt(t,this.R,this.Ut,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r,i=this;return po("IndexedDbPersistence","Starting transaction:",t),this.Be.runTransaction(t,"readonly"===e?"readonly":"readwrite",tc,function(o){return r=new pc(o,i.Ne?i.Ne.next():uo.o),"readwrite-primary"===e?i.Je(r).next(function(t){return!!t||i.Ye(r)}).next(function(e){if(!e)throw go("Failed to obtain primary lease for action '"+t+"'."),i.isPrimary=!1,i.Se.enqueueRetryable(function(){return i.Me(!1)}),new ho(co.FAILED_PRECONDITION,ec);return n(r)}).next(function(t){return i.Ze(r).next(function(){return t})}):i.dn(r).next(function(){return n(r)})}).then(function(t){return r.raiseOnCommittedEvent(),t})},t.prototype.dn=function(t){var e=this;return gh(t).get(qu.key).next(function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new ho(co.FAILED_PRECONDITION,dh)})},t.prototype.Ze=function(t){var e=new qu(this.clientId,this.allowTabSynchronization,Date.now());return gh(t).put(qu.key,e)},t.yt=function(){return sc.yt()},t.prototype.Xe=function(t){var e=this,n=gh(t);return n.get(qu.key).next(function(t){return e.tn(t)?(po("IndexedDbPersistence","Releasing primary lease."),n.delete(qu.key)):ic.resolve()})},t.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(go("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ke=function(){t.Se.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.je()})},this.document.addEventListener("visibilitychange",this.ke),this.inForeground="visible"===this.document.visibilityState)},t.prototype.an=function(){this.ke&&(this.document.removeEventListener("visibilitychange",this.ke),this.ke=null)},t.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Fe=function(){e.un(),(0,y.G6)()&&navigator.appVersion.match("Version/14")&&e.Se.enterRestrictedMode(!0),e.Se.enqueueAndForget(function(){return e.shutdown()})},this.window.addEventListener("pagehide",this.Fe))},t.prototype.hn=function(){this.Fe&&(this.window.removeEventListener("pagehide",this.Fe),this.Fe=null)},t.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Qe)||void 0===e?void 0:e.getItem(this.on(t)));return po("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return go("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.un=function(){if(this.Qe)try{this.Qe.setItem(this.on(this.clientId),String(Date.now()))}catch(t){go("Failed to set zombie client id.",t)}},t.prototype.ln=function(){if(this.Qe)try{this.Qe.removeItem(this.on(this.clientId))}catch(t){}},t.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function gh(t){return gc(t,qu.store)}function yh(t){return gc(t,Xu.store)}function mh(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var vh=function(t,e){this.progress=t,this.wn=e},bh=function(){function t(t,e,n){this.Ue=t,this._n=e,this.Ut=n}return t.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next(function(r){return n.yn(t,e,r)})},t.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next(function(t){for(var e=0,r=n;e<r.length;e++)r[e].applyToLocalView(t);return t})},t.prototype.gn=function(t,e){t.forEach(function(t,n){for(var r=0,i=e;r<i.length;r++)i[r].applyToLocalView(n)})},t.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next(function(e){return n.En(t,e).next(function(){return e})})},t.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(t){return n.gn(e,t)})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return function(t){return Qo.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Tn(t,e.path):Ms(e)?this.In(t,e,n):this.An(t,e,n)},t.prototype.Tn=function(t,e){return this.mn(t,new Qo(e)).next(function(t){var e=qa();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e})},t.prototype.In=function(t,e,n){var r=this,i=e.collectionGroup,o=qa();return this.Ut.getCollectionParents(t,i).next(function(s){return ic.forEach(s,function(s){var a=function(t,e){return new xs(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(i));return r.An(t,a,n).next(function(t){t.forEach(function(t,e){o=o.insert(t,e)})})}).next(function(){return o})})},t.prototype.An=function(t,e,n){var r,i,o=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next(function(n){return r=n,o._n.getAllMutationBatchesAffectingQuery(t,e)}).next(function(e){return o.Rn(t,i=e,r).next(function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key,h=r.get(c);null==h&&(h=hs.newInvalidDocument(c),r=r.insert(c,h)),ga(u,h,o.localWriteTime),h.isFoundDocument()||(r=r.remove(c))}})}).next(function(){return r.forEach(function(t,n){zs(e,n)||(r=r.remove(t))}),r})},t.prototype.Rn=function(t,e,n){for(var r=Ba(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof wa&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next(function(t){return t.forEach(function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))}),c})},t}(),wh=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}return t.Pn=function(e,n){for(var r=Ba(),i=Ba(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),_h=function(){function t(){}return t.prototype.Vn=function(t){this.Sn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var i=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(Ao.min())?this.Dn(t,e):this.Sn.pn(t,r).next(function(o){var s=i.Cn(e,o);return(Ps(e)||Ls(e))&&i.Nn(e.limitType,s,r,n)?i.Dn(t,e):(fo()<=$t.in.DEBUG&&po("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Ks(e)),i.Sn.getDocumentsMatchingQuery(t,e,n).next(function(t){return s.forEach(function(e){t=t.insert(e.key,e)}),t}))})},t.prototype.Cn=function(t,e){var n=new Pa(Js(t));return e.forEach(function(e,r){zs(t,r)&&(n=n.add(r))}),n},t.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.Dn=function(t,e){return fo()<=$t.in.DEBUG&&po("QueryEngine","Using full collection scan to execute query:",Ks(e)),this.Sn.getDocumentsMatchingQuery(t,e,Ao.min())},t}(),Th=function(){function t(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.Fn=new xa(Io),this.kn=new ih(function(t){return ds(t)},ps),this.$n=Ao.min(),this._n=t.getMutationQueue(n),this.On=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new bh(this.On,this._n,this.persistence.getIndexManager()),this.Ke=t.getBundleCache(),this.xn.Vn(this.Mn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(n){return t.collect(n,e.Fn)})},t}();function Ih(t,e,n,r){return new Th(t,e,n,r)}function Eh(t,e){return(0,g.mG)(this,void 0,void 0,function(){var n,r,i,o;return(0,g.Jh)(this,function(s){switch(s.label){case 0:return n=wo(t),r=n._n,i=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",function(t){var o;return n._n.getAllMutationBatches(t).next(function(s){return o=s,r=n.persistence.getMutationQueue(e),i=new bh(n.On,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)}).next(function(e){for(var n=[],r=[],s=Ba(),a=0,u=o;a<u.length;a++){var c=u[a];n.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++)s=s.add(l[h].key)}for(var f=0,d=e;f<d.length;f++){var p=d[f];r.push(p.batchId);for(var g=0,y=p.mutations;g<y.length;g++)s=s.add(y[g].key)}return i.pn(t,s).next(function(t){return{Ln:t,removedBatchIds:n,addedBatchIds:r}})})})];case 1:return o=s.sent(),[2,(n._n=r,n.Mn=i,n.xn.Vn(n.Mn),o)]}})})}function Sh(t,e){var n=wo(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var r=e.batch.keys(),i=n.On.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=ic.resolve();return o.forEach(function(t){s=s.next(function(){return r.getEntry(e,t)}).next(function(e){var o=n.docVersions.get(t);bo(null!==o),e.version.compareTo(o)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&r.addEntry(e,n.commitVersion))})}),s.next(function(){return t._n.removeMutationBatch(e,i)})}(n,t,e,i).next(function(){return i.apply(t)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}function kh(t){var e=wo(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.qe.getLastRemoteSnapshotVersion(t)})}function Ah(t,e){var n=wo(t),r=e.snapshotVersion,i=n.Fn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",function(t){var o=n.On.newChangeBuffer({trackRemovals:!0});i=n.Fn;var s=[];e.targetChanges.forEach(function(e,o){var a=i.get(o);if(a){s.push(n.qe.removeMatchingKeys(t,e.removedDocuments,o).next(function(){return n.qe.addMatchingKeys(t,e.addedDocuments,o)}));var u=e.resumeToken;if(u.approximateByteSize()>0){var c=a.withResumeToken(u,r).withSequenceNumber(t.currentSequenceNumber);i=i.insert(o,c),function(t,e,n){return bo(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,c,e)&&s.push(n.qe.updateTargetData(t,c))}}});var a=Ua();if(e.documentUpdates.forEach(function(r,i){e.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))}),s.push(Rh(t,o,e.documentUpdates,r,void 0).next(function(t){a=t})),!r.isEqual(Ao.min())){var u=n.qe.getLastRemoteSnapshotVersion(t).next(function(e){return n.qe.setTargetsMetadata(t,t.currentSequenceNumber,r)});s.push(u)}return ic.waitFor(s).next(function(){return o.apply(t)}).next(function(){return n.Mn.En(t,a)}).next(function(){return a})}).then(function(t){return n.Fn=i,t})}function Rh(t,e,n,r,i){var o=Ba();return n.forEach(function(t){return o=o.add(t)}),e.getEntries(t,o).next(function(t){var o=Ua();return n.forEach(function(n,s){var a=t.get(n),u=(null==i?void 0:i.get(n))||r;s.isNoDocument()&&s.version.isEqual(Ao.min())?(e.removeEntry(n,u),o=o.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(s,u),o=o.insert(n,s)):po("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)}),o})}function Dh(t,e){var n=wo(t);return n.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e)})}function Nh(t,e){var n=wo(t);return n.persistence.runTransaction("Allocate target","readwrite",function(t){var r;return n.qe.getTargetData(t,e).next(function(i){return i?ic.resolve(r=i):n.qe.allocateTargetId(t).next(function(i){return r=new vc(e,i,0,t.currentSequenceNumber),n.qe.addTargetData(t,r).next(function(){return r})})})}).then(function(t){var r=n.Fn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Fn=n.Fn.insert(t.targetId,t),n.kn.set(e,t.targetId)),t})}function xh(t,e,n){return(0,g.mG)(this,void 0,void 0,function(){var r,i,o,s;return(0,g.Jh)(this,function(a){switch(a.label){case 0:r=wo(t),i=r.Fn.get(e),o=n?"readwrite":"readwrite-primary",a.label=1;case 1:return a.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,function(t){return r.persistence.referenceDelegate.removeTarget(t,i)})];case 2:a.sent(),a.label=3;case 3:return[3,5];case 4:if(!cc(s=a.sent()))throw s;return po("LocalStore","Failed to update sequence numbers for target "+e+": "+s),[3,5];case 5:return r.Fn=r.Fn.remove(e),r.kn.delete(i.target),[2]}})})}function Ch(t,e,n){var r=wo(t),i=Ao.min(),o=Ba();return r.persistence.runTransaction("Execute query","readonly",function(t){return function(t,e,n){var r=wo(t),i=r.kn.get(n);return void 0!==i?ic.resolve(r.Fn.get(i)):r.qe.getTargetData(e,n)}(r,t,Vs(e)).next(function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(t,e.targetId).next(function(t){o=t})}).next(function(){return r.xn.getDocumentsMatchingQuery(t,e,n?i:Ao.min(),n?o:Ba())}).next(function(t){return{documents:t,Bn:o}})})}function Oh(t,e){var n=wo(t),r=wo(n.qe),i=n.Fn.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.lt(t,e).next(function(t){return t?t.target:null})})}function Ph(t){var e=wo(t);return e.persistence.runTransaction("Get new document changes","readonly",function(t){return function(t,e,n){var r=wo(t),i=Ua(),o=Tc(n),s=ch(e),a=IDBKeyRange.lowerBound(o,!0);return s.$t({index:zu.readTimeIndex,range:a},function(t,e){var n=wc(r.R,e);i=i.insert(n.key,n),o=e.readTime}).next(function(){return{wn:i,readTime:Ic(o)}})}(e.On,t,e.$n)}).then(function(t){var n=t.wn;return e.$n=t.readTime,n})}function Lh(t){return(0,g.mG)(this,void 0,void 0,function(){var e;return(0,g.Jh)(this,function(n){return[2,(e=wo(t)).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return function(t){var e=ch(t),n=Ao.min();return e.$t({index:zu.readTimeIndex,reverse:!0},function(t,e,r){e.readTime&&(n=Ic(e.readTime)),r.done()}).next(function(){return n})}(t)}).then(function(t){e.$n=t})]})})}function Fh(t,e,n,r){return(0,g.mG)(this,void 0,void 0,function(){var i,o,s,a,u,c,h,l,f,d;return(0,g.Jh)(this,function(p){switch(p.label){case 0:for(i=wo(t),o=Ba(),s=Ua(),a=ja(),u=0,c=n;u<c.length;u++)l=e.qn((h=c[u]).metadata.name),h.document&&(o=o.add(l)),s=s.insert(l,e.Un(h)),a=a.insert(l,e.Kn(h.metadata.readTime));return f=i.On.newChangeBuffer({trackRemovals:!0}),[4,Nh(i,function(t){return Vs(Os(Co.fromString("__bundle__/docs/"+t)))}(r))];case 1:return d=p.sent(),[2,i.persistence.runTransaction("Apply bundle documents","readwrite",function(t){return Rh(t,f,s,Ao.min(),a).next(function(e){return f.apply(t),e}).next(function(e){return i.qe.removeMatchingKeysForTargetId(t,d.targetId).next(function(){return i.qe.addMatchingKeys(t,o,d.targetId)}).next(function(){return i.Mn.En(t,e)}).next(function(){return e})})})]}})})}function Uh(t,e,n){return void 0===n&&(n=Ba()),(0,g.mG)(this,void 0,void 0,function(){var r,i;return(0,g.Jh)(this,function(o){switch(o.label){case 0:return[4,Nh(t,Vs(Dc(e.bundledQuery)))];case 1:return r=o.sent(),[2,(i=wo(t)).persistence.runTransaction("Save named query","readwrite",function(t){var o=au(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Ke.saveNamedQuery(t,e);var s=r.withResumeToken(Fo.EMPTY_BYTE_STRING,o);return i.Fn=i.Fn.insert(s.targetId,s),i.qe.updateTargetData(t,s).next(function(){return i.qe.removeMatchingKeysForTargetId(t,r.targetId)}).next(function(){return i.qe.addMatchingKeys(t,n,r.targetId)}).next(function(){return i.Ke.saveNamedQuery(t,e)})})]}})})}var Mh=function(){function t(t){this.R=t,this.Qn=new Map,this.jn=new Map}return t.prototype.getBundleMetadata=function(t,e){return ic.resolve(this.Qn.get(e))},t.prototype.saveBundleMetadata=function(t,e){var n;return this.Qn.set(e.id,{id:(n=e).id,version:n.version,createTime:au(n.createTime)}),ic.resolve()},t.prototype.getNamedQuery=function(t,e){return ic.resolve(this.jn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,function(t){return{name:t.name,query:Dc(t.bundledQuery),readTime:au(t.readTime)}}(e)),ic.resolve()},t}(),qh=function(){function t(){this.Wn=new Pa(Vh.Gn),this.zn=new Pa(Vh.Hn)}return t.prototype.isEmpty=function(){return this.Wn.isEmpty()},t.prototype.addReference=function(t,e){var n=new Vh(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)},t.prototype.Jn=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},t.prototype.removeReference=function(t,e){this.Yn(new Vh(t,e))},t.prototype.Xn=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},t.prototype.Zn=function(t){var e=this,n=new Qo(new Co([])),r=new Vh(n,t),i=new Vh(n,t+1),o=[];return this.zn.forEachInRange([r,i],function(t){e.Yn(t),o.push(t.key)}),o},t.prototype.ts=function(){var t=this;this.Wn.forEach(function(e){return t.Yn(e)})},t.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},t.prototype.es=function(t){var e=new Qo(new Co([])),n=new Vh(e,t),r=new Vh(e,t+1),i=Ba();return this.zn.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},t.prototype.containsKey=function(t){var e=new Vh(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),Vh=function(){function t(t,e){this.key=t,this.ns=e}return t.Gn=function(t,e){return Qo.comparator(t.key,e.key)||Io(t.ns,e.ns)},t.Hn=function(t,e){return Io(t.ns,e.ns)||Qo.comparator(t.key,e.key)},t}(),jh=function(){function t(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new Pa(Vh.Gn)}return t.prototype.checkEmpty=function(t){return ic.resolve(0===this._n.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++;var o=new yc(i,e,n,r);this._n.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.rs=this.rs.add(new Vh(u.key,i)),this.Ut.addToCollectionParentIndex(t,u.key.path.popLast())}return ic.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return ic.resolve(this.os(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this.cs(e+1),r=n<0?0:n;return ic.resolve(this._n.length>r?this._n[r]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return ic.resolve(0===this._n.length?-1:this.ss-1)},t.prototype.getAllMutationBatches=function(t){return ic.resolve(this._n.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new Vh(e,0),i=new Vh(e,Number.POSITIVE_INFINITY),o=[];return this.rs.forEachInRange([r,i],function(t){var e=n.os(t.ns);o.push(e)}),ic.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Pa(Io);return e.forEach(function(t){var e=new Vh(t,0),i=new Vh(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,i],function(t){r=r.add(t.ns)})}),ic.resolve(this.us(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;Qo.isDocumentKey(i)||(i=i.child(""));var o=new Vh(new Qo(i),0),s=new Pa(Io);return this.rs.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.ns)),!0)},o),ic.resolve(this.us(s))},t.prototype.us=function(t){var e=this,n=[];return t.forEach(function(t){var r=e.os(t);null!==r&&n.push(r)}),n},t.prototype.removeMutationBatch=function(t,e){var n=this;bo(0===this.hs(e.batchId,"removed")),this._n.shift();var r=this.rs;return ic.forEach(e.mutations,function(i){var o=new Vh(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(function(){n.rs=r})},t.prototype.Gt=function(t){},t.prototype.containsKey=function(t,e){var n=new Vh(e,0),r=this.rs.firstAfterOrEqual(n);return ic.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return ic.resolve()},t.prototype.hs=function(t,e){return this.cs(t)},t.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},t.prototype.os=function(t){var e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]},t}(),Gh=function(){function t(t,e){this.Ut=t,this.ls=e,this.docs=new xa(Qo.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:s,readTime:n}),this.size+=s-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return ic.resolve(n?n.document.clone():hs.newInvalidDocument(e))},t.prototype.getEntries=function(t,e){var n=this,r=Ua();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():hs.newInvalidDocument(t))}),ic.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=Ua(),i=new Qo(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.value,u=a.document,c=a.readTime;if(!e.path.isPrefixOf(s.key.path))break;c.compareTo(n)<=0||zs(e,u)&&(r=r.insert(u.key,u.clone()))}return ic.resolve(r)},t.prototype.fs=function(t,e){return ic.forEach(this.docs,function(t){return e(t)})},t.prototype.newChangeBuffer=function(t){return new Bh(this)},t.prototype.getSize=function(t){return ic.resolve(this.size)},t}(),Bh=function(t){function e(e){var n=this;return(n=t.call(this)||this).Ie=e,n}return(0,g.ZT)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach(function(r,i){i.document.isValidDocument()?n.push(e.Ie.addEntry(t,i.document,e.getReadTime(r))):e.Ie.removeEntry(r)}),ic.waitFor(n)},e.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},e}(oh),Kh=function(){function t(t){this.persistence=t,this.ds=new ih(function(t){return ds(t)},ps),this.lastRemoteSnapshotVersion=Ao.min(),this.highestTargetId=0,this.ws=0,this._s=new qh,this.targetCount=0,this.ys=Jc.Jt()}return t.prototype.forEachTarget=function(t,e){return this.ds.forEach(function(t,n){return e(n)}),ic.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return ic.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return ic.resolve(this.ws)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),ic.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),ic.resolve()},t.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new Jc(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,ic.resolve()},t.prototype.updateTargetData=function(t,e){return this.te(e),ic.resolve()},t.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,ic.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.ds.forEach(function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.ds.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)}),ic.waitFor(o).next(function(){return i})},t.prototype.getTargetCount=function(t){return ic.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.ds.get(e)||null;return ic.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),ic.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.markPotentiallyOrphaned(t,e))}),ic.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),ic.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this._s.es(e);return ic.resolve(n)},t.prototype.containsKey=function(t,e){return ic.resolve(this._s.containsKey(e))},t}(),zh=function(){function t(t,e){var n=this;this.gs={},this.Ne=new uo(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new Kh(this),this.Ut=new Oc,this.Ue=function(t,e){return new Gh(t,function(t){return n.referenceDelegate.ps(t)})}(this.Ut),this.R=new bc(e),this.Ke=new Mh(this.R)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new jh(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r=this;po("MemoryPersistence","Starting transaction:",t);var i=new Jh(this.Ne.next());return this.referenceDelegate.Es(),n(i).next(function(t){return r.referenceDelegate.Ts(i).next(function(){return t})}).toPromise().then(function(t){return i.raiseOnCommittedEvent(),t})},t.prototype.Is=function(t,e){return ic.or(Object.values(this.gs).map(function(n){return function(){return n.containsKey(t,e)}}))},t}(),Jh=function(t){function e(e){var n=this;return(n=t.call(this)||this).currentSequenceNumber=e,n}return(0,g.ZT)(e,t),e}(nc),Qh=function(){function t(t){this.persistence=t,this.As=new qh,this.Rs=null}return t.bs=function(e){return new t(e)},Object.defineProperty(t.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw vo()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),ic.resolve()},t.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),ic.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),ic.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach(function(t){return n.vs.add(t.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.vs.add(t.toString())})}).next(function(){return r.removeTargetData(t,e)})},t.prototype.Es=function(){this.Rs=new Set},t.prototype.Ts=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ic.forEach(this.vs,function(r){var i=Qo.fromPath(r);return e.Ps(t,i).next(function(t){t||n.removeEntry(i)})}).next(function(){return e.Rs=null,n.apply(t)})},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next(function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())})},t.prototype.ps=function(t){return 0},t.prototype.Ps=function(t,e){var n=this;return ic.or([function(){return ic.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},t}(),Hh=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();function Wh(t,e){return"firestore_clients_"+t+"_"+e}function Zh(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function Xh(t,e){return"firestore_targets_"+t+"_"+e}Hh.UNAUTHENTICATED=new Hh(null),Hh.GOOGLE_CREDENTIALS=new Hh("google-credentials-uid"),Hh.FIRST_PARTY=new Hh("first-party-uid");var Yh=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Vs=function(e,n,r){var i,o=JSON.parse(r),s="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return s&&o.error&&(s="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(i=new ho(o.error.code,o.error.message)),s?new t(e,n,o.state,i):(go("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),$h=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Vs=function(e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new ho(i.error.code,i.error.message)),o?new t(e,i.state,r):(go("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),tl=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Vs=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=za(),s=0;i&&s<r.activeTargetIds.length;++s)i=Jo(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(go("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),el=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Vs=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(go("SharedClientState","Failed to parse online state: "+e),null)},t}(),nl=function(){function t(){this.activeTargetIds=za()}return t.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),rl=function(){function t(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.Fs.bind(this),this.ks=new xa(Io),this.started=!1,this.$s=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Os=Wh(this.persistenceKey,this.Ns),this.Ms=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.ks=this.ks.insert(this.Ns,new nl),this.Ls=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Us=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Ks=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return t.yt=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return(0,g.mG)(this,void 0,void 0,function(){var t,e,n,r,i,o,s,a,u,c,h=this;return(0,g.Jh)(this,function(l){switch(l.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=l.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.Ns&&(i=this.getItem(Wh(this.persistenceKey,r)))&&(o=tl.Vs(r,i))&&(this.ks=this.ks.insert(o.clientId,o));for(this.Qs(),(s=this.storage.getItem(this.Us))&&(a=this.js(s))&&this.Ws(a),u=0,c=this.$s;u<c.length;u++)this.Fs(c[u]);return this.$s=[],this.window.addEventListener("pagehide",function(){return h.shutdown()}),this.started=!0,[2]}})})},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.ks)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.ks.forEach(function(n,r){r.activeTargetIds.has(t)&&(e=!0)}),e},t.prototype.addPendingMutation=function(t){this.zs(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(Xh(this.persistenceKey,t));if(n){var r=$h.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.Qs(),e},t.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Qs()},t.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(Xh(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.Hs(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},t.prototype.setOnlineState=function(t){this.Xs(t)},t.prototype.notifyBundleLoaded=function(){this.Zs()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Os),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return po("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){po("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){po("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.Fs=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(po("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Os)return void go("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable(function(){return(0,g.mG)(e,void 0,void 0,function(){var t,e,r,i,o,s;return(0,g.Jh)(this,function(a){if(this.started){if(null!==n.key)if(this.Ls.test(n.key)){if(null==n.newValue)return t=this.ti(n.key),[2,this.ei(t,null)];if(e=this.ni(n.key,n.newValue))return[2,this.ei(e.clientId,e)]}else if(this.Bs.test(n.key)){if(null!==n.newValue&&(r=this.si(n.key,n.newValue)))return[2,this.ii(r)]}else if(this.qs.test(n.key)){if(null!==n.newValue&&(i=this.ri(n.key,n.newValue)))return[2,this.oi(i)]}else if(n.key===this.Us){if(null!==n.newValue&&(o=this.js(n.newValue)))return[2,this.Ws(o)]}else if(n.key===this.Ms)(s=function(t){var e=uo.o;if(null!=t)try{var n=JSON.parse(t);bo("number"==typeof n),e=n}catch(t){go("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==uo.o&&this.sequenceNumberHandler(s);else if(n.key===this.Ks)return[2,this.syncEngine.ci()]}else this.$s.push(n);return[2]})})})}},Object.defineProperty(t.prototype,"Js",{get:function(){return this.ks.get(this.Ns)},enumerable:!1,configurable:!0}),t.prototype.Qs=function(){this.setItem(this.Os,this.Js.Ss())},t.prototype.zs=function(t,e,n){var r=new Yh(this.currentUser,t,e,n),i=Zh(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Ss())},t.prototype.Hs=function(t){var e=Zh(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Xs=function(t){this.storage.setItem(this.Us,JSON.stringify({clientId:this.Ns,onlineState:t}))},t.prototype.Ys=function(t,e,n){var r=Xh(this.persistenceKey,t),i=new $h(t,e,n);this.setItem(r,i.Ss())},t.prototype.Zs=function(){this.setItem(this.Ks,"value-not-used")},t.prototype.ti=function(t){var e=this.Ls.exec(t);return e?e[1]:null},t.prototype.ni=function(t,e){var n=this.ti(t);return tl.Vs(n,e)},t.prototype.si=function(t,e){var n=this.Bs.exec(t),r=Number(n[1]);return Yh.Vs(new Hh(void 0!==n[2]?n[2]:null),r,e)},t.prototype.ri=function(t,e){var n=this.qs.exec(t),r=Number(n[1]);return $h.Vs(r,e)},t.prototype.js=function(t){return el.Vs(t)},t.prototype.ii=function(t){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(po("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])})})},t.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},t.prototype.ei=function(t,e){var n=this,r=e?this.ks.insert(t,e):this.ks.remove(t),i=this.Gs(this.ks),o=this.Gs(r),s=[],a=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||a.push(t)}),this.syncEngine.hi(s,a).then(function(){n.ks=r})},t.prototype.Ws=function(t){this.ks.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Gs=function(t){var e=za();return t.forEach(function(t,n){e=e.unionWith(n.activeTargetIds)}),e},t}(),il=function(){function t(){this.li=new nl,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},t.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.fi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.start=function(){return this.li=new nl,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),ol=function(){function t(){}return t.prototype.di=function(t){},t.prototype.shutdown=function(){},t}(),sl=function(){function t(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return t.prototype.di=function(t){this.gi.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},t.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},t.prototype._i=function(){po("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},t.prototype.yi=function(){po("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},t.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),al={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},ul=function(){function t(t){this.Ei=t.Ei,this.Ti=t.Ti}return t.prototype.Ii=function(t){this.Ai=t},t.prototype.Ri=function(t){this.bi=t},t.prototype.onMessage=function(t){this.vi=t},t.prototype.close=function(){this.Ti()},t.prototype.send=function(t){this.Ei(t)},t.prototype.Pi=function(){this.Ai()},t.prototype.Vi=function(t){this.bi(t)},t.prototype.Si=function(t){this.vi(t)},t}(),cl=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.autoDetectLongPolling=e.autoDetectLongPolling,n.useFetchStreams=e.useFetchStreams,n}return(0,g.ZT)(e,t),e.prototype.ki=function(t,e,n,r){return new Promise(function(i,o){var s=new ao;s.listenOnce(ro.COMPLETE,function(){try{switch(s.getLastErrorCode()){case no.NO_ERROR:var e=s.getResponseJson();po("Connection","XHR received:",JSON.stringify(e)),i(e);break;case no.TIMEOUT:po("Connection",'RPC "'+t+'" timed out'),o(new ho(co.DEADLINE_EXCEEDED,"Request time out"));break;case no.HTTP_ERROR:var n=s.getStatus();if(po("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var a=function(t){var e=t.toLowerCase().replace(/_/g,"-");return Object.values(co).indexOf(e)>=0?e:co.UNKNOWN}(r.status);o(new ho(a,r.message))}else o(new ho(co.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new ho(co.UNAVAILABLE,"Connection failed."));break;default:vo()}}finally{po("Connection",'RPC "'+t+'" completed.')}});var a=JSON.stringify(r);s.send(e,"POST",a,n,15)})},e.prototype.Oi=function(t,e){var n=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=new Xi,i=zn(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new oo({})),this.Fi(o.initMessageHeaders,e),(0,y.uI)()||(0,y.b$)()||(0,y.d)()||(0,y.w1)()||(0,y.Mn)()||(0,y.ru)()||(o.httpHeadersOverwriteParam="$httpHeaders");var s=n.join("");po("Connection","Creating WebChannel: "+s,o);var a=r.createWebChannel(s,o),u=!1,c=!1,h=new ul({Ei:function(t){c?po("Connection","Not sending because WebChannel is closed:",t):(u||(po("Connection","Opening WebChannel transport."),a.open(),u=!0),po("Connection","WebChannel sending:",t),a.send(t))},Ti:function(){return a.close()}}),l=function(t,e,n){t.listen(e,function(t){try{n(t)}catch(t){setTimeout(function(){throw t},0)}})};return l(a,so.EventType.OPEN,function(){c||po("Connection","WebChannel transport opened.")}),l(a,so.EventType.CLOSE,function(){c||(c=!0,po("Connection","WebChannel transport closed"),h.Vi())}),l(a,so.EventType.ERROR,function(t){c||(c=!0,yo("Connection","WebChannel transport errored:",t),h.Vi(new ho(co.UNAVAILABLE,"The operation could not be completed")))}),l(a,so.EventType.MESSAGE,function(t){var e;if(!c){var n=t.data[0];bo(!!n);var r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error);if(r){po("Connection","WebChannel received error:",r);var i=r.status,o=function(t){var e=Ea[t];if(void 0!==e)return Na(e)}(i),s=r.message;void 0===o&&(o=co.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),c=!0,h.Vi(new ho(o,s)),a.close()}else po("Connection","WebChannel received:",n),h.Si(n)}}),l(i,io.STAT_EVENT,function(t){10===t.stat?po("Connection","Detected buffering proxy"):11===t.stat&&po("Connection","Detected no buffering proxy")}),setTimeout(function(){h.Pi()},0),h},e}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId,this.Di=(t.ssl?"https":"http")+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return t.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);po("RestConnection","Sending: ",i,n);var o={};return this.Fi(o,r),this.ki(t,i,o,n).then(function(t){return po("RestConnection","Received: ",t),t},function(e){throw yo("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e})},t.prototype.$i=function(t,e,n,r){return this.Ni(t,e,n,r)},t.prototype.Fi=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.8.0",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.xi=function(t,e){return this.Di+"/v1/"+e+":"+al[t]},t}());function hl(){return"undefined"!=typeof window?window:null}function ll(){return"undefined"!=typeof document?document:null}function fl(t){return new ru(t,!0)}var dl=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Ki=Date.now(),this.reset()}return t.prototype.reset=function(){this.qi=0},t.prototype.Qi=function(){this.qi=this.Bi},t.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Ki),i=Math.max(0,n-r);i>0&&po("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,function(){return e.Ki=Date.now(),t()}),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},t.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},t.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},t.prototype.Wi=function(){return(Math.random()-.5)*this.qi},t}(),pl=function(){function t(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new dl(t,e)}return t.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.er=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.nr()},t.prototype.stop=function(){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.sr=function(){this.state=0,this.Zi.reset()},t.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,function(){return t.rr()}))},t.prototype.cr=function(t){this.ur(),this.stream.send(t)},t.prototype.rr=function(){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(t){return this.er()?[2,this.close(0)]:[2]})})},t.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},t.prototype.close=function(t,e){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(n){switch(n.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===co.RESOURCE_EXHAUSTED?(go(e.toString()),go("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Qi()):e&&e.code===co.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(e)];case 1:return n.sent(),[2]}})})},t.prototype.ar=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then(function(e){t.Yi===n&&t.lr(e)},function(n){e(function(){var e=new ho(co.UNKNOWN,"Fetching auth token failed: "+n.message);return t.dr(e)})})},t.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii(function(){n(function(){return e.state=2,e.listener.Ii()})}),this.stream.Ri(function(t){n(function(){return e.dr(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},t.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji(function(){return(0,g.mG)(t,void 0,void 0,function(){return(0,g.Jh)(this,function(t){return this.state=0,this.start(),[2]})})})},t.prototype.dr=function(t){return po("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget(function(){return e.Yi===t?n():(po("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},t}(),gl=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).R=i,s}return(0,g.ZT)(e,t),e.prototype.wr=function(t){return this.Hi.Oi("Listen",t)},e.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){var n;if("targetChange"in e){var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:vo()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.I?(bo(void 0===e||"string"==typeof e),Fo.fromBase64String(e||"")):(bo(void 0===e||e instanceof Uint8Array),Fo.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=(a=e.targetChange.cause)&&function(t){var e=void 0===t.code?co.UNKNOWN:Na(t.code);return new ho(e,t.message||"")}(a);n=new Za(r,i,o,s||null)}else if("documentChange"in e){i=lu(t,(r=e.documentChange).document.name),o=au(r.document.updateTime);var a=new us({mapValue:{fields:r.document.fields}}),u=(s=hs.newFoundDocument(i,o,a),r.targetIds||[]);n=new Ha(u,r.removedTargetIds||[],s.key,s)}else if("documentDelete"in e)i=lu(t,(r=e.documentDelete).document),o=r.readTime?au(r.readTime):Ao.min(),a=hs.newNoDocument(i,o),n=new Ha([],s=r.removedTargetIds||[],a.key,a);else if("documentRemove"in e)i=lu(t,(r=e.documentRemove).document),n=new Ha([],o=r.removedTargetIds||[],i,null);else{if(!("filter"in e))return vo();var c=e.filter;i=new Ra(r=c.count||0),n=new Wa(o=c.targetId,i)}return n}(this.R,t),n=function(t){if(!("targetChange"in t))return Ao.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?Ao.min():e.readTime?au(e.readTime):Ao.min()}(t);return this.listener._r(e,n)},e.prototype.mr=function(t){var e={};e.database=pu(this.R),e.addTarget=function(t,e){var n,r=e.target;return(n=gs(r)?{documents:wu(t,r)}:{query:_u(t,r)}).targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=ou(t,e.resumeToken):e.snapshotVersion.compareTo(Ao.min())>0&&(n.readTime=iu(t,e.snapshotVersion.toTimestamp())),n}(this.R,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return vo()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(0,t);n&&(e.labels=n),this.cr(e)},e.prototype.yr=function(t){var e={};e.database=pu(this.R),e.removeTarget=t,this.cr(e)},e}(pl),yl=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).R=i,s.gr=!1,s}return(0,g.ZT)(e,t),Object.defineProperty(e.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.ar=function(){this.gr&&this.Er([])},e.prototype.wr=function(t){return this.Hi.Oi("Write",t)},e.prototype.onMessage=function(t){if(bo(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=function(t,e){return t&&t.length>0?(bo(void 0!==e),t.map(function(t){return function(t,e){var n=au(t.updateTime?t.updateTime:e);return n.isEqual(Ao.min())&&(n=au(e)),new ha(n,t.transformResults||[])}(t,e)})):[]}(t.writeResults,t.commitTime),n=au(t.commitTime);return this.listener.Tr(n,e)}return bo(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},e.prototype.Ar=function(){var t={};t.database=pu(this.R),this.cr(t)},e.prototype.Er=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map(function(t){return vu(e.R,t)})};this.cr(n)},e}(pl),ml=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Hi=n,i.R=r,i.Rr=!1,i}return(0,g.ZT)(e,t),e.prototype.br=function(){if(this.Rr)throw new ho(co.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.Ni=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.Ni(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===co.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new ho(co.UNKNOWN,t.toString())})},e.prototype.$i=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.$i(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===co.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new ho(co.UNKNOWN,t.toString())})},e.prototype.terminate=function(){this.Rr=!0},e}(function(){}),vl=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return t.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()}))},t.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.Fr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},t.prototype.set=function(t){this.Fr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},t.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Cr=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(go(e),this.Vr=!1):po("OnlineStateTracker",e)},t.prototype.Fr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},t}(),bl=function(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.kr=[],this.$r=new Map,this.Or=new Set,this.Mr=[],this.Lr=i,this.Lr.di(function(t){n.enqueueAndForget(function(){return(0,g.mG)(o,void 0,void 0,function(){return(0,g.Jh)(this,function(t){switch(t.label){case 0:return Rl(this)?(po("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return(0,g.mG)(this,void 0,void 0,function(){var e;return(0,g.Jh)(this,function(n){switch(n.label){case 0:return(e=wo(t)).Or.add(4),[4,_l(e)];case 1:return n.sent(),e.Br.set("Unknown"),e.Or.delete(4),[4,wl(e)];case 2:return n.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Br=new vl(n,r)};function wl(t){return(0,g.mG)(this,void 0,void 0,function(){var e,n;return(0,g.Jh)(this,function(r){switch(r.label){case 0:if(!Rl(t))return[3,4];e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function _l(t){return(0,g.mG)(this,void 0,void 0,function(){var e,n;return(0,g.Jh)(this,function(r){switch(r.label){case 0:e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Tl(t,e){var n=wo(t);n.$r.has(e.targetId)||(n.$r.set(e.targetId,e),Al(n)?kl(n):Bl(n).er()&&El(n,e))}function Il(t,e){var n=wo(t),r=Bl(n);n.$r.delete(e),r.er()&&Sl(n,e),0===n.$r.size&&(r.er()?r.ir():Rl(n)&&n.Br.set("Unknown"))}function El(t,e){t.qr.U(e.targetId),Bl(t).mr(e)}function Sl(t,e){t.qr.U(e),Bl(t).yr(e)}function kl(t){t.qr=new Ya({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.$r.get(e)||null}}),Bl(t).start(),t.Br.Sr()}function Al(t){return Rl(t)&&!Bl(t).tr()&&t.$r.size>0}function Rl(t){return 0===wo(t).Or.size}function Dl(t){t.qr=void 0}function Nl(t){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(e){return t.$r.forEach(function(e,n){El(t,e)}),[2]})})}function xl(t,e){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(n){return Dl(t),Al(t)?(t.Br.Nr(e),kl(t)):t.Br.set("Unknown"),[2]})})}function Cl(t,e,n){return(0,g.mG)(this,void 0,void 0,function(){var r,i,o;return(0,g.Jh)(this,function(s){switch(s.label){case 0:if(t.Br.set("Online"),!(e instanceof Za&&2===e.state&&e.cause))return[3,6];s.label=1;case 1:return s.trys.push([1,3,,5]),[4,function(t,e){return(0,g.mG)(this,void 0,void 0,function(){var n,r,i,o;return(0,g.Jh)(this,function(s){switch(s.label){case 0:n=e.cause,r=0,i=e.targetIds,s.label=1;case 1:return r<i.length?t.$r.has(o=i[r])?[4,t.remoteSyncer.rejectListen(o,n)]:[3,3]:[3,5];case 2:s.sent(),t.$r.delete(o),t.qr.removeTarget(o),s.label=3;case 3:s.label=4;case 4:return r++,[3,1];case 5:return[2]}})})}(t,e)];case 2:return s.sent(),[3,5];case 3:return r=s.sent(),po("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),[4,Ol(t,r)];case 4:return s.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof Ha?t.qr.X(e):e instanceof Wa?t.qr.rt(e):t.qr.et(e),n.isEqual(Ao.min()))return[3,13];s.label=7;case 7:return s.trys.push([7,11,,13]),[4,kh(t.localStore)];case 8:return i=s.sent(),n.compareTo(i)>=0?[4,function(t,e){var n=t.qr.ut(e);return n.targetChanges.forEach(function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=t.$r.get(r);i&&t.$r.set(r,i.withResumeToken(n.resumeToken,e))}}),n.targetMismatches.forEach(function(e){var n=t.$r.get(e);if(n){t.$r.set(e,n.withResumeToken(Fo.EMPTY_BYTE_STRING,n.snapshotVersion)),Sl(t,e);var r=new vc(n.target,e,1,n.sequenceNumber);El(t,r)}}),t.remoteSyncer.applyRemoteEvent(n)}(t,n)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,13];case 11:return po("RemoteStore","Failed to raise snapshot:",o=s.sent()),[4,Ol(t,o)];case 12:return s.sent(),[3,13];case 13:return[2]}})})}function Ol(t,e,n){return(0,g.mG)(this,void 0,void 0,function(){var r=this;return(0,g.Jh)(this,function(i){switch(i.label){case 0:if(!cc(e))throw e;return t.Or.add(1),[4,_l(t)];case 1:return i.sent(),t.Br.set("Offline"),n||(n=function(){return kh(t.localStore)}),t.asyncQueue.enqueueRetryable(function(){return(0,g.mG)(r,void 0,void 0,function(){return(0,g.Jh)(this,function(e){switch(e.label){case 0:return po("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.Or.delete(1),[4,wl(t)];case 2:return e.sent(),[2]}})})}),[2]}})})}function Pl(t,e){return e().catch(function(n){return Ol(t,n,e)})}function Ll(t){return(0,g.mG)(this,void 0,void 0,function(){var e,n,r,i,o;return(0,g.Jh)(this,function(s){switch(s.label){case 0:e=wo(t),n=Kl(e),r=e.kr.length>0?e.kr[e.kr.length-1].batchId:-1,s.label=1;case 1:if(!function(t){return Rl(t)&&t.kr.length<10}(e))return[3,7];s.label=2;case 2:return s.trys.push([2,4,,6]),[4,Dh(e.localStore,r)];case 3:return null===(i=s.sent())?(0===e.kr.length&&n.ir(),[3,7]):(r=i.batchId,function(t,e){t.kr.push(e);var n=Kl(t);n.er()&&n.pr&&n.Er(e.mutations)}(e,i),[3,6]);case 4:return o=s.sent(),[4,Ol(e,o)];case 5:return s.sent(),[3,6];case 6:return[3,1];case 7:return Fl(e)&&Ul(e),[2]}})})}function Fl(t){return Rl(t)&&!Kl(t).tr()&&t.kr.length>0}function Ul(t){Kl(t).start()}function Ml(t){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(e){return Kl(t).Ar(),[2]})})}function ql(t){return(0,g.mG)(this,void 0,void 0,function(){var e,n,r;return(0,g.Jh)(this,function(i){for(e=Kl(t),n=0,r=t.kr;n<r.length;n++)e.Er(r[n].mutations);return[2]})})}function Vl(t,e,n){return(0,g.mG)(this,void 0,void 0,function(){var r,i;return(0,g.Jh)(this,function(o){switch(o.label){case 0:return r=t.kr.shift(),i=mc.from(r,e,n),[4,Pl(t,function(){return t.remoteSyncer.applySuccessfulWrite(i)})];case 1:return o.sent(),[4,Ll(t)];case 2:return o.sent(),[2]}})})}function jl(t,e){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(n){switch(n.label){case 0:return e&&Kl(t).pr?[4,function(t,e){return(0,g.mG)(this,void 0,void 0,function(){var n,r;return(0,g.Jh)(this,function(i){switch(i.label){case 0:return Da(r=e.code)&&r!==co.ABORTED?(n=t.kr.shift(),Kl(t).sr(),[4,Pl(t,function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)})]):[3,3];case 1:return i.sent(),[4,Ll(t)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return Fl(t)&&Ul(t),[2]}})})}function Gl(t,e){return(0,g.mG)(this,void 0,void 0,function(){var n;return(0,g.Jh)(this,function(r){switch(r.label){case 0:return n=wo(t),e?(n.Or.delete(2),[4,wl(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.Or.add(2),[4,_l(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}})})}function Bl(t){var e=this;return t.Ur||(t.Ur=function(t,e,n){var r=wo(t);return r.br(),new gl(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:Nl.bind(null,t),Ri:xl.bind(null,t),_r:Cl.bind(null,t)}),t.Mr.push(function(n){return(0,g.mG)(e,void 0,void 0,function(){return(0,g.Jh)(this,function(e){switch(e.label){case 0:return n?(t.Ur.sr(),Al(t)?kl(t):t.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:e.sent(),Dl(t),e.label=3;case 3:return[2]}})})})),t.Ur}function Kl(t){var e=this;return t.Kr||(t.Kr=function(t,e,n){var r=wo(t);return r.br(),new yl(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:Ml.bind(null,t),Ri:jl.bind(null,t),Ir:ql.bind(null,t),Tr:Vl.bind(null,t)}),t.Mr.push(function(n){return(0,g.mG)(e,void 0,void 0,function(){return(0,g.Jh)(this,function(e){switch(e.label){case 0:return n?(t.Kr.sr(),[4,Ll(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.Kr.stop()];case 3:e.sent(),t.kr.length>0&&(po("RemoteStore","Stopping write stream with "+t.kr.length+" pending writes"),t.kr=[]),e.label=4;case 4:return[2]}})})})),t.Kr}var zl=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new rc,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new ho(co.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(e){return t.deferred.resolve(e)})):Promise.resolve()})},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function Jl(t,e){if(go("AsyncQueue",e+": "+t),cc(t))return new ho(co.UNAVAILABLE,e+": "+t);throw t}var Ql=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||Qo.comparator(e.key,n.key)}:function(t,e){return Qo.comparator(t.key,e.key)},this.keyedMap=qa(),this.sortedSet=new xa(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),Hl=function(){function t(){this.Qr=new xa(Qo.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Qr.get(e);n?0!==t.type&&3===n.type?this.Qr=this.Qr.insert(e,t):3===t.type&&1!==n.type?this.Qr=this.Qr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Qr=this.Qr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Qr=this.Qr.remove(e):1===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):vo():this.Qr=this.Qr.insert(e,t)},t.prototype.jr=function(){var t=[];return this.Qr.inorderTraversal(function(e,n){t.push(n)}),t},t}(),Wl=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach(function(t){o.push({type:0,doc:t})}),new t(e,n,Ql.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Gs(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),Zl=function(){this.Wr=void 0,this.listeners=[]},Xl=function(){this.queries=new ih(function(t){return Bs(t)},Gs),this.onlineState="Unknown",this.Gr=new Set};function Yl(t,e){return(0,g.mG)(this,void 0,void 0,function(){var n,r,i,o,s,a,u;return(0,g.Jh)(this,function(c){switch(c.label){case 0:if(n=wo(t),i=!1,(o=n.queries.get(r=e.query))||(i=!0,o=new Zl),!i)return[3,4];c.label=1;case 1:return c.trys.push([1,3,,4]),s=o,[4,n.onListen(r)];case 2:return s.Wr=c.sent(),[3,4];case 3:return a=c.sent(),u=Jl(a,"Initialization of query '"+Ks(e.query)+"' failed"),[2,void e.onError(u)];case 4:return n.queries.set(r,o),o.listeners.push(e),e.zr(n.onlineState),o.Wr&&e.Hr(o.Wr)&&nf(n),[2]}})})}function $l(t,e){return(0,g.mG)(this,void 0,void 0,function(){var n,r,i,o,s;return(0,g.Jh)(this,function(a){return n=wo(t),i=!1,(o=n.queries.get(r=e.query))&&(s=o.listeners.indexOf(e))>=0&&(o.listeners.splice(s,1),i=0===o.listeners.length),i?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]})})}function tf(t,e){for(var n=wo(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=n.queries.get(s.query);if(a){for(var u=0,c=a.listeners;u<c.length;u++)c[u].Hr(s)&&(r=!0);a.Wr=s}}r&&nf(n)}function ef(t,e,n){var r=wo(t),i=r.queries.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(e)}function nf(t){t.Gr.forEach(function(t){t.next()})}var rf=function(){function t(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new Wl(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},t.prototype.onError=function(t){this.Jr.error(t)},t.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},t.prototype.eo=function(t,e){return!t.fromCache||!(this.options.so&&"Offline"!==e||t.docs.isEmpty()&&"Offline"!==e)},t.prototype.Zr=function(t){return t.docChanges.length>0||!!(t.syncStateChanged||this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites)&&!0===this.options.includeMetadataChanges},t.prototype.no=function(t){t=Wl.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},t}(),of=function(){function t(t,e){this.payload=t,this.byteLength=e}return t.prototype.io=function(){return"metadata"in this.payload},t}(),sf=function(){function t(t){this.R=t}return t.prototype.qn=function(t){return lu(this.R,t)},t.prototype.Un=function(t){return t.metadata.exists?mu(this.R,t.document,!1):hs.newNoDocument(this.qn(t.metadata.name),this.Kn(t.metadata.readTime))},t.prototype.Kn=function(t){return au(t)},t}();!function(){function t(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=function(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(t)}t.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},t.prototype.co=function(t){for(var e=new Map,n=new sf(this.R),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.qn(o.metadata.name),a=0,u=o.metadata.queries;a<u.length;a++){var c=u[a],h=(e.get(c)||Ba()).add(s);e.set(c,h)}}return e},t.prototype.complete=function(){return(0,g.mG)(this,void 0,void 0,function(){var t,e,n,r,i;return(0,g.Jh)(this,function(o){switch(o.label){case 0:return[4,Fh(this.localStore,new sf(this.R),this.documents,this.ro.id)];case 1:t=o.sent(),e=this.co(this.documents),n=0,r=this.queries,o.label=2;case 2:return n<r.length?[4,Uh(this.localStore,i=r[n],e.get(i.name))]:[3,5];case 3:o.sent(),o.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState="Success",new vh(Object.assign({},this.progress),t))]}})})}}();var af=function(t){this.key=t},uf=function(t){this.key=t},cf=function(){function t(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=Ba(),this.mutatedKeys=Ba(),this.lo=Js(t),this.fo=new Ql(this.lo)}return Object.defineProperty(t.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),t.prototype._o=function(t,e){var n=this,r=e?e.mo:new Hl,i=e?e.fo:this.fo,o=e?e.mutatedKeys:this.mutatedKeys,s=i,a=!1,u=Ps(this.query)&&i.size===this.query.limit?i.last():null,c=Ls(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal(function(t,e){var h=i.get(t),l=zs(n.query,e)?e:null,f=!!h&&n.mutatedKeys.has(h.key),d=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations),p=!1;h&&l?h.data.isEqual(l.data)?f!==d&&(r.track({type:3,doc:l}),p=!0):n.yo(h,l)||(r.track({type:2,doc:l}),p=!0,(u&&n.lo(l,u)>0||c&&n.lo(l,c)<0)&&(a=!0)):!h&&l?(r.track({type:0,doc:l}),p=!0):h&&!l&&(r.track({type:1,doc:h}),p=!0,(u||c)&&(a=!0)),p&&(l?(s=s.add(l),o=d?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))}),Ps(this.query)||Ls(this.query))for(;s.size>this.query.limit;){var h=Ps(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{fo:s,mo:r,Nn:a,mutatedKeys:o}},t.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var o=t.mo.jr();o.sort(function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return vo()}};return n(t)-n(e)}(t.type,e.type)||r.lo(t.doc,e.doc)}),this.po(n);var s=e?this.Eo():[],a=0===this.ho.size&&this.current?1:0,u=a!==this.ao;return this.ao=a,0!==o.length||u?{snapshot:new Wl(this.query,t.fo,i,o,t.mutatedKeys,0===a,u,!1),To:s}:{To:s}},t.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new Hl,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},t.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},t.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e.uo=e.uo.add(t)}),t.modifiedDocuments.forEach(function(t){}),t.removedDocuments.forEach(function(t){return e.uo=e.uo.delete(t)}),this.current=t.current)},t.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=Ba(),this.fo.forEach(function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))});var n=[];return e.forEach(function(e){t.ho.has(e)||n.push(new uf(e))}),this.ho.forEach(function(t){e.has(t)||n.push(new af(t))}),n},t.prototype.Ao=function(t){this.uo=t.Bn,this.ho=Ba();var e=this._o(t.documents);return this.applyChanges(e,!0)},t.prototype.Ro=function(){return Wl.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},t}(),hf=function(t,e,n){this.query=t,this.targetId=e,this.view=n},lf=function(t){this.key=t,this.bo=!1},ff=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new ih(function(t){return Bs(t)},Gs),this.Vo=new Map,this.So=new Set,this.Do=new xa(Qo.comparator),this.Co=new Map,this.No=new qh,this.xo={},this.Fo=new Map,this.ko=Jc.Yt(),this.onlineState="Unknown",this.$o=void 0}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.$o},enumerable:!1,configurable:!0}),t}();function df(t,e){return(0,g.mG)(this,void 0,void 0,function(){var n,r,i,o,s;return(0,g.Jh)(this,function(a){switch(a.label){case 0:return n=Gf(t),(i=n.Po.get(e))?(n.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.Ro(),[3,4]):[3,1];case 1:return[4,Nh(n.localStore,Vs(e))];case 2:return o=a.sent(),s=n.sharedClientState.addLocalQueryTarget(o.targetId),[4,pf(n,e,o.targetId,"current"===s)];case 3:r=a.sent(),n.isPrimaryClient&&Tl(n.remoteStore,o),a.label=4;case 4:return[2,r]}})})}function pf(t,e,n,r){return(0,g.mG)(this,void 0,void 0,function(){var i,o,s,a,u,c;return(0,g.Jh)(this,function(h){switch(h.label){case 0:return t.Oo=function(e,n,r){return function(t,e,n,r){return(0,g.mG)(this,void 0,void 0,function(){var i,o,s;return(0,g.Jh)(this,function(a){switch(a.label){case 0:return(i=e.view._o(n)).Nn?[4,Ch(t.localStore,e.query,!1).then(function(t){return e.view._o(t.documents,i)})]:[3,2];case 1:i=a.sent(),a.label=2;case 2:return o=r&&r.targetChanges.get(e.targetId),s=e.view.applyChanges(i,t.isPrimaryClient,o),[2,(Af(t,e.targetId,s.To),s.snapshot)]}})})}(t,e,n,r)},[4,Ch(t.localStore,e,!0)];case 1:return i=h.sent(),o=new cf(e,i.Bn),s=o._o(i.documents),a=Qa.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState),u=o.applyChanges(s,t.isPrimaryClient,a),Af(t,n,u.To),c=new hf(e,n,o),[2,(t.Po.set(e,c),t.Vo.has(n)?t.Vo.get(n).push(e):t.Vo.set(n,[e]),u.snapshot)]}})})}function gf(t,e){return(0,g.mG)(this,void 0,void 0,function(){var n,r,i;return(0,g.Jh)(this,function(o){switch(o.label){case 0:return n=wo(t),r=n.Po.get(e),(i=n.Vo.get(r.targetId)).length>1?[2,(n.Vo.set(r.targetId,i.filter(function(t){return!Gs(t,e)})),void n.Po.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,xh(n.localStore,r.targetId,!1).then(function(){n.sharedClientState.clearQueryState(r.targetId),Il(n.remoteStore,r.targetId),Sf(n,r.targetId)}).catch(Xc)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return Sf(n,r.targetId),[4,xh(n.localStore,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}})})}function yf(t,e,n){return(0,g.mG)(this,void 0,void 0,function(){var r,i,o,s;return(0,g.Jh)(this,function(a){switch(a.label){case 0:r=Bf(t),a.label=1;case 1:return a.trys.push([1,5,,6]),[4,function(t,e){var n,r=wo(t),i=ko.now(),o=e.reduce(function(t,e){return t.add(e.key)},Ba());return r.persistence.runTransaction("Locally write mutations","readwrite",function(t){return r.Mn.pn(t,o).next(function(o){n=o;for(var s=[],a=0,u=e;a<u.length;a++){var c=u[a],h=ya(c,n.get(c.key));null!=h&&s.push(new wa(c.key,h,cs(h.value.mapValue),la.exists(!0)))}return r._n.addMutationBatch(t,i,s,e)})}).then(function(t){return t.applyToLocalDocumentSet(n),{batchId:t.batchId,changes:n}})}(r.localStore,e)];case 2:return i=a.sent(),r.sharedClientState.addPendingMutation(i.batchId),function(t,e,n){var r=t.xo[t.currentUser.toKey()];r||(r=new xa(Io)),r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(r,i.batchId,n),[4,Nf(r,i.changes)];case 3:return a.sent(),[4,Ll(r.remoteStore)];case 4:return a.sent(),[3,6];case 5:return o=a.sent(),s=Jl(o,"Failed to persist write"),n.reject(s),[3,6];case 6:return[2]}})})}function mf(t,e){return(0,g.mG)(this,void 0,void 0,function(){var n,r;return(0,g.Jh)(this,function(i){switch(i.label){case 0:n=wo(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,Ah(n.localStore,e)];case 2:return r=i.sent(),e.targetChanges.forEach(function(t,e){var r=n.Co.get(e);r&&(bo(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.bo=!0:t.modifiedDocuments.size>0?bo(r.bo):t.removedDocuments.size>0&&(bo(r.bo),r.bo=!1))}),[4,Nf(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,Xc(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}})})}function vf(t,e,n){var r=wo(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Po.forEach(function(t,n){var r=n.view.zr(e);r.snapshot&&i.push(r.snapshot)}),function(t,e){var n=wo(t);n.onlineState=e;var r=!1;n.queries.forEach(function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].zr(e)&&(r=!0)}),r&&nf(n)}(r.eventManager,e),i.length&&r.vo._r(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function bf(t,e,n){return(0,g.mG)(this,void 0,void 0,function(){var r,i,o,s,a,u;return(0,g.Jh)(this,function(c){switch(c.label){case 0:return(r=wo(t)).sharedClientState.updateQueryState(e,"rejected",n),i=r.Co.get(e),(o=i&&i.key)?(s=(s=new xa(Qo.comparator)).insert(o,hs.newNoDocument(o,Ao.min())),a=Ba().add(o),u=new Ja(Ao.min(),new Map,new Pa(Io),s,a),[4,mf(r,u)]):[3,2];case 1:return c.sent(),r.Do=r.Do.remove(o),r.Co.delete(e),Df(r),[3,4];case 2:return[4,xh(r.localStore,e,!1).then(function(){return Sf(r,e,n)}).catch(Xc)];case 3:c.sent(),c.label=4;case 4:return[2]}})})}function wf(t,e){return(0,g.mG)(this,void 0,void 0,function(){var n,r,i;return(0,g.Jh)(this,function(o){switch(o.label){case 0:n=wo(t),r=e.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,Sh(n.localStore,e)];case 2:return i=o.sent(),Ef(n,r,null),If(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,Nf(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,Xc(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function _f(t,e,n){return(0,g.mG)(this,void 0,void 0,function(){var r,i;return(0,g.Jh)(this,function(o){switch(o.label){case 0:r=wo(t),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,function(t,e){var n=wo(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",function(t){var r;return n._n.lookupMutationBatch(t,e).next(function(e){return bo(null!==e),r=e.keys(),n._n.removeMutationBatch(t,e)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}(r.localStore,e)];case 2:return i=o.sent(),Ef(r,e,n),If(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),[4,Nf(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,Xc(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function Tf(t,e){return(0,g.mG)(this,void 0,void 0,function(){var n,r,i,o,s;return(0,g.Jh)(this,function(a){switch(a.label){case 0:Rl((n=wo(t)).remoteStore)||po("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,function(t){var e=wo(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e._n.getHighestUnacknowledgedBatchId(t)})}(n.localStore)];case 2:return-1===(r=a.sent())?[2,void e.resolve()]:((i=n.Fo.get(r)||[]).push(e),n.Fo.set(r,i),[3,4]);case 3:return o=a.sent(),s=Jl(o,"Initialization of waitForPendingWrites() operation failed"),e.reject(s),[3,4];case 4:return[2]}})})}function If(t,e){(t.Fo.get(e)||[]).forEach(function(t){t.resolve()}),t.Fo.delete(e)}function Ef(t,e,n){var r=wo(t),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i}}function Sf(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach(function(e){t.No.containsKey(e)||kf(t,e)})}function kf(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(Il(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),Df(t))}function Af(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof af?(t.No.addReference(o.key,e),Rf(t,o)):o instanceof uf?(po("SyncEngine","Document no longer in limbo: "+o.key),t.No.removeReference(o.key,e),t.No.containsKey(o.key)||kf(t,o.key)):vo()}}function Rf(t,e){var n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||(po("SyncEngine","New document in limbo: "+n),t.So.add(r),Df(t))}function Df(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new Qo(Co.fromString(e)),r=t.ko.next();t.Co.set(r,new lf(n)),t.Do=t.Do.insert(n,r),Tl(t.remoteStore,new vc(Vs(Os(n.path)),r,2,uo.o))}}function Nf(t,e,n){return(0,g.mG)(this,void 0,void 0,function(){var r,i,o,s;return(0,g.Jh)(this,function(a){switch(a.label){case 0:return r=wo(t),i=[],o=[],s=[],r.Po.isEmpty()?[3,3]:(r.Po.forEach(function(t,a){s.push(r.Oo(a,e,n).then(function(t){if(t){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,t.fromCache?"not-current":"current"),i.push(t);var e=wh.Pn(a.targetId,t);o.push(e)}}))}),[4,Promise.all(s)]);case 1:return a.sent(),r.vo._r(i),[4,function(t,e){return(0,g.mG)(this,void 0,void 0,function(){var n,r,i,o,s,a,u,c;return(0,g.Jh)(this,function(h){switch(h.label){case 0:n=wo(t),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(t){return ic.forEach(e,function(e){return ic.forEach(e.bn,function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)}).next(function(){return ic.forEach(e.vn,function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)})})})})];case 2:return h.sent(),[3,4];case 3:if(!cc(r=h.sent()))throw r;return po("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(i=0,o=e;i<o.length;i++)a=(s=o[i]).targetId,s.fromCache||(u=n.Fn.get(a),c=u.withLastLimboFreeSnapshotVersion(u.snapshotVersion),n.Fn=n.Fn.insert(a,c));return[2]}})})}(r.localStore,o)];case 2:a.sent(),a.label=3;case 3:return[2]}})})}function xf(t,e){return(0,g.mG)(this,void 0,void 0,function(){var n,r;return(0,g.Jh)(this,function(i){switch(i.label){case 0:return(n=wo(t)).currentUser.isEqual(e)?[3,3]:(po("SyncEngine","User change. New user:",e.toKey()),[4,Eh(n.localStore,e)]);case 1:return r=i.sent(),n.currentUser=e,function(t,e){t.Fo.forEach(function(t){t.forEach(function(t){t.reject(new ho(co.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),t.Fo.clear()}(n),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),[4,Nf(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}function Cf(t,e){var n=wo(t),r=n.Co.get(e);if(r&&r.bo)return Ba().add(r.key);var i=Ba(),o=n.Vo.get(e);if(!o)return i;for(var s=0,a=o;s<a.length;s++){var u=n.Po.get(a[s]);i=i.unionWith(u.view.wo)}return i}function Of(t,e){return(0,g.mG)(this,void 0,void 0,function(){var n,r,i;return(0,g.Jh)(this,function(o){switch(o.label){case 0:return[4,Ch((n=wo(t)).localStore,e.query,!0)];case 1:return r=o.sent(),i=e.view.Ao(r),[2,(n.isPrimaryClient&&Af(n,e.targetId,i.To),i)]}})})}function Pf(t){return(0,g.mG)(this,void 0,void 0,function(){var e;return(0,g.Jh)(this,function(n){return[2,Ph((e=wo(t)).localStore).then(function(t){return Nf(e,t)})]})})}function Lf(t,e,n,r){return(0,g.mG)(this,void 0,void 0,function(){var i,o;return(0,g.Jh)(this,function(s){switch(s.label){case 0:return[4,function(t,e){var n=wo(t),r=wo(n._n);return n.persistence.runTransaction("Lookup mutation documents","readonly",function(t){return r.jt(t,e).next(function(e){return e?n.Mn.pn(t,e):ic.resolve(null)})})}((i=wo(t)).localStore,e)];case 1:return null===(o=s.sent())?[3,6]:"pending"!==n?[3,3]:[4,Ll(i.remoteStore)];case 2:return s.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(Ef(i,e,r||null),If(i,e),function(t,e){wo(wo(t)._n).Gt(e)}(i.localStore,e)):vo(),s.label=4;case 4:return[4,Nf(i,o)];case 5:return s.sent(),[3,7];case 6:po("SyncEngine","Cannot apply mutation batch with id: "+e),s.label=7;case 7:return[2]}})})}function Ff(t,e){return(0,g.mG)(this,void 0,void 0,function(){var n,r,i,o,s,a,u;return(0,g.Jh)(this,function(c){switch(c.label){case 0:return Gf(n=wo(t)),Bf(n),!0!==e||!0===n.$o?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,Uf(n,r.toArray())]);case 1:return i=c.sent(),n.$o=!0,[4,Gl(n.remoteStore,!0)];case 2:for(c.sent(),o=0,s=i;o<s.length;o++)Tl(n.remoteStore,s[o]);return[3,7];case 3:return!1!==e||!1===n.$o?[3,7]:(a=[],u=Promise.resolve(),n.Vo.forEach(function(t,e){n.sharedClientState.isLocalQueryTarget(e)?a.push(e):u=u.then(function(){return Sf(n,e),xh(n.localStore,e,!0)}),Il(n.remoteStore,e)}),[4,u]);case 4:return c.sent(),[4,Uf(n,a)];case 5:return c.sent(),function(t){var e=wo(t);e.Co.forEach(function(t,n){Il(e.remoteStore,n)}),e.No.ts(),e.Co=new Map,e.Do=new xa(Qo.comparator)}(n),n.$o=!1,[4,Gl(n.remoteStore,!1)];case 6:c.sent(),c.label=7;case 7:return[2]}})})}function Uf(t,e,n){return(0,g.mG)(this,void 0,void 0,function(){var n,r,i,o,s,a,u,c,h,l,f,d,p;return(0,g.Jh)(this,function(g){switch(g.label){case 0:n=wo(t),r=[],i=[],o=0,s=e,g.label=1;case 1:return o<s.length?(u=void 0,(c=n.Vo.get(a=s[o]))&&0!==c.length?[4,Nh(n.localStore,Vs(c[0]))]:[3,7]):[3,13];case 2:u=g.sent(),h=0,l=c,g.label=3;case 3:return h<l.length?(f=n.Po.get(l[h]),[4,Of(n,f)]):[3,6];case 4:(d=g.sent()).snapshot&&i.push(d.snapshot),g.label=5;case 5:return h++,[3,3];case 6:return[3,11];case 7:return[4,Oh(n.localStore,a)];case 8:return p=g.sent(),[4,Nh(n.localStore,p)];case 9:return u=g.sent(),[4,pf(n,Mf(p),a,!1)];case 10:g.sent(),g.label=11;case 11:r.push(u),g.label=12;case 12:return o++,[3,1];case 13:return[2,(n.vo._r(i),r)]}})})}function Mf(t){return Cs(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function qf(t){var e=wo(t);return wo(wo(e.localStore).persistence).fn()}function Vf(t,e,n,r){return(0,g.mG)(this,void 0,void 0,function(){var i,o,s;return(0,g.Jh)(this,function(a){switch(a.label){case 0:return(i=wo(t)).$o?(po("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Vo.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,Ph(i.localStore)];case 3:return o=a.sent(),s=Ja.createSynthesizedRemoteEventForCurrentChange(e,"current"===n),[4,Nf(i,o,s)];case 4:return a.sent(),[3,8];case 5:return[4,xh(i.localStore,e,!0)];case 6:return a.sent(),Sf(i,e,r),[3,8];case 7:vo(),a.label=8;case 8:return[2]}})})}function jf(t,e,n){return(0,g.mG)(this,void 0,void 0,function(){var r,i,o,s,a,u,c,h,l;return(0,g.Jh)(this,function(f){switch(f.label){case 0:if(!(r=Gf(t)).$o)return[3,10];i=0,o=e,f.label=1;case 1:return i<o.length?r.Vo.has(s=o[i])?(po("SyncEngine","Adding an already active target "+s),[3,5]):[4,Oh(r.localStore,s)]:[3,6];case 2:return a=f.sent(),[4,Nh(r.localStore,a)];case 3:return u=f.sent(),[4,pf(r,Mf(a),u.targetId,!1)];case 4:f.sent(),Tl(r.remoteStore,u),f.label=5;case 5:return i++,[3,1];case 6:c=function(t){return(0,g.Jh)(this,function(e){switch(e.label){case 0:return r.Vo.has(t)?[4,xh(r.localStore,t,!1).then(function(){Il(r.remoteStore,t),Sf(r,t)}).catch(Xc)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})},h=0,l=n,f.label=7;case 7:return h<l.length?[5,c(l[h])]:[3,10];case 8:f.sent(),f.label=9;case 9:return h++,[3,7];case 10:return[2]}})})}function Gf(t){var e=wo(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=mf.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Cf.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=bf.bind(null,e),e.vo._r=tf.bind(null,e.eventManager),e.vo.Mo=ef.bind(null,e.eventManager),e}function Bf(t){var e=wo(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=wf.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=_f.bind(null,e),e}var Kf=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(e){switch(e.label){case 0:return this.R=fl(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Ko(t),[2]}})})},t.prototype.Uo=function(t){return null},t.prototype.Ko=function(t){return Ih(this.persistence,new _h,t.initialUser,this.R)},t.prototype.qo=function(t){return new zh(Qh.bs,this.R)},t.prototype.Bo=function(t){return new il},t.prototype.terminate=function(){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}})})},t}(),zf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Qo=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return(0,g.ZT)(e,t),e.prototype.initialize=function(e){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(n){switch(n.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return n.sent(),[4,Lh(this.localStore)];case 2:return n.sent(),[4,this.Qo.initialize(this,e)];case 3:return n.sent(),[4,Bf(this.Qo.syncEngine)];case 4:return n.sent(),[4,Ll(this.Qo.remoteStore)];case 5:return n.sent(),[2]}})})},e.prototype.Ko=function(t){return Ih(this.persistence,new _h,t.initialUser,this.R)},e.prototype.Uo=function(t){return new th(this.persistence.referenceDelegate.garbageCollector,t.asyncQueue)},e.prototype.qo=function(t){var e=mh(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Mc.withCacheSize(this.cacheSizeBytes):Mc.DEFAULT;return new ph(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,hl(),ll(),this.R,this.sharedClientState,!!this.forceOwnership)},e.prototype.Bo=function(t){return new il},e}(Kf),Jf=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Qo=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return(0,g.ZT)(e,t),e.prototype.initialize=function(e){return(0,g.mG)(this,void 0,void 0,function(){var n,r=this;return(0,g.Jh)(this,function(i){switch(i.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return i.sent(),n=this.Qo.syncEngine,this.sharedClientState instanceof rl?(this.sharedClientState.syncEngine={ui:Lf.bind(null,n),ai:Vf.bind(null,n),hi:jf.bind(null,n),fn:qf.bind(null,n),ci:Pf.bind(null,n)},[4,this.sharedClientState.start()]):[3,3];case 2:i.sent(),i.label=3;case 3:return[4,this.persistence.He(function(t){return(0,g.mG)(r,void 0,void 0,function(){return(0,g.Jh)(this,function(e){switch(e.label){case 0:return[4,Ff(this.Qo.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}})})})];case 4:return i.sent(),[2]}})})},e.prototype.Bo=function(t){var e=hl();if(!rl.yt(e))throw new ho(co.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=mh(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new rl(e,t.asyncQueue,n,t.clientId,t.initialUser)},e}(zf),Qf=function(){function t(){}return t.prototype.initialize=function(t,e){return(0,g.mG)(this,void 0,void 0,function(){var n=this;return(0,g.Jh)(this,function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return vf(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=xf.bind(null,this.syncEngine),[4,Gl(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}})})},t.prototype.createEventManager=function(t){return new Xl},t.prototype.createDatastore=function(t){var e=fl(t.databaseInfo.databaseId),n=new cl(t.databaseInfo);return function(t,e,n){return new ml(t,e,n)}(t.credentials,n,e)},t.prototype.createRemoteStore=function(t){var e,n,r,i,o,s=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=function(t){return vf(s.syncEngine,t,0)},o=sl.yt()?new sl:new ol,new bl(e,n,r,i,o)},t.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){var a=new ff(t,e,n,r,i,o);return s&&(a.$o=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},t.prototype.terminate=function(){return function(t){return(0,g.mG)(this,void 0,void 0,function(){var e;return(0,g.Jh)(this,function(n){switch(n.label){case 0:return e=wo(t),po("RemoteStore","RemoteStore shutting down."),e.Or.add(5),[4,_l(e)];case 1:return n.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}})})}(this.remoteStore)},t}(),Hf=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Wo=function(){this.muted=!0},t.prototype.jo=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},t}(),Wf=(function(){function t(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new rc,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then(function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))},function(t){return n.metadata.reject(t)})}t.prototype.close=function(){return this.Go.cancel()},t.prototype.getMetadata=function(){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(t){return[2,this.metadata.promise]})})},t.prototype.Lo=function(){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}})})},t.prototype.Ho=function(){return(0,g.mG)(this,void 0,void 0,function(){var t,e,n,r;return(0,g.Jh)(this,function(i){switch(i.label){case 0:return[4,this.Jo()];case 1:return null===(t=i.sent())?[2,null]:(e=this.zo.decode(t),n=Number(e),isNaN(n)&&this.Yo("length string ("+e+") is not valid number"),[4,this.Xo(n)]);case 2:return r=i.sent(),[2,new of(JSON.parse(r),t.length+n)]}})})},t.prototype.Zo=function(){return this.buffer.findIndex(function(t){return t==="{".charCodeAt(0)})},t.prototype.Jo=function(){return(0,g.mG)(this,void 0,void 0,function(){var t,e;return(0,g.Jh)(this,function(n){switch(n.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),e=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),e)])}})})},t.prototype.Xo=function(t){return(0,g.mG)(this,void 0,void 0,function(){var e;return(0,g.Jh)(this,function(n){switch(n.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:n.sent()&&this.Yo("Reached the end of bundle when more is expected."),n.label=2;case 2:return[3,0];case 3:return e=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),e)]}})})},t.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},t.prototype.tc=function(){return(0,g.mG)(this,void 0,void 0,function(){var t,e;return(0,g.Jh)(this,function(n){switch(n.label){case 0:return[4,this.Go.read()];case 1:return(t=n.sent()).done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),[2,t.done]}})})}}(),function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return(0,g.mG)(this,void 0,void 0,function(){var e,n=this;return(0,g.Jh)(this,function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new ho(co.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return(0,g.mG)(this,void 0,void 0,function(){var n,r,i,o,s,a;return(0,g.Jh)(this,function(u){switch(u.label){case 0:return n=wo(t),r=pu(n.R)+"/documents",i={documents:e.map(function(t){return hu(n.R,t)})},[4,n.$i("BatchGetDocuments",r,i)];case 1:return o=u.sent(),s=new Map,o.forEach(function(t){var e=function(t,e){return"found"in e?function(t,e){bo(!!e.found);var n=lu(t,e.found.name),r=au(e.found.updateTime),i=new us({mapValue:{fields:e.found.fields}});return hs.newFoundDocument(n,r,i)}(t,e):"missing"in e?function(t,e){bo(!!e.missing),bo(!!e.readTime);var n=lu(t,e.missing),r=au(e.readTime);return hs.newNoDocument(n,r)}(t,e):vo()}(n.R,t);s.set(e.key.toString(),e)}),a=[],[2,(e.forEach(function(t){var e=s.get(t.toString());bo(!!e),a.push(e)}),a)]}})})}(this.datastore,t)];case 1:return[2,((e=r.sent()).forEach(function(t){return n.recordVersion(t)}),e)]}})})},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new ka(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return(0,g.mG)(this,void 0,void 0,function(){var t,e=this;return(0,g.Jh)(this,function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach(function(e){t.delete(e.key.toString())}),t.forEach(function(t,n){var r=Qo.fromPath(n);e.mutations.push(new Aa(r,e.precondition(r)))}),[4,function(t,e){return(0,g.mG)(this,void 0,void 0,function(){var n,r,i;return(0,g.Jh)(this,function(o){switch(o.label){case 0:return n=wo(t),r=pu(n.R)+"/documents",i={writes:e.map(function(t){return vu(n.R,t)})},[4,n.Ni("Commit",r,i)];case 1:return o.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}})})},t.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw vo();e=Ao.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new ho(co.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?la.updateTime(e):la.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(Ao.min()))throw new ho(co.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return la.updateTime(e)}return la.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}()),Zf=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new dl(this.asyncQueue,"transaction_retry")}return t.prototype.run=function(){this.ec-=1,this.nc()},t.prototype.nc=function(){var t=this;this.Zi.ji(function(){return(0,g.mG)(t,void 0,void 0,function(){var t,e,n=this;return(0,g.Jh)(this,function(r){return t=new Wf(this.datastore),(e=this.sc(t))&&e.then(function(e){n.asyncQueue.enqueueAndForget(function(){return t.commit().then(function(){n.deferred.resolve(e)}).catch(function(t){n.ic(t)})})}).catch(function(t){n.ic(t)}),[2]})})})},t.prototype.sc=function(t){try{var e=this.updateFunction(t);return!Ko(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},t.prototype.ic=function(t){var e=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget(function(){return e.nc(),Promise.resolve()})):this.deferred.reject(t)},t.prototype.rc=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!Da(e)}return!1},t}(),Xf=function(){function t(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=Hh.UNAUTHENTICATED,this.clientId=To.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(e,function(t){return(0,g.mG)(r,void 0,void 0,function(){return(0,g.Jh)(this,function(e){switch(e.label){case 0:return po("FirestoreClient","Received user=",t.uid),[4,this.credentialListener(t)];case 1:return e.sent(),this.user=t,[2]}})})})}return t.prototype.getConfiguration=function(){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]})})},t.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new ho(co.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new rc;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return(0,g.mG)(t,void 0,void 0,function(){var t,n;return(0,g.Jh)(this,function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=r.sent(),n=Jl(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}})})}),e.promise},t}();function Yf(t,e){return(0,g.mG)(this,void 0,void 0,function(){var n,r,i=this;return(0,g.Jh)(this,function(o){switch(o.label){case 0:return t.asyncQueue.verifyOperationInProgress(),po("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=o.sent(),[4,e.initialize(n)];case 2:return o.sent(),r=n.initialUser,t.setCredentialChangeListener(function(t){return(0,g.mG)(i,void 0,void 0,function(){return(0,g.Jh)(this,function(n){switch(n.label){case 0:return r.isEqual(t)?[3,2]:[4,Eh(e.localStore,t)];case 1:n.sent(),r=t,n.label=2;case 2:return[2]}})})}),e.persistence.setDatabaseDeletedListener(function(){return t.terminate()}),t.offlineComponents=e,[2]}})})}function $f(t,e){return(0,g.mG)(this,void 0,void 0,function(){var n,r;return(0,g.Jh)(this,function(i){switch(i.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,td(t)];case 1:return n=i.sent(),po("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return r=i.sent(),[4,e.initialize(n,r)];case 3:return i.sent(),t.setCredentialChangeListener(function(t){return function(t,e){return(0,g.mG)(this,void 0,void 0,function(){var n,r;return(0,g.Jh)(this,function(i){switch(i.label){case 0:return(n=wo(t)).asyncQueue.verifyOperationInProgress(),po("RemoteStore","RemoteStore received new credentials"),r=Rl(n),n.Or.add(3),[4,_l(n)];case 1:return i.sent(),r&&n.Br.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return i.sent(),n.Or.delete(3),[4,wl(n)];case 3:return i.sent(),[2]}})})}(e.remoteStore,t)}),t.onlineComponents=e,[2]}})})}function td(t){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(po("FirestoreClient","Using default OfflineComponentProvider"),[4,Yf(t,new Kf)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}})})}function ed(t){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(po("FirestoreClient","Using default OnlineComponentProvider"),[4,$f(t,new Qf)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}})})}function nd(t){return td(t).then(function(t){return t.persistence})}function rd(t){return td(t).then(function(t){return t.localStore})}function id(t){return ed(t).then(function(t){return t.remoteStore})}function od(t){return ed(t).then(function(t){return t.syncEngine})}function sd(t){return(0,g.mG)(this,void 0,void 0,function(){var e,n;return(0,g.Jh)(this,function(r){switch(r.label){case 0:return[4,ed(t)];case 1:return e=r.sent(),[2,((n=e.eventManager).onListen=df.bind(null,e.syncEngine),n.onUnlisten=gf.bind(null,e.syncEngine),n)]}})})}function ad(t,e,n){var r=this;void 0===n&&(n={});var i=new rc;return t.asyncQueue.enqueueAndForget(function(){return(0,g.mG)(r,void 0,void 0,function(){var r;return(0,g.Jh)(this,function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new Hf({next:function(o){e.enqueueAndForget(function(){return $l(t,s)});var a=o.docs.has(n);!a&&o.fromCache?i.reject(new ho(co.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&o.fromCache&&r&&"server"===r.source?i.reject(new ho(co.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new rf(Os(n.path),o,{includeMetadataChanges:!0,so:!0});return Yl(t,s)},[4,sd(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}})})}),i.promise}function ud(t,e,n){var r=this;void 0===n&&(n={});var i=new rc;return t.asyncQueue.enqueueAndForget(function(){return(0,g.mG)(r,void 0,void 0,function(){var r;return(0,g.Jh)(this,function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new Hf({next:function(n){e.enqueueAndForget(function(){return $l(t,s)}),n.fromCache&&"server"===r.source?i.reject(new ho(co.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new rf(n,o,{includeMetadataChanges:!0,so:!0});return Yl(t,s)},[4,sd(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}})})}),i.promise}var cd=function(t,e,n,r,i,o,s,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.useFetchStreams=a},hd=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),ld=new Map,fd=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},dd=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){this.changeListener=e,t.enqueueRetryable(function(){return e(Hh.UNAUTHENTICATED)})},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),pd=function(){function t(t){this.token=t,this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(this.token)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){var n=this;this.changeListener=e,t.enqueueRetryable(function(){return e(n.token.user)})},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),gd=function(){function t(t){var e=this;this.currentUser=Hh.UNAUTHENTICATED,this.oc=new rc,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=function(){e.cc++,e.currentUser=e.ac(),e.oc.resolve(),e.changeListener&&e.asyncQueue.enqueueRetryable(function(){return e.changeListener(e.currentUser)})};var n=function(t){po("FirebaseCredentialsProvider","Auth detected"),e.auth=t,e.auth.addAuthTokenListener(e.uc)};t.onInit(function(t){return n(t)}),setTimeout(function(){if(!e.auth){var r=t.getImmediate({optional:!0});r?n(r):(po("FirebaseCredentialsProvider","Auth not yet detected"),e.oc.resolve())}},0)}return t.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(function(n){return t.cc!==e?(po("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(bo("string"==typeof n.accessToken),new fd(n.accessToken,t.currentUser)):null}):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t,e){var n=this;this.asyncQueue=t,this.asyncQueue.enqueueRetryable(function(){return(0,g.mG)(n,void 0,void 0,function(){return(0,g.Jh)(this,function(t){switch(t.label){case 0:return[4,this.oc.promise];case 1:return t.sent(),[4,e(this.currentUser)];case 2:return t.sent(),this.changeListener=e,[2]}})})})},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=function(){return Promise.resolve()}},t.prototype.ac=function(){var t=this.auth&&this.auth.getUid();return bo(null===t||"string"==typeof t),new Hh(t)},t}(),yd=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n,this.type="FirstParty",this.user=Hh.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.lc},e=this.hc.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.fc&&(t["X-Goog-Iam-Authorization-Token"]=this.fc),t},enumerable:!1,configurable:!0}),t}(),md=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n}return t.prototype.getToken=function(){return Promise.resolve(new yd(this.hc,this.lc,this.fc))},t.prototype.setChangeListener=function(t,e){t.enqueueRetryable(function(){return e(Hh.FIRST_PARTY)})},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function vd(t,e,n){if(!n)throw new ho(co.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function bd(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new ho(co.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function wd(t,e,n,r){if(!0===e&&!0===r)throw new ho(co.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function _d(t){if(!Qo.isDocumentKey(t))throw new ho(co.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function Td(t){if(Qo.isDocumentKey(t))throw new ho(co.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function Id(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":vo()}function Ed(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new ho(co.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=Id(t);throw new ho(co.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function Sd(t,e){if(e<=0)throw new ho(co.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var kd=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new ho(co.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new ho(co.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,wd("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams},t}(),Ad=function(){function t(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new kd({}),this._settingsFrozen=!1,t instanceof hd?(this._databaseId=t,this._credentials=new dd):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new ho(co.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new hd(t.options.projectId)}(t),this._credentials=new gd(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this._app)throw new ho(co.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new ho(co.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new kd(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new dd;switch(t.type){case"gapi":var e=t.client;return bo(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new md(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new ho(co.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){return(t=ld.get(this))&&(po("ComponentProvider","Removing Datastore"),ld.delete(this),t.terminate()),Promise.resolve();var t},t}(),Rd=function(){function t(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Nd(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),Dd=function(){function t(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),Nd=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,Os(r))||this)._path=r,i.type="collection",i}return(0,g.ZT)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new Rd(this.firestore,null,new Qo(t))},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._path)},e}(Dd);function xd(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=(0,y.m9)(t),vd("collection","path",e),t instanceof Ad)return Td(n=Co.fromString.apply(Co,(0,g.ev)([e],r))),new Nd(t,null,n);if(!(t instanceof Rd||t instanceof Nd))throw new ho(co.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Td(n=Co.fromString.apply(Co,(0,g.ev)([t.path],r)).child(Co.fromString(e))),new Nd(t.firestore,null,n)}function Cd(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=(0,y.m9)(t),1===arguments.length&&(e=To.u()),vd("doc","path",e),t instanceof Ad)return _d(n=Co.fromString.apply(Co,(0,g.ev)([e],r))),new Rd(t,null,new Qo(n));if(!(t instanceof Rd||t instanceof Nd))throw new ho(co.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return _d(n=t._path.child(Co.fromString.apply(Co,(0,g.ev)([e],r)))),new Rd(t.firestore,t instanceof Nd?t.converter:null,new Qo(n))}function Od(t,e){return t=(0,y.m9)(t),e=(0,y.m9)(e),(t instanceof Rd||t instanceof Nd)&&(e instanceof Rd||e instanceof Nd)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function Pd(t,e){return t=(0,y.m9)(t),e=(0,y.m9)(e),t instanceof Dd&&e instanceof Dd&&t.firestore===e.firestore&&Gs(t._query,e._query)&&t.converter===e.converter}var Ld=function(){function t(){var t=this;this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.yc=null,this.gc=!1,this.Ec=!1,this.Tc=[],this.Zi=new dl(this,"async_queue_retry"),this.Ic=function(){var e=ll();e&&po("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Zi.Gi()};var e=ll();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ic)}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this._c},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Ac(),this.Rc(t)},t.prototype.enterRestrictedMode=function(t){if(!this._c){this._c=!0,this.Ec=t||!1;var e=ll();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Ic)}},t.prototype.enqueue=function(t){var e=this;if(this.Ac(),this._c)return new Promise(function(){});var n=new rc;return this.Rc(function(){return e._c&&e.Ec?Promise.resolve():(t().then(n.resolve,n.reject),n.promise)}).then(function(){return n.promise})},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget(function(){return e.wc.push(t),e.bc()})},t.prototype.bc=function(){return(0,g.mG)(this,void 0,void 0,function(){var t,e=this;return(0,g.Jh)(this,function(n){switch(n.label){case 0:if(0===this.wc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.wc[0]()];case 2:return n.sent(),this.wc.shift(),this.Zi.reset(),[3,4];case 3:if(!cc(t=n.sent()))throw t;return po("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.wc.length>0&&this.Zi.ji(function(){return e.bc()}),n.label=5;case 5:return[2]}})})},t.prototype.Rc=function(t){var e=this,n=this.dc.then(function(){return e.gc=!0,t().catch(function(t){throw e.yc=t,e.gc=!1,go("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t}).then(function(t){return e.gc=!1,t})});return this.dc=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Ac(),this.Tc.indexOf(t)>-1&&(e=0);var i=zl.createAndSchedule(this,t,e,n,function(t){return r.vc(t)});return this.mc.push(i),i},t.prototype.Ac=function(){this.yc&&vo()},t.prototype.verifyOperationInProgress=function(){},t.prototype.Pc=function(){return(0,g.mG)(this,void 0,void 0,function(){var t;return(0,g.Jh)(this,function(e){switch(e.label){case 0:return[4,t=this.dc];case 1:e.sent(),e.label=2;case 2:if(t!==this.dc)return[3,0];e.label=3;case 3:return[2]}})})},t.prototype.Vc=function(t){for(var e=0,n=this.mc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.Sc=function(t){var e=this;return this.Pc().then(function(){e.mc.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var n=0,r=e.mc;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.Pc()})},t.prototype.Dc=function(t){this.Tc.push(t)},t.prototype.vc=function(t){var e=this.mc.indexOf(t);this.mc.splice(e,1)},t}();function Fd(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}!function(){function t(){this._progressObserver={},this._taskCompletionResolver=new rc,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}t.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},t.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},t.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},t.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},t.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},t.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}();var Ud=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).type="firestore",r._queue=new Ld,r._persistenceKey="name"in e?e.name:"[DEFAULT]",r}return(0,g.ZT)(e,t),e.prototype._terminate=function(){return this._firestoreClient||qd(this),this._firestoreClient.terminate()},e}(Ad);function Md(t){return t._firestoreClient||qd(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function qd(t){var e,n=t._freezeSettings(),r=function(t,e,n,r){return new cd(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new Xf(t._credentials,t._queue,r)}function Vd(t,e,n){var r=this,i=new rc;return t.asyncQueue.enqueue(function(){return(0,g.mG)(r,void 0,void 0,function(){var r;return(0,g.Jh)(this,function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,Yf(t,n)];case 1:return o.sent(),[4,$f(t,e)];case 2:return o.sent(),i.resolve(),[3,4];case 3:if(!function(t){return"FirebaseError"===t.name?t.code===co.FAILED_PRECONDITION||t.code===co.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(r=o.sent()))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r),[3,4];case 4:return[2]}})})}).then(function(){return i.promise})}function jd(t){if(t._initialized||t._terminated)throw new ho(co.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Gd=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new ho(co.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Po(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),Bd=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t(Fo.fromBase64String(e))}catch(e){throw new ho(co.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(Fo.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),Kd=function(t){this._methodName=t},zd=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new ho(co.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new ho(co.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return Io(this._lat,t._lat)||Io(this._long,t._long)},t}(),Jd=/^__.*__$/,Qd=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new wa(t,this.data,this.fieldMask,e,this.fieldTransforms):new ba(t,this.data,e,this.fieldTransforms)},t}(),Hd=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new wa(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();function Wd(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw vo()}}var Zd=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Cc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Nc",{get:function(){return this.settings.Nc},enumerable:!1,configurable:!0}),t.prototype.xc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.Fc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.xc({path:n,kc:!1});return r.$c(t),r},t.prototype.Oc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.xc({path:n,kc:!1});return r.Cc(),r},t.prototype.Mc=function(t){return this.xc({path:void 0,kc:!0})},t.prototype.Lc=function(t){return yp(t,this.settings.methodName,this.settings.Bc||!1,this.path,this.settings.qc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(e){return t.isPrefixOf(e)})||void 0!==this.fieldTransforms.find(function(e){return t.isPrefixOf(e.field)})},t.prototype.Cc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.$c(this.path.get(t))},t.prototype.$c=function(t){if(0===t.length)throw this.Lc("Document fields must not be empty");if(Wd(this.Nc)&&Jd.test(t))throw this.Lc('Document fields cannot begin and end with "__"')},t}(),Xd=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||fl(t)}return t.prototype.Uc=function(t,e,n,r){return void 0===r&&(r=!1),new Zd({Nc:t,methodName:e,qc:n,path:Po.emptyPath(),kc:!1,Bc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},t}();function Yd(t){var e=t._freezeSettings(),n=fl(t._databaseId);return new Xd(t._databaseId,!!e.ignoreUndefinedProperties,n)}function $d(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Uc(o.merge||o.mergeFields?2:0,e,n,i);fp("Data must be an object, but it was:",s,r);var a,u,c=hp(r,s);if(o.merge)a=new Lo(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var h=[],l=0,f=o.mergeFields;l<f.length;l++){var d=dp(e,f[l],n);if(!s.contains(d))throw new ho(co.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");mp(h,d)||h.push(d)}a=new Lo(h),u=s.fieldTransforms.filter(function(t){return a.covers(t.field)})}else a=null,u=s.fieldTransforms;return new Qd(new us(c),a,u)}var tp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,g.ZT)(e,t),e.prototype._toFieldTransform=function(t){if(2!==t.Nc)throw t.Lc(1===t.Nc?this._methodName+"() can only appear at the top level of your update data":this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(Kd);function ep(t,e,n){return new Zd({Nc:3,qc:e.settings.qc,methodName:t._methodName,kc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var np=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,g.ZT)(e,t),e.prototype._toFieldTransform=function(t){return new ca(t.path,new ea)},e.prototype.isEqual=function(t){return t instanceof e},e}(Kd),rp=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return(0,g.ZT)(e,t),e.prototype._toFieldTransform=function(t){var e=ep(this,t,!0),n=this.Kc.map(function(t){return cp(t,e)}),r=new na(n);return new ca(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(Kd),ip=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return(0,g.ZT)(e,t),e.prototype._toFieldTransform=function(t){var e=ep(this,t,!0),n=this.Kc.map(function(t){return cp(t,e)}),r=new ia(n);return new ca(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(Kd),op=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Qc=n,r}return(0,g.ZT)(e,t),e.prototype._toFieldTransform=function(t){var e=new sa(t.R,Zs(t.R,this.Qc));return new ca(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(Kd);function sp(t,e,n,r){var i=t.Uc(1,e,n);fp("Data must be an object, but it was:",i,r);var o=[],s=us.empty();Do(r,function(t,r){var a=gp(e,t,n);r=(0,y.m9)(r);var u=i.Oc(a);if(r instanceof tp)o.push(a);else{var c=cp(r,u);null!=c&&(o.push(a),s.set(a,c))}});var a=new Lo(o);return new Hd(s,a,i.fieldTransforms)}function ap(t,e,n,r,i,o){var s=t.Uc(1,e,n),a=[dp(e,r,n)],u=[i];if(o.length%2!=0)throw new ho(co.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)a.push(dp(e,o[c])),u.push(o[c+1]);for(var h=[],l=us.empty(),f=a.length-1;f>=0;--f)if(!mp(h,a[f])){var d=a[f],p=u[f];p=(0,y.m9)(p);var g=s.Oc(d);if(p instanceof tp)h.push(d);else{var m=cp(p,g);null!=m&&(h.push(d),l.set(d,m))}}var v=new Lo(h);return new Hd(l,v,s.fieldTransforms)}function up(t,e,n,r){return void 0===r&&(r=!1),cp(n,t.Uc(r?4:3,e))}function cp(t,e){if(lp(t=(0,y.m9)(t)))return fp("Unsupported field value:",e,t),hp(t,e);if(t instanceof Kd)return function(t,e){if(!Wd(e.Nc))throw e.Lc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Lc(t._methodName+"() is not currently supported inside arrays");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.kc&&4!==e.Nc)throw e.Lc("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=cp(o[i],e.Mc(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=(0,y.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Zs(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=ko.fromDate(t);return{timestampValue:iu(e.R,n)}}if(t instanceof ko)return n=new ko(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:iu(e.R,n)};if(t instanceof zd)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Bd)return{bytesValue:ou(e.R,t._byteString)};if(t instanceof Rd){var r=t.firestore._databaseId;if(!r.isEqual(n=e.databaseId))throw e.Lc("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:uu(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Lc("Unsupported field value: "+Id(t))}(t,e)}function hp(t,e){var n={};return No(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Do(t,function(t,r){var i=cp(r,e.Fc(t));null!=i&&(n[t]=i)}),{mapValue:{fields:n}}}function lp(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof ko||t instanceof zd||t instanceof Bd||t instanceof Rd||t instanceof Kd)}function fp(t,e,n){if(!lp(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=Id(n);throw e.Lc("an object"===r?t+" a custom object":t+" "+r)}}function dp(t,e,n){if((e=(0,y.m9)(e))instanceof Gd)return e._internalPath;if("string"==typeof e)return gp(t,e);throw yp("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var pp=new RegExp("[~\\*/\\[\\]]");function gp(t,e,n){if(e.search(pp)>=0)throw yp("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(Gd.bind.apply(Gd,(0,g.ev)([void 0],e.split(".")))))._internalPath}catch(yg){throw yp("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function yp(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,a="Function "+e+"() called with invalid data";n&&(a+=" (via `toFirestore()`)");var u="";return(o||s)&&(u+=" (found",o&&(u+=" in field "+r),s&&(u+=" in document "+i),u+=")"),new ho(co.INVALID_ARGUMENT,(a+=". ")+t+u)}function mp(t,e){return t.some(function(t){return t.isEqual(e)})}var vp=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new Rd(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new bp(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}},t.prototype.get=function(t){if(this._document){var e=this._document.data.field(wp("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),bp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,g.ZT)(e,t),e.prototype.data=function(){return t.prototype.data.call(this)},e}(vp);function wp(t,e){return"string"==typeof e?gp(t,e):e instanceof Gd?e._internalPath:e._delegate._internalPath}var _p=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),Tp=function(t){function e(e,n,r,i,o,s){var a=this;return(a=t.call(this,e,n,r,i,s)||this)._firestore=e,a._firestoreImpl=e,a.metadata=o,a}return(0,g.ZT)(e,t),e.prototype.exists=function(){return t.prototype.exists.call(this)},e.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new Ip(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}},e.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data.field(wp("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},e}(vp),Ip=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,g.ZT)(e,t),e.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},e}(Tp),Ep=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new _p(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach(function(r){t.call(e,new Ip(n._firestore,n._userDataWriter,r.key,r,new _p(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))})},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new ho(co.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map(function(e){return{type:"added",doc:new Ip(t._firestore,t._userDataWriter,e.doc.key,e.doc,new _p(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:n++}})}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter(function(t){return e||3!==t.type}).map(function(e){var n=new Ip(t._firestore,t._userDataWriter,e.doc.key,e.doc,new _p(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:Sp(e.type),doc:n,oldIndex:i,newIndex:o}})}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function Sp(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return vo()}}function kp(t,e){return t instanceof Tp&&e instanceof Tp?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Ep&&e instanceof Ep&&t._firestore===e._firestore&&Pd(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function Ap(t){if(Ls(t)&&0===t.explicitOrderBy.length)throw new ho(co.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Rp=function(){};function Dp(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){var o=i[r];t=o._apply(t)}return t}var Np=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).jc=e,i.Wc=n,i.Gc=r,i.type="where",i}return(0,g.ZT)(e,t),e.prototype._apply=function(t){var e=Yd(t.firestore),n=function(t,e,n,r,i,o,s){var a;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new ho(co.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){Up(s,o);for(var u=[],c=0,h=s;c<h.length;c++)u.push(Fp(r,t,h[c]));a={arrayValue:{values:u}}}else a=Fp(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||Up(s,o),a=up(n,"where",s,"in"===o||"not-in"===o);var l=ys.create(i,o,a);return function(t,e){if(e.g()){var n=Us(t);if(null!==n&&!n.isEqual(e.field))throw new ho(co.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=Fs(t);null!==r&&Mp(0,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw new ho(co.INVALID_ARGUMENT,i===e.op?"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter.":"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,l),l}(t._query,0,e,t.firestore._databaseId,this.jc,this.Wc,this.Gc);return new Dd(t.firestore,t.converter,function(t,e){var n=t.filters.concat([e]);return new xs(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))},e}(Rp),xp=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).jc=e,r.zc=n,r.type="orderBy",r}return(0,g.ZT)(e,t),e.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new ho(co.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new ho(co.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new As(e,n);return function(t,e){if(null===Fs(t)){var n=Us(t);null!==n&&Mp(0,n,e.field)}}(t,r),r}(t._query,this.jc,this.zc);return new Dd(t.firestore,t.converter,function(t,e){var n=t.explicitOrderBy.concat([e]);return new xs(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))},e}(Rp),Cp=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Hc=n,i.Jc=r,i}return(0,g.ZT)(e,t),e.prototype._apply=function(t){return new Dd(t.firestore,t.converter,js(t._query,this.Hc,this.Jc))},e}(Rp),Op=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Yc=n,i.Xc=r,i}return(0,g.ZT)(e,t),e.prototype._apply=function(t){var e=Lp(t,this.type,this.Yc,this.Xc);return new Dd(t.firestore,t.converter,function(t,e){return new xs(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))},e}(Rp),Pp=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Yc=n,i.Xc=r,i}return(0,g.ZT)(e,t),e.prototype._apply=function(t){var e=Lp(t,this.type,this.Yc,this.Xc);return new Dd(t.firestore,t.converter,function(t,e){return new xs(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))},e}(Rp);function Lp(t,e,n,r){if(n[0]=(0,y.m9)(n[0]),n[0]instanceof vp)return function(t,e,n,r,i){if(!r)throw new ho(co.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,a=qs(t);s<a.length;s++){var u=a[s];if(u.field.isKeyField())o.push(es(e,r.key));else{var c=r.data.field(u.field);if(jo(c))throw new ho(co.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=u.field.canonicalString();throw new ho(co.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new Ss(o,i)}(t._query,t.firestore._databaseId,e,n[0]._document,r);var i=Yd(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new ho(co.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new ho(co.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!Ms(t)&&-1!==c.indexOf("/"))throw new ho(co.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(Co.fromString(c));if(!Qo.isDocumentKey(h))throw new ho(co.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var l=new Qo(h);a.push(es(e,l))}else{var f=up(n,r,c);a.push(f)}}return new Ss(a,o)}(t._query,t.firestore._databaseId,i,e,n,r)}function Fp(t,e,n){if("string"==typeof(n=(0,y.m9)(n))){if(""===n)throw new ho(co.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ms(e)&&-1!==n.indexOf("/"))throw new ho(co.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(Co.fromString(n));if(!Qo.isDocumentKey(r))throw new ho(co.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return es(t,new Qo(r))}if(n instanceof Rd)return es(t,n._key);throw new ho(co.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Id(n)+".")}function Up(t,e){if(!Array.isArray(t)||0===t.length)throw new ho(co.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new ho(co.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function Mp(t,e,n){if(!n.isEqual(e))throw new ho(co.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}var qp=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),Ho(t)){case 0:return null;case 1:return t.booleanValue;case 2:return qo(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Vo(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw vo()}},t.prototype.convertObject=function(t,e){var n=this,r={};return Do(t.fields,function(t,i){r[t]=n.convertValue(i,e)}),r},t.prototype.convertGeoPoint=function(t){return new zd(qo(t.latitude),qo(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map(function(t){return n.convertValue(t,e)})},t.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=Go(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Bo(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=Mo(t);return new ko(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=Co.fromString(t);bo(Ou(n));var r=new hd(n.get(1),n.get(3)),i=new Qo(n.popFirst(5));return r.isEqual(e)||go("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}();function Vp(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var jp=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return(0,g.ZT)(e,t),e.prototype.convertBytes=function(t){return new Bd(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Rd(this.firestore,null,e)},e}(qp),Gp=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Yd(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=Bp(t,this._firestore),i=Vp(r.converter,e,n),o=$d(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(o.toMutation(r._key,la.none())),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();var o,s=Bp(t,this._firestore);return o="string"==typeof(e=(0,y.m9)(e))||e instanceof Gd?ap(this._dataReader,"WriteBatch.update",s._key,e,n,r):sp(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(o.toMutation(s._key,la.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=Bp(t,this._firestore);return this._mutations=this._mutations.concat(new ka(e._key,la.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new ho(co.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();function Bp(t,e){if((t=(0,y.m9)(t)).firestore!==e)throw new ho(co.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var Kp=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return(0,g.ZT)(e,t),e.prototype.convertBytes=function(t){return new Bd(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Rd(this.firestore,null,e)},e}(qp);function zp(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=Ed(t,Rd);var o=Ed(t.firestore,Ud),s=Yd(o);return Qp(o,[("string"==typeof(e=(0,y.m9)(e))||e instanceof Gd?ap(s,"updateDoc",t._key,e,n,r):sp(s,"updateDoc",t._key,e)).toMutation(t._key,la.exists(!0))])}function Jp(t){for(var e,n,r,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];t=(0,y.m9)(t);var s={includeMetadataChanges:!1},a=0;"object"!=typeof i[a]||Fd(i[a])||(s=i[a],a++);var u,c,h,l={includeMetadataChanges:s.includeMetadataChanges};if(Fd(i[a])){var f=i[a];i[a]=null===(e=f.next)||void 0===e?void 0:e.bind(f),i[a+1]=null===(n=f.error)||void 0===n?void 0:n.bind(f),i[a+2]=null===(r=f.complete)||void 0===r?void 0:r.bind(f)}if(t instanceof Rd)c=Ed(t.firestore,Ud),h=Os(t._key.path),u={next:function(e){i[a]&&i[a](Hp(c,t,e))},error:i[a+1],complete:i[a+2]};else{var d=Ed(t,Dd);c=Ed(d.firestore,Ud),h=d._query;var p=new Kp(c);u={next:function(t){i[a]&&i[a](new Ep(c,p,d,t))},error:i[a+1],complete:i[a+2]},Ap(t._query)}return function(t,e,n,r){var i=this,o=new Hf(r),s=new rf(e,o,n);return t.asyncQueue.enqueueAndForget(function(){return(0,g.mG)(i,void 0,void 0,function(){var e;return(0,g.Jh)(this,function(n){switch(n.label){case 0:return e=Yl,[4,sd(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}})})}),function(){o.Wo(),t.asyncQueue.enqueueAndForget(function(){return(0,g.mG)(i,void 0,void 0,function(){var e;return(0,g.Jh)(this,function(n){switch(n.label){case 0:return e=$l,[4,sd(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}})})})}}(Md(c),h,l,u)}function Qp(t,e){return function(t,e){var n=this,r=new rc;return t.asyncQueue.enqueueAndForget(function(){return(0,g.mG)(n,void 0,void 0,function(){var n;return(0,g.Jh)(this,function(i){switch(i.label){case 0:return n=yf,[4,od(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(Md(t),e)}function Hp(t,e,n){var r=n.docs.get(e._key),i=new Kp(t);return new Tp(t,i,e._key,r,new _p(n.hasPendingWrites,n.fromCache),e.converter)}var Wp=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._firestore=e,r}return(0,g.ZT)(e,t),e.prototype.get=function(e){var n=this,r=Bp(e,this._firestore),i=new Kp(this._firestore);return t.prototype.get.call(this,e).then(function(t){return new Tp(n._firestore,i,r._key,t._document,new _p(!1,!1),r.converter)})},e}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=Yd(t)}return t.prototype.get=function(t){var e=this,n=Bp(t,this._firestore),r=new jp(this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return vo();var i=t[0];if(i.isFoundDocument())return new vp(e._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new vp(e._firestore,r,n._key,null,n.converter);throw vo()})},t.prototype.set=function(t,e,n){var r=Bp(t,this._firestore),i=Vp(r.converter,e,n),o=$d(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o,s=Bp(t,this._firestore);return o="string"==typeof(e=(0,y.m9)(e))||e instanceof Gd?ap(this._dataReader,"Transaction.update",s._key,e,n,r):sp(this._dataReader,"Transaction.update",s._key,e),this._transaction.update(s._key,o),this},t.prototype.delete=function(t){var e=Bp(t,this._firestore);return this._transaction.delete(e._key),this},t}());function Zp(){if("undefined"==typeof Uint8Array)throw new ho(co.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Xp(){if("undefined"==typeof atob)throw new ho(co.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Yp=function(){function t(t){this._delegate=t}return t.fromBase64String=function(e){return Xp(),new t(Bd.fromBase64String(e))},t.fromUint8Array=function(e){return Zp(),new t(Bd.fromUint8Array(e))},t.prototype.toBase64=function(){return Xp(),this._delegate.toBase64()},t.prototype.toUint8Array=function(){return Zp(),this._delegate.toUint8Array()},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t}(),$p=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){jd(t=Ed(t,Ud));var n=Md(t),r=t._freezeSettings(),i=new Qf;return Vd(n,i,new zf(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){jd(t=Ed(t,Ud));var e=Md(t),n=t._freezeSettings(),r=new Qf;return Vd(e,r,new Jf(r,n.cacheSizeBytes))}(t._delegate)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new ho(co.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new rc;return t._queue.enqueueAndForgetEvenWhileRestricted(function(){return(0,g.mG)(e,void 0,void 0,function(){var e;return(0,g.Jh)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(e){switch(e.label){case 0:return sc.yt()?[4,sc.delete(t+"main")]:[2,Promise.resolve()];case 1:return e.sent(),[2]}})})}(mh(t._databaseId,t._persistenceKey))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}})})}),n.promise}(t._delegate)},t}(),tg=function(){function t(t,e,n){var r=this;this._delegate=e,this.Zc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof hd||(this.tu=t)}return Object.defineProperty(t.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){var e=this._delegate._getSettings();t.merge||e.host===t.host||yo("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)},t.prototype.useEmulator=function(t,e,n){void 0===n&&(n={}),function(t,e,n,r){void 0===r&&(r={});var i=(t=Ed(t,Ad))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&yo("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},i),{host:e+":"+n,ssl:!1})),r.mockUserToken){var o=(0,y.Sg)(r.mockUserToken),s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new ho(co.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t._credentials=new pd(new fd(o,new Hh(s)))}}(this._delegate,t,e,n)},t.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return(0,g.mG)(e,void 0,void 0,function(){var e,n;return(0,g.Jh)(this,function(r){switch(r.label){case 0:return[4,nd(t)];case 1:return e=r.sent(),[4,id(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),function(t){var e=wo(t);return e.Or.delete(0),wl(e)}(n))]}})})})}(Md(Ed(this._delegate,Ud)))},t.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return(0,g.mG)(e,void 0,void 0,function(){var e,n;return(0,g.Jh)(this,function(r){switch(r.label){case 0:return[4,nd(t)];case 1:return e=r.sent(),[4,id(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!1),function(t){return(0,g.mG)(this,void 0,void 0,function(){var e;return(0,g.Jh)(this,function(n){switch(n.label){case 0:return(e=wo(t)).Or.add(0),[4,_l(e)];case 1:return n.sent(),e.Br.set("Offline"),[2]}})})}(n))]}})})})}(Md(Ed(this._delegate,Ud)))},t.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&wd("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Zc.enableMultiTabIndexedDbPersistence(this):this.Zc.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return this.Zc.clearIndexedDbPersistence(this)},t.prototype.terminate=function(){return this.tu&&(this.tu._removeServiceInstance("firestore"),this.tu._removeServiceInstance("firestore-exp")),this._delegate._delete()},t.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new rc;return t.asyncQueue.enqueueAndForget(function(){return(0,g.mG)(e,void 0,void 0,function(){var e;return(0,g.Jh)(this,function(r){switch(r.label){case 0:return e=Tf,[4,od(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}})})}),n.promise}(Md(Ed(this._delegate,Ud)))},t.prototype.onSnapshotsInSync=function(t){return function(t,e){return function(t,e){var n=this,r=new Hf(e);return t.asyncQueue.enqueueAndForget(function(){return(0,g.mG)(n,void 0,void 0,function(){var e;return(0,g.Jh)(this,function(n){switch(n.label){case 0:return e=function(t,e){wo(t).Gr.add(e),e.next()},[4,sd(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})}),function(){r.Wo(),t.asyncQueue.enqueueAndForget(function(){return(0,g.mG)(n,void 0,void 0,function(){var e;return(0,g.Jh)(this,function(n){switch(n.label){case 0:return e=function(t,e){wo(t).Gr.delete(e)},[4,sd(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})})}}(Md(t=Ed(t,Ud)),Fd(e)?e:{next:e})}(this._delegate,t)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.tu)throw new ho(co.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.tu},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new pg(this,xd(this._delegate,t))}catch(t){throw sg(t,"collection()","Firestore.collection()")}},t.prototype.doc=function(t){try{return new og(this,Cd(this._delegate,t))}catch(t){throw sg(t,"doc()","Firestore.doc()")}},t.prototype.collectionGroup=function(t){try{return new lg(this,function(t,e){if(t=Ed(t,Ad),vd("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new ho(co.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new Dd(t,null,function(t){return new xs(Co.emptyPath(),t)}(e))}(this._delegate,t))}catch(t){throw sg(t,"collectionGroup()","Firestore.collectionGroup()")}},t.prototype.runTransaction=function(t){var e=this;return function(t,e){return function(t,e){var n=this,r=new rc;return t.asyncQueue.enqueueAndForget(function(){return(0,g.mG)(n,void 0,void 0,function(){var n;return(0,g.Jh)(this,function(i){switch(i.label){case 0:return[4,function(t){return ed(t).then(function(t){return t.datastore})}(t)];case 1:return n=i.sent(),new Zf(t.asyncQueue,n,e,r).run(),[2]}})})}),r.promise}(Md(t),function(n){return e(new Wp(t,n))})}(this._delegate,function(n){return t(new ng(e,n))})},t.prototype.batch=function(){var t=this;return Md(this._delegate),new rg(new Gp(this._delegate,function(e){return Qp(t._delegate,e)}))},t.prototype.loadBundle=function(t){throw new ho(co.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},t.prototype.namedQuery=function(t){throw new ho(co.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},t}(),eg=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return(0,g.ZT)(e,t),e.prototype.convertBytes=function(t){return new Yp(new Bd(t))},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return og.eu(e,this.firestore,null)},e}(qp),ng=function(){function t(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new eg(t)}return t.prototype.get=function(t){var e=this,n=gg(t);return this._delegate.get(n).then(function(t){return new cg(e._firestore,new Tp(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n.converter))})},t.prototype.set=function(t,e,n){var r=gg(t);return n?(bd("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=gg(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,(0,g.ev)([s,e,n],i)),this},t.prototype.delete=function(t){var e=gg(t);return this._delegate.delete(e),this},t}(),rg=function(){function t(t){this._delegate=t}return t.prototype.set=function(t,e,n){var r=gg(t);return n?(bd("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=gg(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,(0,g.ev)([s,e,n],i)),this},t.prototype.delete=function(t){var e=gg(t);return this._delegate.delete(e),this},t.prototype.commit=function(){return this._delegate.commit()},t}(),ig=function(){function t(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}return t.prototype.fromFirestore=function(t,e){var n=new Ip(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new hg(this._firestore,n),null!=e?e:{})},t.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},t.nu=function(e,n){var r=t.su,i=r.get(e);i||(i=new WeakMap,r.set(e,i));var o=i.get(n);return o||(o=new t(e,new eg(e),n),i.set(n,o)),o},t}();ig.su=new WeakMap;var og=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new eg(t)}return t.iu=function(e,n,r){if(e.length%2!=0)throw new ho(co.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(n,new Rd(n._delegate,r,new Qo(e)))},t.eu=function(e,n,r){return new t(n,new Rd(n._delegate,r,e))},Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new pg(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new pg(this.firestore,xd(this._delegate,t))}catch(t){throw sg(t,"collection()","DocumentReference.collection()")}},t.prototype.isEqual=function(t){return(t=(0,y.m9)(t))instanceof Rd&&Od(this._delegate,t)},t.prototype.set=function(t,e){e=bd("DocumentReference.set",e);try{return function(t,e,n){t=Ed(t,Rd);var r=Ed(t.firestore,Ud),i=Vp(t.converter,e,n);return Qp(r,[$d(Yd(r),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,la.none())])}(this._delegate,t,e)}catch(t){throw sg(t,"setDoc()","DocumentReference.set()")}},t.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?zp(this._delegate,t):zp.apply(void 0,(0,g.ev)([this._delegate,t,e],n))}catch(t){throw sg(t,"updateDoc()","DocumentReference.update()")}},t.prototype.delete=function(){return Qp(Ed((t=this._delegate).firestore,Ud),[new ka(t._key,la.none())]);var t},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=ag(e),i=ug(e,function(e){return new cg(t.firestore,new Tp(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate.converter))});return Jp(this._delegate,r,i)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Ed(t,Rd);var e=Ed(t.firestore,Ud),n=Md(e),r=new Kp(e);return function(t,e){var n=this,r=new rc;return t.asyncQueue.enqueueAndForget(function(){return(0,g.mG)(n,void 0,void 0,function(){var n;return(0,g.Jh)(this,function(i){switch(i.label){case 0:return n=function(t,e,n){return(0,g.mG)(this,void 0,void 0,function(){var r,i;return(0,g.Jh)(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,function(t,e){var n=wo(t);return n.persistence.runTransaction("read document","readonly",function(t){return n.Mn.mn(t,e)})}(t,e)];case 1:return(i=o.sent()).isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new ho(co.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=o.sent(),i=Jl(r,"Failed to get document '"+e+" from cache"),n.reject(i),[3,3];case 3:return[2]}})})},[4,rd(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(n,t._key).then(function(n){return new Tp(e,r,t._key,n,new _p(null!==n&&n.hasLocalMutations,!0),t.converter)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Ed(t,Rd);var e=Ed(t.firestore,Ud);return ad(Md(e),t._key,{source:"server"}).then(function(n){return Hp(e,t,n)})}(this._delegate):function(t){t=Ed(t,Rd);var e=Ed(t.firestore,Ud);return ad(Md(e),t._key).then(function(n){return Hp(e,t,n)})}(this._delegate)).then(function(t){return new cg(e.firestore,new Tp(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))})},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?ig.nu(this.firestore,e):null))},t}();function sg(t,e,n){return t.message=t.message.replace(e,n),t}function ag(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!Fd(r))return r}return{}}function ug(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=Fd(t[0])?t[0]:Fd(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var cg=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"ref",{get:function(){return new og(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),t.prototype.data=function(t){return this._delegate.data(t)},t.prototype.get=function(t,e){return this._delegate.get(t,e)},t.prototype.isEqual=function(t){return kp(this._delegate,t._delegate)},t}(),hg=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,g.ZT)(e,t),e.prototype.data=function(t){return this._delegate.data(t)},e}(cg),lg=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new eg(t)}return t.prototype.where=function(e,n,r){try{return new t(this.firestore,Dp(this._delegate,function(t,e,n){var r=e,i=wp("where",t);return new Np(i,r,n)}(e,n,r)))}catch(e){throw sg(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.orderBy=function(e,n){try{return new t(this.firestore,Dp(this._delegate,function(t,e){void 0===e&&(e="asc");var n=e,r=wp("orderBy",t);return new xp(r,n)}(e,n)))}catch(e){throw sg(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.limit=function(e){try{return new t(this.firestore,Dp(this._delegate,function(t){return Sd("limit",t),new Cp("limit",t,"F")}(e)))}catch(e){throw sg(e,"limit()","Query.limit()")}},t.prototype.limitToLast=function(e){try{return new t(this.firestore,Dp(this._delegate,function(t){return Sd("limitToLast",t),new Cp("limitToLast",t,"L")}(e)))}catch(e){throw sg(e,"limitToLast()","Query.limitToLast()")}},t.prototype.startAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Dp(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Op("startAt",t,!0)}).apply(void 0,e)))}catch(e){throw sg(e,"startAt()","Query.startAt()")}},t.prototype.startAfter=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Dp(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Op("startAfter",t,!1)}).apply(void 0,e)))}catch(e){throw sg(e,"startAfter()","Query.startAfter()")}},t.prototype.endBefore=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Dp(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Pp("endBefore",t,!0)}).apply(void 0,e)))}catch(e){throw sg(e,"endBefore()","Query.endBefore()")}},t.prototype.endAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Dp(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Pp("endAt",t,!1)}).apply(void 0,e)))}catch(e){throw sg(e,"endAt()","Query.endAt()")}},t.prototype.isEqual=function(t){return Pd(this._delegate,t._delegate)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Ed(t,Dd);var e=Ed(t.firestore,Ud),n=Md(e),r=new Kp(e);return function(t,e){var n=this,r=new rc;return t.asyncQueue.enqueueAndForget(function(){return(0,g.mG)(n,void 0,void 0,function(){var n;return(0,g.Jh)(this,function(i){switch(i.label){case 0:return n=function(t,e,n){return(0,g.mG)(this,void 0,void 0,function(){var r,i,o,s,a;return(0,g.Jh)(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,Ch(t,e,!0)];case 1:return a=u.sent(),r=new cf(e,a.Bn),i=r._o(a.documents),o=r.applyChanges(i,!1),n.resolve(o.snapshot),[3,3];case 2:return s=u.sent(),a=Jl(s,"Failed to execute query '"+e+" against cache"),n.reject(a),[3,3];case 3:return[2]}})})},[4,rd(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(n,t._query).then(function(n){return new Ep(e,r,t,n)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Ed(t,Dd);var e=Ed(t.firestore,Ud),n=Md(e),r=new Kp(e);return ud(n,t._query,{source:"server"}).then(function(n){return new Ep(e,r,t,n)})}(this._delegate):function(t){t=Ed(t,Dd);var e=Ed(t.firestore,Ud),n=Md(e),r=new Kp(e);return Ap(t._query),ud(n,t._query).then(function(n){return new Ep(e,r,t,n)})}(this._delegate)).then(function(t){return new dg(e.firestore,new Ep(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))})},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=ag(e),i=ug(e,function(e){return new dg(t.firestore,new Ep(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))});return Jp(this._delegate,r,i)},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?ig.nu(this.firestore,e):null))},t}(),fg=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doc",{get:function(){return new hg(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),t}(),dg=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"query",{get:function(){return new lg(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map(function(e){return new hg(t._firestore,e)})},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map(function(t){return new fg(e._firestore,t)})},t.prototype.forEach=function(t,e){var n=this;this._delegate.forEach(function(r){t.call(e,new hg(n._firestore,r))})},t.prototype.isEqual=function(t){return kp(this._delegate,t._delegate)},t}(),pg=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r._delegate=n,r}return(0,g.ZT)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new og(this.firestore,t):null},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){try{return new og(this.firestore,void 0===t?Cd(this._delegate):Cd(this._delegate,t))}catch(t){throw sg(t,"doc()","CollectionReference.doc()")}},e.prototype.add=function(t){var e=this;return function(t,e){var n=Ed(t.firestore,Ud),r=Cd(t),i=Vp(t.converter,e);return Qp(n,[$d(Yd(t.firestore),"addDoc",r._key,i,null!==t.converter,{}).toMutation(r._key,la.exists(!1))]).then(function(){return r})}(this._delegate,t).then(function(t){return new og(e.firestore,t)})},e.prototype.isEqual=function(t){return Od(this._delegate,t._delegate)},e.prototype.withConverter=function(t){return new e(this.firestore,this._delegate.withConverter(t?ig.nu(this.firestore,t):null))},e}(lg);function gg(t){return Ed(t,Rd)}var yg,mg=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(Gd.bind.apply(Gd,(0,g.ev)([void 0],t)))}return t.documentId=function(){return new t(Po.keyField().canonicalString())},t.prototype.isEqual=function(t){return(t=(0,y.m9)(t))instanceof Gd&&this._delegate._internalPath.isEqual(t._internalPath)},t}(),vg=function(){function t(t){this._delegate=t}return t.serverTimestamp=function(){var e=new np("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new t(e)},t.delete=function(){var e=new tp("deleteField");return e._methodName="FieldValue.delete",new t(e)},t.arrayUnion=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new rp("arrayUnion",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayUnion",new t(r)},t.arrayRemove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new ip("arrayRemove",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayRemove",new t(r)},t.increment=function(e){var n=function(t){return new op("increment",t)}(e);return n._methodName="FieldValue.increment",new t(n)},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t}(),bg={Firestore:tg,GeoPoint:zd,Timestamp:ko,Blob:Yp,Transaction:ng,WriteBatch:rg,DocumentReference:og,DocumentSnapshot:cg,Query:lg,QueryDocumentSnapshot:hg,QuerySnapshot:dg,CollectionReference:pg,FieldPath:mg,FieldValue:vg,setLogLevel:function(t){lo.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};(function(t,e){t.INTERNAL.registerComponent(new m.wA("firestore",function(t){return function(t,e){return new tg(t,new Ud(t,e),new $p)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))},"PUBLIC").setServiceProps(Object.assign({},bg)))})(yg=p.Z),yg.registerVersion("@firebase/firestore","2.3.9");var wg=n(9829);function _g(t,e){return function(t,e=Jt.z){return new s.y(n=>{let r;return null!=e?e.schedule(()=>{r=t.onSnapshot({includeMetadataChanges:!0},n)}):r=t.onSnapshot({includeMetadataChanges:!0},n),()=>{null!=r&&r()}})}(t,e)}function Tg(t,e){return _g(t,e).pipe((0,h.U)(t=>({payload:t,type:"query"})))}function Ig(t,e){return Tg(t,e).pipe((0,Qt.O)(void 0),(0,Ht.G)(),(0,h.U)(([t,e])=>{const n=e.payload.docChanges(),r=n.map(t=>({type:t.type,payload:t}));return t&&JSON.stringify(t.payload.metadata)!==JSON.stringify(e.payload.metadata)&&e.payload.docs.forEach((e,i)=>{const o=n.find(t=>t.doc.ref.isEqual(e.ref)),s=null==t?void 0:t.payload.docs.find(t=>t.ref.isEqual(e.ref));o&&JSON.stringify(o.doc.metadata)===JSON.stringify(e.metadata)||!o&&s&&JSON.stringify(s.metadata)===JSON.stringify(e.metadata)||r.push({type:"modified",payload:{oldIndex:i,newIndex:i,type:"modified",doc:e}})}),r}))}function Eg(t,e,n){return Ig(t,n).pipe((0,Wt.R)((t,n)=>function(t,e,n){return e.forEach(e=>{n.indexOf(e.type)>-1&&(t=function(t,e){switch(e.type){case"added":if(!t[e.newIndex]||!t[e.newIndex].doc.ref.isEqual(e.doc.ref))return Sg(t,e.newIndex,0,e);break;case"modified":if(null==t[e.oldIndex]||t[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const n=t.slice();return n.splice(e.oldIndex,1),n.splice(e.newIndex,0,e),n}return Sg(t,e.newIndex,1,e)}break;case"removed":if(t[e.oldIndex]&&t[e.oldIndex].doc.ref.isEqual(e.doc.ref))return Sg(t,e.oldIndex,1)}return t}(t,e))}),t}(t,n.map(t=>t.payload),e),[]),(0,Zt.x)(),(0,h.U)(t=>t.map(t=>({type:t.type,payload:t}))))}function Sg(t,e,n,...r){const i=t.slice();return i.splice(e,n,...r),i}function kg(t){return t&&0!==t.length||(t=["added","removed","modified"]),t}class Ag{constructor(t,e,n){this.ref=t,this.query=e,this.afs=n}stateChanges(t){let e=Ig(this.query,this.afs.schedulers.outsideAngular);return t&&t.length>0&&(e=e.pipe((0,h.U)(e=>e.filter(e=>t.indexOf(e.type)>-1)))),e.pipe((0,Qt.O)(void 0),(0,Ht.G)(),(0,Xt.h)(([t,e])=>e.length>0||!t),(0,h.U)(([t,e])=>e),this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe((0,Wt.R)((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=kg(t);return Eg(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return Tg(this.query,this.afs.schedulers.outsideAngular).pipe((0,h.U)(e=>e.payload.docs.map(e=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data())),this.afs.keepUnstableUntilFirst)}get(t){return(0,u.D)(this.query.get(t)).pipe((0,l.QV)(this.afs.schedulers.insideAngular))}add(t){return this.ref.add(t)}doc(t){return new Rg(this.ref.doc(t),this.afs)}}class Rg{constructor(t,e){this.ref=t,this.afs=e}set(t,e){return this.ref.set(t,e)}update(t){return this.ref.update(t)}delete(){return this.ref.delete()}collection(t,e){const n=this.ref.collection(t),{ref:r,query:i}=Pg(n,e);return new Ag(r,i,this.afs)}snapshotChanges(){return function(t,e){return _g(t,e).pipe((0,Qt.O)(void 0),(0,Ht.G)(),(0,h.U)(([t,e])=>e.exists?(null==t?void 0:t.exists)?{payload:e,type:"modified"}:{payload:e,type:"added"}:{payload:e,type:"removed"}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return this.snapshotChanges().pipe((0,h.U)(({payload:e})=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data()))}get(t){return(0,u.D)(this.ref.get(t)).pipe((0,l.QV)(this.afs.schedulers.insideAngular))}}class Dg{constructor(t,e){this.query=t,this.afs=e}stateChanges(t){return t&&0!==t.length?Ig(this.query,this.afs.schedulers.outsideAngular).pipe((0,h.U)(e=>e.filter(e=>t.indexOf(e.type)>-1)),(0,Xt.h)(t=>t.length>0),this.afs.keepUnstableUntilFirst):Ig(this.query,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe((0,Wt.R)((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=kg(t);return Eg(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return Tg(this.query,this.afs.schedulers.outsideAngular).pipe((0,h.U)(e=>e.payload.docs.map(e=>t.idField?Object.assign({[t.idField]:e.id},e.data()):e.data())),this.afs.keepUnstableUntilFirst)}get(t){return(0,u.D)(this.query.get(t)).pipe((0,l.QV)(this.afs.schedulers.insideAngular))}}const Ng=new o.OlP("angularfire2.enableFirestorePersistence"),xg=new o.OlP("angularfire2.firestore.persistenceSettings"),Cg=new o.OlP("angularfire2.firestore.settings"),Og=new o.OlP("angularfire2.firestore.use-emulator");function Pg(t,e=(t=>t)){return{query:e(t),ref:t}}let Lg=(()=>{class t{constructor(t,e,n,i,o,s,c,h,l){this.schedulers=new d.HU(s),this.keepUnstableUntilFirst=(0,d.ss)(this.schedulers);const f=(0,d.on)(t,s,e);!Yt.Z.auth&&l&&(0,d.yq)();const p=h;[this.firestore,this.persistenceEnabled$]=(0,d.sI)(`${f.name}.firestore`,"AngularFirestore",f,()=>{const t=s.runOutsideAngular(()=>f.firestore());if(i&&t.settings(i),p&&t.useEmulator(...p),n&&!(0,r.PM)(o)){const e=()=>{try{return(0,u.D)(t.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(yg){return"undefined"!=typeof console&&console.warn(yg),(0,a.of)(!1)}};return[t,s.runOutsideAngular(e)]}return[t,(0,a.of)(!1)]},[i,p,n])}collection(t,e){let n;n="string"==typeof t?this.firestore.collection(t):t;const{ref:r,query:i}=Pg(n,e),o=this.schedulers.ngZone.run(()=>r);return new Ag(o,i,this)}collectionGroup(t,e){const n=e||(t=>t),r=this.firestore.collectionGroup(t);return new Dg(n(r),this)}doc(t){let e;e="string"==typeof t?this.firestore.doc(t):t;const n=this.schedulers.ngZone.run(()=>e);return new Rg(n,this)}createId(){return this.firestore.collection("_").doc().id}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(d.Dh),o.LFG(d.xv,8),o.LFG(Ng,8),o.LFG(Cg,8),o.LFG(o.Lbi),o.LFG(o.R0b),o.LFG(xg,8),o.LFG(Og,8),o.LFG(wg.Qv,8))},t.\u0275prov=o.Yz7({factory:function(){return new t(o.LFG(d.Dh),o.LFG(d.xv,8),o.LFG(Ng,8),o.LFG(Cg,8),o.LFG(o.Lbi),o.LFG(o.R0b),o.LFG(xg,8),o.LFG(Og,8),o.LFG(wg.Qv,8))},token:t,providedIn:"any"}),t})();var Fg=n(5987),Ug=n(1552);let Mg=(()=>{class t{constructor(t,e){this.dialog=t,this.firestore=e,this.foto=[],this.user=[{img:"assets/wdh.png"}]}ngOnInit(){this.getFoto()}getFoto(){this.firestore.collection("photo").valueChanges().subscribe(t=>{this.foto=t})}tambahdata(){this.dialog.open(Kt,{width:"550px"})}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(zt.uw),o.Y36(Lg))},t.\u0275cmp=o.Xpm({type:t,selectors:[["app-user"]],decls:17,vars:0,consts:[["id","myNav",1,"navbar","navbar-light","sticky-top","shadow-sm","bg-light",2,"height","70px"],[1,"nav"],[1,"nav-item","mr-3"],[1,"navbar-brand"],[1,"nav","justify-content-end"],[1,"nav-item","mr-3",2,"margin-top","-20px"],["uk-icon","icon: user",1,"icon-user","mr-4"],[1,"float-left","mt-2","mr-2"],["routerLink","/login","uk-icon","icon: sign-out;","uk-tooltip","Sign out"],["type","button",1,"uk-position-small","uk-position-center","uk-overlay","uk-overlay-default",2,"margin-bottom","70px",3,"click"],[1,"uk-position-small","uk-position-center","uk-overlay","uk-overlay-default",2,"margin-top","60px","margin-left","20px"]],template:function(t,e){1&t&&(o.TgZ(0,"nav",0),o.TgZ(1,"ul",1),o.TgZ(2,"li",2),o.TgZ(3,"a",3),o._uU(4,"My Gallery"),o.qZA(),o.qZA(),o.qZA(),o.TgZ(5,"ul",4),o.TgZ(6,"li",5),o.TgZ(7,"a",6),o.TgZ(8,"p",7),o._uU(9,"User"),o.qZA(),o.qZA(),o._UZ(10,"a",8),o.qZA(),o.qZA(),o.qZA(),o.TgZ(11,"div"),o.TgZ(12,"a",9),o.NdJ("click",function(){return e.tambahdata()}),o.TgZ(13,"mat-icon"),o._uU(14,"add"),o.qZA(),o.qZA(),o.qZA(),o.TgZ(15,"p",10),o._uU(16,"Upload disini!!"),o.qZA())},directives:[Fg.yS,Ug.Hw],styles:[".card-link[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:hover{background-color:#e9e9e9}.content[_ngcontent-%COMP%]{margin-top:-50px}.shopping-cart[_ngcontent-%COMP%]{padding:10px 0 0 7px}.shopping-cart[_ngcontent-%COMP%]:hover{background-color:#e9e9e9;width:35px;height:40px;border-radius:10px}@media screen and (max-width: 575px){.content[_ngcontent-%COMP%]{margin-top:-15px}}"]}),t})();var qg=n(2244);const Vg=[{path:"",component:Mg,children:[{path:""}]}];let jg=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({imports:[[r.ez,Fg.Bz.forChild(Vg),qg.q]]}),t})()}}]);